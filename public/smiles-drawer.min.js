(()=>{var Zl=Object.create;var Vl=Object.defineProperty;var Kl=Object.getOwnPropertyDescriptor;var Jl=Object.getOwnPropertyNames;var Ql=Object.getPrototypeOf,eo=Object.prototype.hasOwnProperty;var to=(L,t)=>()=>(t||L((t={exports:{}}).exports,t),t.exports);var ro=(L,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Jl(t))!eo.call(L,s)&&s!==i&&Vl(L,s,{get:()=>t[s],enumerable:!(r=Kl(t,s))||r.enumerable});return L};var io=(L,t,i)=>(i=L!=null?Zl(Ql(L)):{},ro(t||!L||!L.__esModule?Vl(i,"default",{value:L,enumerable:!0}):i,L));var jl=to((Pl,Dl)=>{(function(L,t){typeof Pl=="object"&&typeof Dl<"u"?Dl.exports=t():typeof define=="function"&&define.amd?define(t):(L=typeof globalThis<"u"?globalThis:L||self,L.chroma=t())})(Pl,function(){"use strict";for(var L=function(a,h,d){return h===void 0&&(h=0),d===void 0&&(d=1),a<h?h:a>d?d:a},t=L,i=function(a){a._clipped=!1,a._unclipped=a.slice(0);for(var h=0;h<=3;h++)h<3?((a[h]<0||a[h]>255)&&(a._clipped=!0),a[h]=t(a[h],0,255)):h===3&&(a[h]=t(a[h],0,1));return a},r={},s=0,e=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];s<e.length;s+=1){var l=e[s];r["[object "+l+"]"]=l.toLowerCase()}var f=function(a){return r[Object.prototype.toString.call(a)]||"object"},g=f,c=function(a,h){return h===void 0&&(h=null),a.length>=3?Array.prototype.slice.call(a):g(a[0])=="object"&&h?h.split("").filter(function(d){return a[0][d]!==void 0}).map(function(d){return a[0][d]}):a[0]},m=f,b=function(a){if(a.length<2)return null;var h=a.length-1;return m(a[h])=="string"?a[h].toLowerCase():null},S=Math.PI,p={clip_rgb:i,limit:L,type:f,unpack:c,last:b,PI:S,TWOPI:S*2,PITHIRD:S/3,DEG2RAD:S/180,RAD2DEG:180/S},x={format:{},autodetect:[]},D=p.last,M=p.clip_rgb,z=p.type,W=x,F=function(){for(var h=[],d=arguments.length;d--;)h[d]=arguments[d];var y=this;if(z(h[0])==="object"&&h[0].constructor&&h[0].constructor===this.constructor)return h[0];var $=D(h),N=!1;if(!$){N=!0,W.sorted||(W.autodetect=W.autodetect.sort(function(H,q){return q.p-H.p}),W.sorted=!0);for(var A=0,E=W.autodetect;A<E.length;A+=1){var T=E[A];if($=T.test.apply(T,h),$)break}}if(W.format[$]){var O=W.format[$].apply(null,N?h:h.slice(0,-1));y._rgb=M(O)}else throw new Error("unknown format: "+h);y._rgb.length===3&&y._rgb.push(1)};F.prototype.toString=function(){return z(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var k=F,_=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(_.Color,[null].concat(a)))};_.Color=k,_.version="2.4.2";var j=_,Q=p.unpack,oe=Math.max,ae=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=Q(a,"rgb"),y=d[0],$=d[1],N=d[2];y=y/255,$=$/255,N=N/255;var A=1-oe(y,oe($,N)),E=A<1?1/(1-A):0,T=(1-y-A)*E,O=(1-$-A)*E,H=(1-N-A)*E;return[T,O,H,A]},Ae=ae,Ke=p.unpack,Je=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];a=Ke(a,"cmyk");var d=a[0],y=a[1],$=a[2],N=a[3],A=a.length>4?a[4]:1;return N===1?[0,0,0,A]:[d>=1?0:255*(1-d)*(1-N),y>=1?0:255*(1-y)*(1-N),$>=1?0:255*(1-$)*(1-N),A]},Le=Je,Ne=j,Ye=k,He=x,Qe=p.unpack,_e=p.type,K=Ae;Ye.prototype.cmyk=function(){return K(this._rgb)},Ne.cmyk=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Ye,[null].concat(a,["cmyk"])))},He.format.cmyk=Le,He.autodetect.push({p:2,test:function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];if(a=Qe(a,"cmyk"),_e(a)==="array"&&a.length===4)return"cmyk"}});var se=p.unpack,me=p.last,ke=function(a){return Math.round(a*100)/100},ye=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=se(a,"hsla"),y=me(a)||"lsa";return d[0]=ke(d[0]||0),d[1]=ke(d[1]*100)+"%",d[2]=ke(d[2]*100)+"%",y==="hsla"||d.length>3&&d[3]<1?(d[3]=d.length>3?d[3]:1,y="hsla"):d.length=3,y+"("+d.join(",")+")"},Re=ye,$e=p.unpack,Me=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];a=$e(a,"rgba");var d=a[0],y=a[1],$=a[2];d/=255,y/=255,$/=255;var N=Math.min(d,y,$),A=Math.max(d,y,$),E=(A+N)/2,T,O;return A===N?(T=0,O=Number.NaN):T=E<.5?(A-N)/(A+N):(A-N)/(2-A-N),d==A?O=(y-$)/(A-N):y==A?O=2+($-d)/(A-N):$==A&&(O=4+(d-y)/(A-N)),O*=60,O<0&&(O+=360),a.length>3&&a[3]!==void 0?[O,T,E,a[3]]:[O,T,E]},Ct=Me,It=p.unpack,et=p.last,at=Re,Pt=Ct,De=Math.round,Oe=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=It(a,"rgba"),y=et(a)||"rgb";return y.substr(0,3)=="hsl"?at(Pt(d),y):(d[0]=De(d[0]),d[1]=De(d[1]),d[2]=De(d[2]),(y==="rgba"||d.length>3&&d[3]<1)&&(d[3]=d.length>3?d[3]:1,y="rgba"),y+"("+d.slice(0,y==="rgb"?3:4).join(",")+")")},lt=Oe,ot=p.unpack,je=Math.round,Dt=function(){for(var a,h=[],d=arguments.length;d--;)h[d]=arguments[d];h=ot(h,"hsl");var y=h[0],$=h[1],N=h[2],A,E,T;if($===0)A=E=T=N*255;else{var O=[0,0,0],H=[0,0,0],q=N<.5?N*(1+$):N+$-N*$,X=2*N-q,Z=y/360;O[0]=Z+1/3,O[1]=Z,O[2]=Z-1/3;for(var U=0;U<3;U++)O[U]<0&&(O[U]+=1),O[U]>1&&(O[U]-=1),6*O[U]<1?H[U]=X+(q-X)*6*O[U]:2*O[U]<1?H[U]=q:3*O[U]<2?H[U]=X+(q-X)*(2/3-O[U])*6:H[U]=X;a=[je(H[0]*255),je(H[1]*255),je(H[2]*255)],A=a[0],E=a[1],T=a[2]}return h.length>3?[A,E,T,h[3]]:[A,E,T,1]},vr=Dt,pi=vr,mr=x,vi=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,br=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,mi=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,wr=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,bi=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,yr=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,wi=Math.round,Sr=function(a){a=a.toLowerCase().trim();var h;if(mr.format.named)try{return mr.format.named(a)}catch(U){}if(h=a.match(vi)){for(var d=h.slice(1,4),y=0;y<3;y++)d[y]=+d[y];return d[3]=1,d}if(h=a.match(br)){for(var $=h.slice(1,5),N=0;N<4;N++)$[N]=+$[N];return $}if(h=a.match(mi)){for(var A=h.slice(1,4),E=0;E<3;E++)A[E]=wi(A[E]*2.55);return A[3]=1,A}if(h=a.match(wr)){for(var T=h.slice(1,5),O=0;O<3;O++)T[O]=wi(T[O]*2.55);return T[3]=+T[3],T}if(h=a.match(bi)){var H=h.slice(1,4);H[1]*=.01,H[2]*=.01;var q=pi(H);return q[3]=1,q}if(h=a.match(yr)){var X=h.slice(1,4);X[1]*=.01,X[2]*=.01;var Z=pi(X);return Z[3]=+h[4],Z}};Sr.test=function(a){return vi.test(a)||br.test(a)||mi.test(a)||wr.test(a)||bi.test(a)||yr.test(a)};var yn=Sr,yi=j,Si=k,Ai=x,Sn=p.type,An=lt,Ci=yn;Si.prototype.css=function(a){return An(this._rgb,a)},yi.css=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Si,[null].concat(a,["css"])))},Ai.format.css=Ci,Ai.autodetect.push({p:5,test:function(a){for(var h=[],d=arguments.length-1;d-- >0;)h[d]=arguments[d+1];if(!h.length&&Sn(a)==="string"&&Ci.test(a))return"css"}});var Ar=k,Cn=j,$i=x,$n=p.unpack;$i.format.gl=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=$n(a,"rgba");return d[0]*=255,d[1]*=255,d[2]*=255,d},Cn.gl=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Ar,[null].concat(a,["gl"])))},Ar.prototype.gl=function(){var a=this._rgb;return[a[0]/255,a[1]/255,a[2]/255,a[3]]};var xi=p.unpack,xn=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=xi(a,"rgb"),y=d[0],$=d[1],N=d[2],A=Math.min(y,$,N),E=Math.max(y,$,N),T=E-A,O=T*100/255,H=A/(255-T)*100,q;return T===0?q=Number.NaN:(y===E&&(q=($-N)/T),$===E&&(q=2+(N-y)/T),N===E&&(q=4+(y-$)/T),q*=60,q<0&&(q+=360)),[q,O,H]},Ni=xn,Nn=p.unpack,Ri=Math.floor,Rn=function(){for(var a,h,d,y,$,N,A=[],E=arguments.length;E--;)A[E]=arguments[E];A=Nn(A,"hcg");var T=A[0],O=A[1],H=A[2],q,X,Z;H=H*255;var U=O*255;if(O===0)q=X=Z=H;else{T===360&&(T=0),T>360&&(T-=360),T<0&&(T+=360),T/=60;var te=Ri(T),le=T-te,ge=H*(1-O),ce=ge+U*(1-le),Be=ge+U*le,Te=ge+U;switch(te){case 0:a=[Te,Be,ge],q=a[0],X=a[1],Z=a[2];break;case 1:h=[ce,Te,ge],q=h[0],X=h[1],Z=h[2];break;case 2:d=[ge,Te,Be],q=d[0],X=d[1],Z=d[2];break;case 3:y=[ge,ce,Te],q=y[0],X=y[1],Z=y[2];break;case 4:$=[Be,ge,Te],q=$[0],X=$[1],Z=$[2];break;case 5:N=[Te,ge,ce],q=N[0],X=N[1],Z=N[2];break}}return[q,X,Z,A.length>3?A[3]:1]},ki=Rn,kn=p.unpack,En=p.type,Tn=j,Ei=k,Ti=x,Li=Ni;Ei.prototype.hcg=function(){return Li(this._rgb)},Tn.hcg=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Ei,[null].concat(a,["hcg"])))},Ti.format.hcg=ki,Ti.autodetect.push({p:1,test:function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];if(a=kn(a,"hcg"),En(a)==="array"&&a.length===3)return"hcg"}});var Ln=p.unpack,Kt=p.last,Ot=Math.round,Mi=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=Ln(a,"rgba"),y=d[0],$=d[1],N=d[2],A=d[3],E=Kt(a)||"auto";A===void 0&&(A=1),E==="auto"&&(E=A<1?"rgba":"rgb"),y=Ot(y),$=Ot($),N=Ot(N);var T=y<<16|$<<8|N,O="000000"+T.toString(16);O=O.substr(O.length-6);var H="0"+Ot(A*255).toString(16);switch(H=H.substr(H.length-2),E.toLowerCase()){case"rgba":return"#"+O+H;case"argb":return"#"+H+O;default:return"#"+O}},Bi=Mi,Ii=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,Pi=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,Mn=function(a){if(a.match(Ii)){(a.length===4||a.length===7)&&(a=a.substr(1)),a.length===3&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var h=parseInt(a,16),d=h>>16,y=h>>8&255,$=h&255;return[d,y,$,1]}if(a.match(Pi)){(a.length===5||a.length===9)&&(a=a.substr(1)),a.length===4&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]);var N=parseInt(a,16),A=N>>24&255,E=N>>16&255,T=N>>8&255,O=Math.round((N&255)/255*100)/100;return[A,E,T,O]}throw new Error("unknown hex color: "+a)},Di=Mn,Bn=j,Oi=k,In=p.type,Fi=x,Pn=Bi;Oi.prototype.hex=function(a){return Pn(this._rgb,a)},Bn.hex=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Oi,[null].concat(a,["hex"])))},Fi.format.hex=Di,Fi.autodetect.push({p:4,test:function(a){for(var h=[],d=arguments.length-1;d-- >0;)h[d]=arguments[d+1];if(!h.length&&In(a)==="string"&&[3,4,5,6,7,8,9].indexOf(a.length)>=0)return"hex"}});var Dn=p.unpack,zi=p.TWOPI,On=Math.min,Hi=Math.sqrt,Fn=Math.acos,_i=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=Dn(a,"rgb"),y=d[0],$=d[1],N=d[2];y/=255,$/=255,N/=255;var A,E=On(y,$,N),T=(y+$+N)/3,O=T>0?1-E/T:0;return O===0?A=NaN:(A=(y-$+(y-N))/2,A/=Hi((y-$)*(y-$)+(y-N)*($-N)),A=Fn(A),N>$&&(A=zi-A),A/=zi),[A*360,O,T]},zn=_i,Wi=p.unpack,Cr=p.limit,ht=p.TWOPI,$r=p.PITHIRD,ft=Math.cos,Hn=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];a=Wi(a,"hsi");var d=a[0],y=a[1],$=a[2],N,A,E;return isNaN(d)&&(d=0),isNaN(y)&&(y=0),d>360&&(d-=360),d<0&&(d+=360),d/=360,d<1/3?(E=(1-y)/3,N=(1+y*ft(ht*d)/ft($r-ht*d))/3,A=1-(E+N)):d<2/3?(d-=1/3,N=(1-y)/3,A=(1+y*ft(ht*d)/ft($r-ht*d))/3,E=1-(N+A)):(d-=2/3,A=(1-y)/3,E=(1+y*ft(ht*d)/ft($r-ht*d))/3,N=1-(A+E)),N=Cr($*N*3),A=Cr($*A*3),E=Cr($*E*3),[N*255,A*255,E*255,a.length>3?a[3]:1]},Xi=Hn,_n=p.unpack,Vi=p.type,Wn=j,xr=k,Yi=x,ji=zn;xr.prototype.hsi=function(){return ji(this._rgb)},Wn.hsi=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(xr,[null].concat(a,["hsi"])))},Yi.format.hsi=Xi,Yi.autodetect.push({p:2,test:function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];if(a=_n(a,"hsi"),Vi(a)==="array"&&a.length===3)return"hsi"}});var Xn=p.unpack,qi=p.type,Vn=j,Nr=k,Gi=x,Yn=Ct;Nr.prototype.hsl=function(){return Yn(this._rgb)},Vn.hsl=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Nr,[null].concat(a,["hsl"])))},Gi.format.hsl=vr,Gi.autodetect.push({p:2,test:function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];if(a=Xn(a,"hsl"),qi(a)==="array"&&a.length===3)return"hsl"}});var jn=p.unpack,qn=Math.min,Gn=Math.max,Un=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];a=jn(a,"rgb");var d=a[0],y=a[1],$=a[2],N=qn(d,y,$),A=Gn(d,y,$),E=A-N,T,O,H;return H=A/255,A===0?(T=Number.NaN,O=0):(O=E/A,d===A&&(T=(y-$)/E),y===A&&(T=2+($-d)/E),$===A&&(T=4+(d-y)/E),T*=60,T<0&&(T+=360)),[T,O,H]},Zn=Un,Kn=p.unpack,Jn=Math.floor,Qn=function(){for(var a,h,d,y,$,N,A=[],E=arguments.length;E--;)A[E]=arguments[E];A=Kn(A,"hsv");var T=A[0],O=A[1],H=A[2],q,X,Z;if(H*=255,O===0)q=X=Z=H;else{T===360&&(T=0),T>360&&(T-=360),T<0&&(T+=360),T/=60;var U=Jn(T),te=T-U,le=H*(1-O),ge=H*(1-O*te),ce=H*(1-O*(1-te));switch(U){case 0:a=[H,ce,le],q=a[0],X=a[1],Z=a[2];break;case 1:h=[ge,H,le],q=h[0],X=h[1],Z=h[2];break;case 2:d=[le,H,ce],q=d[0],X=d[1],Z=d[2];break;case 3:y=[le,ge,H],q=y[0],X=y[1],Z=y[2];break;case 4:$=[ce,le,H],q=$[0],X=$[1],Z=$[2];break;case 5:N=[H,le,ge],q=N[0],X=N[1],Z=N[2];break}}return[q,X,Z,A.length>3?A[3]:1]},ea=Qn,ta=p.unpack,ra=p.type,Ui=j,Zi=k,Rr=x,ia=Zn;Zi.prototype.hsv=function(){return ia(this._rgb)},Ui.hsv=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Zi,[null].concat(a,["hsv"])))},Rr.format.hsv=ea,Rr.autodetect.push({p:2,test:function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];if(a=ta(a,"hsv"),ra(a)==="array"&&a.length===3)return"hsv"}});var Ft={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},$t=Ft,Ki=p.unpack,Ji=Math.pow,Qi=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=Ki(a,"rgb"),y=d[0],$=d[1],N=d[2],A=sa(y,$,N),E=A[0],T=A[1],O=A[2],H=116*T-16;return[H<0?0:H,500*(E-T),200*(T-O)]},kr=function(a){return(a/=255)<=.04045?a/12.92:Ji((a+.055)/1.055,2.4)},Jt=function(a){return a>$t.t3?Ji(a,1/3):a/$t.t2+$t.t0},sa=function(a,h,d){a=kr(a),h=kr(h),d=kr(d);var y=Jt((.4124564*a+.3575761*h+.1804375*d)/$t.Xn),$=Jt((.2126729*a+.7151522*h+.072175*d)/$t.Yn),N=Jt((.0193339*a+.119192*h+.9503041*d)/$t.Zn);return[y,$,N]},Er=Qi,xt=Ft,es=p.unpack,na=Math.pow,aa=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];a=es(a,"lab");var d=a[0],y=a[1],$=a[2],N,A,E,T,O,H;return A=(d+16)/116,N=isNaN(y)?A:A+y/500,E=isNaN($)?A:A-$/200,A=xt.Yn*Lr(A),N=xt.Xn*Lr(N),E=xt.Zn*Lr(E),T=Tr(3.2404542*N-1.5371385*A-.4985314*E),O=Tr(-.969266*N+1.8760108*A+.041556*E),H=Tr(.0556434*N-.2040259*A+1.0572252*E),[T,O,H,a.length>3?a[3]:1]},Tr=function(a){return 255*(a<=.00304?12.92*a:1.055*na(a,1/2.4)-.055)},Lr=function(a){return a>xt.t1?a*a*a:xt.t2*(a-xt.t0)},ts=aa,rs=p.unpack,la=p.type,is=j,ss=k,Mr=x,oa=Er;ss.prototype.lab=function(){return oa(this._rgb)},is.lab=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(ss,[null].concat(a,["lab"])))},Mr.format.lab=ts,Mr.autodetect.push({p:2,test:function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];if(a=rs(a,"lab"),la(a)==="array"&&a.length===3)return"lab"}});var ns=p.unpack,ha=p.RAD2DEG,as=Math.sqrt,fa=Math.atan2,ls=Math.round,ga=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=ns(a,"lab"),y=d[0],$=d[1],N=d[2],A=as($*$+N*N),E=(fa(N,$)*ha+360)%360;return ls(A*1e4)===0&&(E=Number.NaN),[y,A,E]},Br=ga,ua=p.unpack,os=Er,ca=Br,hs=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=ua(a,"rgb"),y=d[0],$=d[1],N=d[2],A=os(y,$,N),E=A[0],T=A[1],O=A[2];return ca(E,T,O)},da=hs,pa=p.unpack,va=p.DEG2RAD,ma=Math.sin,ba=Math.cos,wa=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=pa(a,"lch"),y=d[0],$=d[1],N=d[2];return isNaN(N)&&(N=0),N=N*va,[y,ba(N)*$,ma(N)*$]},fs=wa,gs=p.unpack,ya=fs,Sa=ts,Aa=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];a=gs(a,"lch");var d=a[0],y=a[1],$=a[2],N=ya(d,y,$),A=N[0],E=N[1],T=N[2],O=Sa(A,E,T),H=O[0],q=O[1],X=O[2];return[H,q,X,a.length>3?a[3]:1]},us=Aa,Ca=p.unpack,cs=us,$a=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=Ca(a,"hcl").reverse();return cs.apply(void 0,d)},ds=$a,xa=p.unpack,Na=p.type,ps=j,Qt=k,qe=x,tt=da;Qt.prototype.lch=function(){return tt(this._rgb)},Qt.prototype.hcl=function(){return tt(this._rgb).reverse()},ps.lch=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Qt,[null].concat(a,["lch"])))},ps.hcl=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Qt,[null].concat(a,["hcl"])))},qe.format.lch=us,qe.format.hcl=ds,["lch","hcl"].forEach(function(a){return qe.autodetect.push({p:2,test:function(){for(var h=[],d=arguments.length;d--;)h[d]=arguments[d];if(h=xa(h,a),Na(h)==="array"&&h.length===3)return a}})});var We={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Fe=We,Ra=k,Ir=x,vs=p.type,Nt=Fe,ka=Di,ms=Bi;Ra.prototype.name=function(){for(var a=ms(this._rgb,"rgb"),h=0,d=Object.keys(Nt);h<d.length;h+=1){var y=d[h];if(Nt[y]===a)return y.toLowerCase()}return a},Ir.format.named=function(a){if(a=a.toLowerCase(),Nt[a])return ka(Nt[a]);throw new Error("unknown color name: "+a)},Ir.autodetect.push({p:5,test:function(a){for(var h=[],d=arguments.length-1;d-- >0;)h[d]=arguments[d+1];if(!h.length&&vs(a)==="string"&&Nt[a.toLowerCase()])return"named"}});var bs=p.unpack,ws=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=bs(a,"rgb"),y=d[0],$=d[1],N=d[2];return(y<<16)+($<<8)+N},Ea=ws,ys=p.type,Ta=function(a){if(ys(a)=="number"&&a>=0&&a<=16777215){var h=a>>16,d=a>>8&255,y=a&255;return[h,d,y,1]}throw new Error("unknown num color: "+a)},La=Ta,Ma=j,Pr=k,Ss=x,As=p.type,Ba=Ea;Pr.prototype.num=function(){return Ba(this._rgb)},Ma.num=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Pr,[null].concat(a,["num"])))},Ss.format.num=La,Ss.autodetect.push({p:5,test:function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];if(a.length===1&&As(a[0])==="number"&&a[0]>=0&&a[0]<=16777215)return"num"}});var Ia=j,Dr=k,Or=x,Fr=p.unpack,Cs=p.type,zr=Math.round;Dr.prototype.rgb=function(a){return a===void 0&&(a=!0),a===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(zr)},Dr.prototype.rgba=function(a){return a===void 0&&(a=!0),this._rgb.slice(0,4).map(function(h,d){return d<3?a===!1?h:zr(h):h})},Ia.rgb=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Dr,[null].concat(a,["rgb"])))},Or.format.rgb=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=Fr(a,"rgba");return d[3]===void 0&&(d[3]=1),d},Or.autodetect.push({p:3,test:function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];if(a=Fr(a,"rgba"),Cs(a)==="array"&&(a.length===3||a.length===4&&Cs(a[3])=="number"&&a[3]>=0&&a[3]<=1))return"rgb"}});var zt=Math.log,Pa=function(a){var h=a/100,d,y,$;return h<66?(d=255,y=h<6?0:-155.25485562709179-.44596950469579133*(y=h-2)+104.49216199393888*zt(y),$=h<20?0:-254.76935184120902+.8274096064007395*($=h-10)+115.67994401066147*zt($)):(d=351.97690566805693+.114206453784165*(d=h-55)-40.25366309332127*zt(d),y=325.4494125711974+.07943456536662342*(y=h-50)-28.0852963507957*zt(y),$=255),[d,y,$,1]},$s=Pa,Da=$s,Oa=p.unpack,Fa=Math.round,za=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];for(var d=Oa(a,"rgb"),y=d[0],$=d[2],N=1e3,A=4e4,E=.4,T;A-N>E;){T=(A+N)*.5;var O=Da(T);O[2]/O[0]>=$/y?A=T:N=T}return Fa(T)},Ha=za,Hr=j,gt=k,Rt=x,xs=Ha;gt.prototype.temp=gt.prototype.kelvin=gt.prototype.temperature=function(){return xs(this._rgb)},Hr.temp=Hr.kelvin=Hr.temperature=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(gt,[null].concat(a,["temp"])))},Rt.format.temp=Rt.format.kelvin=Rt.format.temperature=$s;var Ns=p.unpack,_r=Math.cbrt,er=Math.pow,tr=Math.sign,_a=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=Ns(a,"rgb"),y=d[0],$=d[1],N=d[2],A=[Xr(y/255),Xr($/255),Xr(N/255)],E=A[0],T=A[1],O=A[2],H=_r(.4122214708*E+.5363325363*T+.0514459929*O),q=_r(.2119034982*E+.6806995451*T+.1073969566*O),X=_r(.0883024619*E+.2817188376*T+.6299787005*O);return[.2104542553*H+.793617785*q-.0040720468*X,1.9779984951*H-2.428592205*q+.4505937099*X,.0259040371*H+.7827717662*q-.808675766*X]},Wr=_a;function Xr(a){var h=Math.abs(a);return h<.04045?a/12.92:(tr(a)||1)*er((h+.055)/1.055,2.4)}var Rs=p.unpack,rr=Math.pow,Wa=Math.sign,ks=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];a=Rs(a,"lab");var d=a[0],y=a[1],$=a[2],N=rr(d+.3963377774*y+.2158037573*$,3),A=rr(d-.1055613458*y-.0638541728*$,3),E=rr(d-.0894841775*y-1.291485548*$,3);return[255*Vr(4.0767416621*N-3.3077115913*A+.2309699292*E),255*Vr(-1.2684380046*N+2.6097574011*A-.3413193965*E),255*Vr(-.0041960863*N-.7034186147*A+1.707614701*E),a.length>3?a[3]:1]},Es=ks;function Vr(a){var h=Math.abs(a);return h>.0031308?(Wa(a)||1)*(1.055*rr(h,1/2.4)-.055):a*12.92}var Ts=p.unpack,Ls=p.type,Ms=j,Bs=k,Yr=x,Xa=Wr;Bs.prototype.oklab=function(){return Xa(this._rgb)},Ms.oklab=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(Bs,[null].concat(a,["oklab"])))},Yr.format.oklab=Es,Yr.autodetect.push({p:3,test:function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];if(a=Ts(a,"oklab"),Ls(a)==="array"&&a.length===3)return"oklab"}});var ir=p.unpack,Is=Wr,Ps=Br,Va=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];var d=ir(a,"rgb"),y=d[0],$=d[1],N=d[2],A=Is(y,$,N),E=A[0],T=A[1],O=A[2];return Ps(E,T,O)},Ds=Va,Ya=p.unpack,Os=fs,ja=Es,Fs=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];a=Ya(a,"lch");var d=a[0],y=a[1],$=a[2],N=Os(d,y,$),A=N[0],E=N[1],T=N[2],O=ja(A,E,T),H=O[0],q=O[1],X=O[2];return[H,q,X,a.length>3?a[3]:1]},qa=Fs,zs=p.unpack,Ga=p.type,Hs=j,_s=k,jr=x,Ua=Ds;_s.prototype.oklch=function(){return Ua(this._rgb)},Hs.oklch=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];return new(Function.prototype.bind.apply(_s,[null].concat(a,["oklch"])))},jr.format.oklch=qa,jr.autodetect.push({p:3,test:function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];if(a=zs(a,"oklch"),Ga(a)==="array"&&a.length===3)return"oklch"}});var qr=k,Za=p.type;qr.prototype.alpha=function(a,h){return h===void 0&&(h=!1),a!==void 0&&Za(a)==="number"?h?(this._rgb[3]=a,this):new qr([this._rgb[0],this._rgb[1],this._rgb[2],a],"rgb"):this._rgb[3]};var Ws=k;Ws.prototype.clipped=function(){return this._rgb._clipped||!1};var ut=k,Xs=Ft;ut.prototype.darken=function(a){a===void 0&&(a=1);var h=this,d=h.lab();return d[0]-=Xs.Kn*a,new ut(d,"lab").alpha(h.alpha(),!0)},ut.prototype.brighten=function(a){return a===void 0&&(a=1),this.darken(-a)},ut.prototype.darker=ut.prototype.darken,ut.prototype.brighter=ut.prototype.brighten;var Ka=k;Ka.prototype.get=function(a){var h=a.split("."),d=h[0],y=h[1],$=this[d]();if(y){var N=d.indexOf(y)-(d.substr(0,2)==="ok"?2:0);if(N>-1)return $[N];throw new Error("unknown channel "+y+" in mode "+d)}else return $};var ct=k,Ja=p.type,Vs=Math.pow,Qa=1e-7,Ys=20;ct.prototype.luminance=function(a){if(a!==void 0&&Ja(a)==="number"){if(a===0)return new ct([0,0,0,this._rgb[3]],"rgb");if(a===1)return new ct([255,255,255,this._rgb[3]],"rgb");var h=this.luminance(),d="rgb",y=Ys,$=function(A,E){var T=A.interpolate(E,.5,d),O=T.luminance();return Math.abs(a-O)<Qa||!y--?T:O>a?$(A,T):$(T,E)},N=(h>a?$(new ct([0,0,0]),this):$(this,new ct([255,255,255]))).rgb();return new ct(N.concat([this._rgb[3]]))}return el.apply(void 0,this._rgb.slice(0,3))};var el=function(a,h,d){return a=sr(a),h=sr(h),d=sr(d),.2126*a+.7152*h+.0722*d},sr=function(a){return a/=255,a<=.03928?a/12.92:Vs((a+.055)/1.055,2.4)},Pe={},Gr=k,js=p.type,Ht=Pe,qs=function(a,h,d){d===void 0&&(d=.5);for(var y=[],$=arguments.length-3;$-- >0;)y[$]=arguments[$+3];var N=y[0]||"lrgb";if(!Ht[N]&&!y.length&&(N=Object.keys(Ht)[0]),!Ht[N])throw new Error("interpolation mode "+N+" is not defined");return js(a)!=="object"&&(a=new Gr(a)),js(h)!=="object"&&(h=new Gr(h)),Ht[N](a,h,d).alpha(a.alpha()+d*(h.alpha()-a.alpha()))},Ur=k,tl=qs;Ur.prototype.mix=Ur.prototype.interpolate=function(a,h){h===void 0&&(h=.5);for(var d=[],y=arguments.length-2;y-- >0;)d[y]=arguments[y+2];return tl.apply(void 0,[this,a,h].concat(d))};var Zr=k;Zr.prototype.premultiply=function(a){a===void 0&&(a=!1);var h=this._rgb,d=h[3];return a?(this._rgb=[h[0]*d,h[1]*d,h[2]*d,d],this):new Zr([h[0]*d,h[1]*d,h[2]*d,d],"rgb")};var Kr=k,Gs=Ft;Kr.prototype.saturate=function(a){a===void 0&&(a=1);var h=this,d=h.lch();return d[1]+=Gs.Kn*a,d[1]<0&&(d[1]=0),new Kr(d,"lch").alpha(h.alpha(),!0)},Kr.prototype.desaturate=function(a){return a===void 0&&(a=1),this.saturate(-a)};var Us=k,Jr=p.type;Us.prototype.set=function(a,h,d){d===void 0&&(d=!1);var y=a.split("."),$=y[0],N=y[1],A=this[$]();if(N){var E=$.indexOf(N)-($.substr(0,2)==="ok"?2:0);if(E>-1){if(Jr(h)=="string")switch(h.charAt(0)){case"+":A[E]+=+h;break;case"-":A[E]+=+h;break;case"*":A[E]*=+h.substr(1);break;case"/":A[E]/=+h.substr(1);break;default:A[E]=+h}else if(Jr(h)==="number")A[E]=h;else throw new Error("unsupported value for Color.set");var T=new Us(A,$);return d?(this._rgb=T._rgb,this):T}throw new Error("unknown channel "+N+" in mode "+$)}else return A};var rl=k,Zs=function(a,h,d){var y=a._rgb,$=h._rgb;return new rl(y[0]+d*($[0]-y[0]),y[1]+d*($[1]-y[1]),y[2]+d*($[2]-y[2]),"rgb")};Pe.rgb=Zs;var il=k,nr=Math.sqrt,kt=Math.pow,Ks=function(a,h,d){var y=a._rgb,$=y[0],N=y[1],A=y[2],E=h._rgb,T=E[0],O=E[1],H=E[2];return new il(nr(kt($,2)*(1-d)+kt(T,2)*d),nr(kt(N,2)*(1-d)+kt(O,2)*d),nr(kt(A,2)*(1-d)+kt(H,2)*d),"rgb")};Pe.lrgb=Ks;var sl=k,Js=function(a,h,d){var y=a.lab(),$=h.lab();return new sl(y[0]+d*($[0]-y[0]),y[1]+d*($[1]-y[1]),y[2]+d*($[2]-y[2]),"lab")};Pe.lab=Js;var Qs=k,dt=function(a,h,d,y){var $,N,A,E;y==="hsl"?(A=a.hsl(),E=h.hsl()):y==="hsv"?(A=a.hsv(),E=h.hsv()):y==="hcg"?(A=a.hcg(),E=h.hcg()):y==="hsi"?(A=a.hsi(),E=h.hsi()):y==="lch"||y==="hcl"?(y="hcl",A=a.hcl(),E=h.hcl()):y==="oklch"&&(A=a.oklch().reverse(),E=h.oklch().reverse());var T,O,H,q,X,Z;(y.substr(0,1)==="h"||y==="oklch")&&($=A,T=$[0],H=$[1],X=$[2],N=E,O=N[0],q=N[1],Z=N[2]);var U,te,le,ge;return!isNaN(T)&&!isNaN(O)?(O>T&&O-T>180?ge=O-(T+360):O<T&&T-O>180?ge=O+360-T:ge=O-T,te=T+d*ge):isNaN(T)?isNaN(O)?te=Number.NaN:(te=O,(X==1||X==0)&&y!="hsv"&&(U=q)):(te=T,(Z==1||Z==0)&&y!="hsv"&&(U=H)),U===void 0&&(U=H+d*(q-H)),le=X+d*(Z-X),y==="oklch"?new Qs([le,U,te],y):new Qs([te,U,le],y)},nl=dt,Qr=function(a,h,d){return nl(a,h,d,"lch")};Pe.lch=Qr,Pe.hcl=Qr;var al=k,en=function(a,h,d){var y=a.num(),$=h.num();return new al(y+d*($-y),"num")};Pe.num=en;var ll=dt,tn=function(a,h,d){return ll(a,h,d,"hcg")};Pe.hcg=tn;var ol=dt,rn=function(a,h,d){return ol(a,h,d,"hsi")};Pe.hsi=rn;var hl=dt,sn=function(a,h,d){return hl(a,h,d,"hsl")};Pe.hsl=sn;var fl=dt,nn=function(a,h,d){return fl(a,h,d,"hsv")};Pe.hsv=nn;var gl=k,ul=function(a,h,d){var y=a.oklab(),$=h.oklab();return new gl(y[0]+d*($[0]-y[0]),y[1]+d*($[1]-y[1]),y[2]+d*($[2]-y[2]),"oklab")};Pe.oklab=ul;var an=dt,ln=function(a,h,d){return an(a,h,d,"oklch")};Pe.oklch=ln;var ei=k,cl=p.clip_rgb,ti=Math.pow,ri=Math.sqrt,ii=Math.PI,on=Math.cos,hn=Math.sin,dl=Math.atan2,pl=function(a,h,d){h===void 0&&(h="lrgb"),d===void 0&&(d=null);var y=a.length;d||(d=Array.from(new Array(y)).map(function(){return 1}));var $=y/d.reduce(function(te,le){return te+le});if(d.forEach(function(te,le){d[le]*=$}),a=a.map(function(te){return new ei(te)}),h==="lrgb")return vl(a,d);for(var N=a.shift(),A=N.get(h),E=[],T=0,O=0,H=0;H<A.length;H++)if(A[H]=(A[H]||0)*d[0],E.push(isNaN(A[H])?0:d[0]),h.charAt(H)==="h"&&!isNaN(A[H])){var q=A[H]/180*ii;T+=on(q)*d[0],O+=hn(q)*d[0]}var X=N.alpha()*d[0];a.forEach(function(te,le){var ge=te.get(h);X+=te.alpha()*d[le+1];for(var ce=0;ce<A.length;ce++)if(!isNaN(ge[ce]))if(E[ce]+=d[le+1],h.charAt(ce)==="h"){var Be=ge[ce]/180*ii;T+=on(Be)*d[le+1],O+=hn(Be)*d[le+1]}else A[ce]+=ge[ce]*d[le+1]});for(var Z=0;Z<A.length;Z++)if(h.charAt(Z)==="h"){for(var U=dl(O/E[Z],T/E[Z])/ii*180;U<0;)U+=360;for(;U>=360;)U-=360;A[Z]=U}else A[Z]=A[Z]/E[Z];return X/=y,new ei(A,h).alpha(X>.99999?1:X,!0)},vl=function(a,h){for(var d=a.length,y=[0,0,0,0],$=0;$<a.length;$++){var N=a[$],A=h[$]/d,E=N._rgb;y[0]+=ti(E[0],2)*A,y[1]+=ti(E[1],2)*A,y[2]+=ti(E[2],2)*A,y[3]+=E[3]*A}return y[0]=ri(y[0]),y[1]=ri(y[1]),y[2]=ri(y[2]),y[3]>.9999999&&(y[3]=1),new ei(cl(y))},Xe=j,Et=p.type,ml=Math.pow,si=function(a){var h="rgb",d=Xe("#ccc"),y=0,$=[0,1],N=[],A=[0,0],E=!1,T=[],O=!1,H=0,q=1,X=!1,Z={},U=!0,te=1,le=function(V){if(V=V||["#fff","#000"],V&&Et(V)==="string"&&Xe.brewer&&Xe.brewer[V.toLowerCase()]&&(V=Xe.brewer[V.toLowerCase()]),Et(V)==="array"){V.length===1&&(V=[V[0],V[0]]),V=V.slice(0);for(var J=0;J<V.length;J++)V[J]=Xe(V[J]);N.length=0;for(var ne=0;ne<V.length;ne++)N.push(ne/(V.length-1))}return ze(),T=V},ge=function(V){if(E!=null){for(var J=E.length-1,ne=0;ne<J&&V>=E[ne];)ne++;return ne-1}return 0},ce=function(V){return V},Be=function(V){return V},Te=function(V,J){var ne,re;if(J==null&&(J=!1),isNaN(V)||V===null)return d;if(J)re=V;else if(E&&E.length>2){var Ie=ge(V);re=Ie/(E.length-2)}else q!==H?re=(V-H)/(q-H):re=1;re=Be(re),J||(re=ce(re)),te!==1&&(re=ml(re,te)),re=A[0]+re*(1-A[0]-A[1]),re=Math.min(1,Math.max(0,re));var we=Math.floor(re*1e4);if(U&&Z[we])ne=Z[we];else{if(Et(T)==="array")for(var ue=0;ue<N.length;ue++){var de=N[ue];if(re<=de){ne=T[ue];break}if(re>=de&&ue===N.length-1){ne=T[ue];break}if(re>de&&re<N[ue+1]){re=(re-de)/(N[ue+1]-de),ne=Xe.interpolate(T[ue],T[ue+1],re,h);break}}else Et(T)==="function"&&(ne=T(re));U&&(Z[we]=ne)}return ne},ze=function(){return Z={}};le(a);var he=function(V){var J=Xe(Te(V));return O&&J[O]?J[O]():J};return he.classes=function(V){if(V!=null){if(Et(V)==="array")E=V,$=[V[0],V[V.length-1]];else{var J=Xe.analyze($);V===0?E=[J.min,J.max]:E=Xe.limits(J,"e",V)}return he}return E},he.domain=function(V){if(!arguments.length)return $;H=V[0],q=V[V.length-1],N=[];var J=T.length;if(V.length===J&&H!==q)for(var ne=0,re=Array.from(V);ne<re.length;ne+=1){var Ie=re[ne];N.push((Ie-H)/(q-H))}else{for(var we=0;we<J;we++)N.push(we/(J-1));if(V.length>2){var ue=V.map(function(pe,ve){return ve/(V.length-1)}),de=V.map(function(pe){return(pe-H)/(q-H)});de.every(function(pe,ve){return ue[ve]===pe})||(Be=function(pe){if(pe<=0||pe>=1)return pe;for(var ve=0;pe>=de[ve+1];)ve++;var it=(pe-de[ve])/(de[ve+1]-de[ve]),Tt=ue[ve]+it*(ue[ve+1]-ue[ve]);return Tt})}}return $=[H,q],he},he.mode=function(V){return arguments.length?(h=V,ze(),he):h},he.range=function(V,J){return le(V),he},he.out=function(V){return O=V,he},he.spread=function(V){return arguments.length?(y=V,he):y},he.correctLightness=function(V){return V==null&&(V=!0),X=V,ze(),X?ce=function(J){for(var ne=Te(0,!0).lab()[0],re=Te(1,!0).lab()[0],Ie=ne>re,we=Te(J,!0).lab()[0],ue=ne+(re-ne)*J,de=we-ue,pe=0,ve=1,it=20;Math.abs(de)>.01&&it-- >0;)(function(){return Ie&&(de*=-1),de<0?(pe=J,J+=(ve-J)*.5):(ve=J,J+=(pe-J)*.5),we=Te(J,!0).lab()[0],de=we-ue})();return J}:ce=function(J){return J},he},he.padding=function(V){return V!=null?(Et(V)==="number"&&(V=[V,V]),A=V,he):A},he.colors=function(V,J){arguments.length<2&&(J="hex");var ne=[];if(arguments.length===0)ne=T.slice(0);else if(V===1)ne=[he(.5)];else if(V>1){var re=$[0],Ie=$[1]-re;ne=bl(0,V,!1).map(function(ve){return he(re+ve/(V-1)*Ie)})}else{a=[];var we=[];if(E&&E.length>2)for(var ue=1,de=E.length,pe=1<=de;pe?ue<de:ue>de;pe?ue++:ue--)we.push((E[ue-1]+E[ue])*.5);else we=$;ne=we.map(function(ve){return he(ve)})}return Xe[J]&&(ne=ne.map(function(ve){return ve[J]()})),ne},he.cache=function(V){return V!=null?(U=V,he):U},he.gamma=function(V){return V!=null?(te=V,he):te},he.nodata=function(V){return V!=null?(d=Xe(V),he):d},he};function bl(a,h,d){for(var y=[],$=a<h,N=d?$?h+1:h-1:h,A=a;$?A<N:A>N;$?A++:A--)y.push(A);return y}var _t=k,n=si,fe=function(a){for(var h=[1,1],d=1;d<a;d++){for(var y=[1],$=1;$<=h.length;$++)y[$]=(h[$]||0)+h[$-1];h=y}return h},ar=function(a){var h,d,y,$,N,A,E;if(a=a.map(function(X){return new _t(X)}),a.length===2)h=a.map(function(X){return X.lab()}),N=h[0],A=h[1],$=function(X){var Z=[0,1,2].map(function(U){return N[U]+X*(A[U]-N[U])});return new _t(Z,"lab")};else if(a.length===3)d=a.map(function(X){return X.lab()}),N=d[0],A=d[1],E=d[2],$=function(X){var Z=[0,1,2].map(function(U){return(1-X)*(1-X)*N[U]+2*(1-X)*X*A[U]+X*X*E[U]});return new _t(Z,"lab")};else if(a.length===4){var T;y=a.map(function(X){return X.lab()}),N=y[0],A=y[1],E=y[2],T=y[3],$=function(X){var Z=[0,1,2].map(function(U){return(1-X)*(1-X)*(1-X)*N[U]+3*(1-X)*(1-X)*X*A[U]+3*(1-X)*X*X*E[U]+X*X*X*T[U]});return new _t(Z,"lab")}}else if(a.length>=5){var O,H,q;O=a.map(function(X){return X.lab()}),q=a.length-1,H=fe(q),$=function(X){var Z=1-X,U=[0,1,2].map(function(te){return O.reduce(function(le,ge,ce){return le+H[ce]*Math.pow(Z,q-ce)*Math.pow(X,ce)*ge[te]},0)});return new _t(U,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return $},Ge=function(a){var h=ar(a);return h.scale=function(){return n(h)},h},Wt=j,C=function(a,h,d){if(!C[d])throw new Error("unknown blend mode "+d);return C[d](a,h)},Ve=function(a){return function(h,d){var y=Wt(d).rgb(),$=Wt(h).rgb();return Wt.rgb(a(y,$))}},pt=function(a){return function(h,d){var y=[];return y[0]=a(h[0],d[0]),y[1]=a(h[1],d[1]),y[2]=a(h[2],d[2]),y}},Fl=function(a){return a},zl=function(a,h){return a*h/255},Hl=function(a,h){return a>h?h:a},B=function(a,h){return a>h?a:h},Se=function(a,h){return 255*(1-(1-a/255)*(1-h/255))},_l=function(a,h){return h<128?2*a*h/255:255*(1-2*(1-a/255)*(1-h/255))},wl=function(a,h){return 255*(1-(1-h/255)/(a/255))},lr=function(a,h){return a===255?255:(a=255*(h/255)/(1-a/255),a>255?255:a)};C.normal=Ve(pt(Fl)),C.multiply=Ve(pt(zl)),C.screen=Ve(pt(Se)),C.overlay=Ve(pt(_l)),C.darken=Ve(pt(Hl)),C.lighten=Ve(pt(B)),C.dodge=Ve(pt(lr)),C.burn=Ve(pt(wl));for(var fn=C,vt=p.type,R=p.clip_rgb,yl=p.TWOPI,gn=Math.pow,un=Math.sin,ni=Math.cos,mt=j,Sl=function(a,h,d,y,$){a===void 0&&(a=300),h===void 0&&(h=-1.5),d===void 0&&(d=1),y===void 0&&(y=1),$===void 0&&($=[0,1]);var N=0,A;vt($)==="array"?A=$[1]-$[0]:(A=0,$=[$,$]);var E=function(T){var O=yl*((a+120)/360+h*T),H=gn($[0]+A*T,y),q=N!==0?d[0]+T*N:d,X=q*H*(1-H)/2,Z=ni(O),U=un(O),te=H+X*(-.14861*Z+1.78277*U),le=H+X*(-.29227*Z-.90649*U),ge=H+X*(1.97294*Z);return mt(R([te*255,le*255,ge*255,1]))};return E.start=function(T){return T==null?a:(a=T,E)},E.rotations=function(T){return T==null?h:(h=T,E)},E.gamma=function(T){return T==null?y:(y=T,E)},E.hue=function(T){return T==null?d:(d=T,vt(d)==="array"?(N=d[1]-d[0],N===0&&(d=d[1])):N=0,E)},E.lightness=function(T){return T==null?$:(vt(T)==="array"?($=T,A=T[1]-T[0]):($=[T,T],A=0),E)},E.scale=function(){return mt.scale(E)},E.hue(d),E},or=k,Al="0123456789abcdef",Cl=Math.floor,$l=Math.random,xl=function(){for(var a="#",h=0;h<6;h++)a+=Al.charAt(Cl($l()*16));return new or(a,"hex")},hr=f,ai=Math.log,Nl=Math.pow,cn=Math.floor,Rl=Math.abs,dn=function(a,h){h===void 0&&(h=null);var d={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return hr(a)==="object"&&(a=Object.values(a)),a.forEach(function(y){h&&hr(y)==="object"&&(y=y[h]),y!=null&&!isNaN(y)&&(d.values.push(y),d.sum+=y,y<d.min&&(d.min=y),y>d.max&&(d.max=y),d.count+=1)}),d.domain=[d.min,d.max],d.limits=function(y,$){return pn(d,y,$)},d},pn=function(a,h,d){h===void 0&&(h="equal"),d===void 0&&(d=7),hr(a)=="array"&&(a=dn(a));var y=a.min,$=a.max,N=a.values.sort(function(Ml,Bl){return Ml-Bl});if(d===1)return[y,$];var A=[];if(h.substr(0,1)==="c"&&(A.push(y),A.push($)),h.substr(0,1)==="e"){A.push(y);for(var E=1;E<d;E++)A.push(y+E/d*($-y));A.push($)}else if(h.substr(0,1)==="l"){if(y<=0)throw new Error("Logarithmic scales are only possible for values > 0");var T=Math.LOG10E*ai(y),O=Math.LOG10E*ai($);A.push(y);for(var H=1;H<d;H++)A.push(Nl(10,T+H/d*(O-T)));A.push($)}else if(h.substr(0,1)==="q"){A.push(y);for(var q=1;q<d;q++){var X=(N.length-1)*q/d,Z=cn(X);if(Z===X)A.push(N[Z]);else{var U=X-Z;A.push(N[Z]*(1-U)+N[Z+1]*U)}}A.push($)}else if(h.substr(0,1)==="k"){var te,le=N.length,ge=new Array(le),ce=new Array(d),Be=!0,Te=0,ze=null;ze=[],ze.push(y);for(var he=1;he<d;he++)ze.push(y+he/d*($-y));for(ze.push($);Be;){for(var V=0;V<d;V++)ce[V]=0;for(var J=0;J<le;J++)for(var ne=N[J],re=Number.MAX_VALUE,Ie=void 0,we=0;we<d;we++){var ue=Rl(ze[we]-ne);ue<re&&(re=ue,Ie=we),ce[Ie]++,ge[J]=Ie}for(var de=new Array(d),pe=0;pe<d;pe++)de[pe]=null;for(var ve=0;ve<le;ve++)te=ge[ve],de[te]===null?de[te]=N[ve]:de[te]+=N[ve];for(var it=0;it<d;it++)de[it]*=1/ce[it];Be=!1;for(var Tt=0;Tt<d;Tt++)if(de[Tt]!==ze[Tt]){Be=!0;break}ze=de,Te++,Te>200&&(Be=!1)}for(var Lt={},gr=0;gr<d;gr++)Lt[gr]=[];for(var ur=0;ur<le;ur++)te=ge[ur],Lt[te].push(N[ur]);for(var wt=[],Yt=0;Yt<d;Yt++)wt.push(Lt[Yt][0]),wt.push(Lt[Yt][Lt[Yt].length-1]);wt=wt.sort(function(Ml,Bl){return Ml-Bl}),A.push(wt[0]);for(var hi=1;hi<wt.length;hi+=2){var jt=wt[hi];!isNaN(jt)&&A.indexOf(jt)===-1&&A.push(jt)}}return A},vn={analyze:dn,limits:pn},mn=k,kl=function(a,h){a=new mn(a),h=new mn(h);var d=a.luminance(),y=h.luminance();return d>y?(d+.05)/(y+.05):(y+.05)/(d+.05)},bn=k,rt=Math.sqrt,Ce=Math.pow,wn=Math.min,El=Math.max,li=Math.atan2,Xt=Math.abs,Vt=Math.cos,oi=Math.sin,Tl=Math.exp,u=Math.PI,o=function(a,h,d,y,$){d===void 0&&(d=1),y===void 0&&(y=1),$===void 0&&($=1);var N=function(jt){return 360*jt/(2*u)},A=function(jt){return 2*u*jt/360};a=new bn(a),h=new bn(h);var E=Array.from(a.lab()),T=E[0],O=E[1],H=E[2],q=Array.from(h.lab()),X=q[0],Z=q[1],U=q[2],te=(T+X)/2,le=rt(Ce(O,2)+Ce(H,2)),ge=rt(Ce(Z,2)+Ce(U,2)),ce=(le+ge)/2,Be=.5*(1-rt(Ce(ce,7)/(Ce(ce,7)+Ce(25,7)))),Te=O*(1+Be),ze=Z*(1+Be),he=rt(Ce(Te,2)+Ce(H,2)),V=rt(Ce(ze,2)+Ce(U,2)),J=(he+V)/2,ne=N(li(H,Te)),re=N(li(U,ze)),Ie=ne>=0?ne:ne+360,we=re>=0?re:re+360,ue=Xt(Ie-we)>180?(Ie+we+360)/2:(Ie+we)/2,de=1-.17*Vt(A(ue-30))+.24*Vt(A(2*ue))+.32*Vt(A(3*ue+6))-.2*Vt(A(4*ue-63)),pe=we-Ie;pe=Xt(pe)<=180?pe:we<=Ie?pe+360:pe-360,pe=2*rt(he*V)*oi(A(pe)/2);var ve=X-T,it=V-he,Tt=1+.015*Ce(te-50,2)/rt(20+Ce(te-50,2)),Lt=1+.045*J,gr=1+.015*J*de,ur=30*Tl(-Ce((ue-275)/25,2)),wt=2*rt(Ce(J,7)/(Ce(J,7)+Ce(25,7))),Yt=-wt*oi(2*A(ur)),hi=rt(Ce(ve/(d*Tt),2)+Ce(it/(y*Lt),2)+Ce(pe/($*gr),2)+Yt*(it/(y*Lt))*(pe/($*gr)));return El(0,wn(100,hi))},w=k,v=function(a,h,d){d===void 0&&(d="lab"),a=new w(a),h=new w(h);var y=a.get(d),$=h.get(d),N=0;for(var A in y){var E=(y[A]||0)-($[A]||0);N+=E*E}return Math.sqrt(N)},I=k,Y=function(){for(var a=[],h=arguments.length;h--;)a[h]=arguments[h];try{return new(Function.prototype.bind.apply(I,[null].concat(a))),!0}catch(d){return!1}},G=j,xe=si,fr={cool:function(){return xe([G.hsl(180,1,.9),G.hsl(250,.7,.4)])},hot:function(){return xe(["#000","#f00","#ff0","#fff"]).mode("rgb")}},bt={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Ll=0,Wl=Object.keys(bt);Ll<Wl.length;Ll+=1){var Xl=Wl[Ll];bt[Xl.toLowerCase()]=bt[Xl]}var Gl=bt,Ee=j;Ee.average=pl,Ee.bezier=Ge,Ee.blend=fn,Ee.cubehelix=Sl,Ee.mix=Ee.interpolate=qs,Ee.random=xl,Ee.scale=si,Ee.analyze=vn.analyze,Ee.contrast=kl,Ee.deltaE=o,Ee.distance=v,Ee.limits=vn.limits,Ee.valid=Y,Ee.scales=fr,Ee.colors=Fe,Ee.brewer=Gl;var Ul=Ee;return Ul})});var be=class L{static clone(t){let i=Array.isArray(t)?[]:{};for(let r in t){let s=t[r];typeof s.clone=="function"?i[r]=s.clone():i[r]=typeof s=="object"?L.clone(s):s}return i}static equals(t,i){if(t.length!==i.length)return!1;let r=t.slice().sort(),s=i.slice().sort();for(let e=0;e<r.length;e++)if(r[e]!==s[e])return!1;return!0}static print(t){if(t.length==0)return"";let i="(";for(let r=0;r<t.length;r++)i+=t[r].id?t[r].id+", ":t[r]+", ";return i=i.substring(0,i.length-2),i+")"}static each(t,i){for(let r=0;r<t.length;r++)i(t[r])}static get(t,i,r){for(let s=0;s<t.length;s++)if(t[s][i]==r)return t[s]}static contains(t,i){if(!i.property&&!i.func){for(let r=0;r<t.length;r++)if(t[r]==i.value)return!0}else if(i.func){for(let r=0;r<t.length;r++)if(i.func(t[r]))return!0}else for(let r=0;r<t.length;r++)if(t[r][i.property]==i.value)return!0;return!1}static intersection(t,i){let r=[];for(let s=0;s<t.length;s++)for(let e=0;e<i.length;e++)t[s]===i[e]&&r.push(t[s]);return r}static unique(t){let i={};return t.filter(function(r){return i[r]!==void 0?!1:i[r]=!0})}static count(t,i){let r=0;for(let s=0;s<t.length;s++)t[s]===i&&r++;return r}static toggle(t,i){let r=[],s=!1;for(let e=0;e<t.length;e++)t[e]!==i?r.push(t[e]):s=!0;return s||r.push(i),r}static remove(t,i){let r=[];for(let s=0;s<t.length;s++)t[s]!==i&&r.push(t[s]);return r}static removeUnique(t,i){let r=t.indexOf(i);return r>-1&&t.splice(r,1),t}static removeAll(t,i){return t.filter(function(r){return i.indexOf(r)===-1})}static merge(t,i){let r=new Array(t.length+i.length);for(let s=0;s<t.length;s++)r[s]=t[s];for(let s=0;s<i.length;s++)r[t.length+s]=i[s];return r}static containsAll(t,i){let r=0;for(let s=0;s<t.length;s++)for(let e=0;e<i.length;e++)t[s]===i[e]&&r++;return r===i.length}static sortByAtomicNumberDesc(t){let i=t.map(function(r,s){return{index:s,value:r.atomicNumber.split(".").map(Number)}});return i.sort(function(r,s){let e=Math.min(s.value.length,r.value.length),l=0;for(;l<e&&s.value[l]===r.value[l];)l++;return l===e?s.value.length-r.value.length:s.value[l]-r.value[l]}),i.map(function(r){return t[r.index]})}static deepCopy(t){let i=[];for(let r=0;r<t.length;r++){let s=t[r];s instanceof Array?i[r]=L.deepCopy(s):i[r]=s}return i}};var Ue=class L{constructor(t,i="-"){this.idx=null,this.element=t.length===1?t.toUpperCase():t,this.drawExplicit=!1,this.ringbonds=[],this.rings=[],this.bondType=i,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=[],this.bridgedRing=null,this.anchoredRings=[],this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=[],this.isPartOfAromaticRing=t!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1,this.class=void 0}addNeighbouringElement(t){this.neighbouringElements.push(t)}attachPseudoElement(t,i,r=0,s=0){r===null&&(r=0),s===null&&(s=0);let e=r+t+s;this.attachedPseudoElements[e]?this.attachedPseudoElements[e].count+=1:this.attachedPseudoElements[e]={element:t,count:1,hydrogenCount:r,previousElement:i,charge:s},this.hasAttachedPseudoElements=!0}getAttachedPseudoElements(){let t={};return Object.keys(this.attachedPseudoElements).sort().forEach(i=>{t[i]=this.attachedPseudoElements[i]}),t}getAttachedPseudoElementsCount(){return Object.keys(this.attachedPseudoElements).length}isHeteroAtom(){return this.element!=="C"&&this.element!=="H"}addAnchoredRing(t){be.contains(this.anchoredRings,{value:t})||this.anchoredRings.push(t)}getRingbondCount(){return this.ringbonds.length}backupRings(){this.originalRings=Array(this.rings.length);for(let t=0;t<this.rings.length;t++)this.originalRings[t]=this.rings[t]}restoreRings(){this.rings=Array(this.originalRings.length);for(let t=0;t<this.originalRings.length;t++)this.rings[t]=this.originalRings[t]}haveCommonRingbond(t,i){for(let r=0;r<t.ringbonds.length;r++)for(let s=0;s<i.ringbonds.length;s++)if(t.ringbonds[r].id==i.ringbonds[s].id)return!0;return!1}neighbouringElementsEqual(t){if(t.length!==this.neighbouringElements.length)return!1;t.sort(),this.neighbouringElements.sort();for(let i=0;i<this.neighbouringElements.length;i++)if(t[i]!==this.neighbouringElements[i])return!1;return!0}getAtomicNumber(){return L.atomicNumbers[this.element]}getMaxBonds(){return L.maxBonds[this.element]}static get maxBonds(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}static get atomicNumbers(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}};var P=class L{constructor(t,i){arguments.length==0?(this.x=0,this.y=0):t instanceof L?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i)}clone(){return new L(this.x,this.y)}toString(){return"("+this.x+","+this.y+")"}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}divide(t){return this.x/=t,this.y/=t,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}invert(){return this.x=-this.x,this.y=-this.y,this}angle(){return Math.atan2(this.y,this.x)}distance(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))}distanceSq(t){return(t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)}clockwise(t){let i=this.y*t.x,r=this.x*t.y;return i>r?-1:i===r?0:1}relativeClockwise(t,i){let r=(this.y-t.y)*(i.x-t.x),s=(this.x-t.x)*(i.y-t.y);return r>s?-1:r===s?0:1}rotate(t){let i=new L(0,0),r=Math.cos(t),s=Math.sin(t);return i.x=this.x*r-this.y*s,i.y=this.x*s+this.y*r,this.x=i.x,this.y=i.y,this}rotateAround(t,i){let r=Math.sin(t),s=Math.cos(t);this.x-=i.x,this.y-=i.y;let e=this.x*s-this.y*r,l=this.x*r+this.y*s;return this.x=e+i.x,this.y=l+i.y,this}rotateTo(t,i,r=0){this.x+=.001,this.y-=.001;let s=L.subtract(this,i),e=L.subtract(t,i),l=L.angle(e,s);return this.rotateAround(l+r,i),this}rotateAwayFrom(t,i,r){this.rotateAround(r,i);let s=this.distanceSq(t);this.rotateAround(-2*r,i),this.distanceSq(t)<s&&this.rotateAround(2*r,i)}getRotateAwayFromAngle(t,i,r){let s=this.clone();s.rotateAround(r,i);let e=s.distanceSq(t);return s.rotateAround(-2*r,i),s.distanceSq(t)<e?r:-r}getRotateTowardsAngle(t,i,r){let s=this.clone();s.rotateAround(r,i);let e=s.distanceSq(t);return s.rotateAround(-2*r,i),s.distanceSq(t)>e?r:-r}getRotateToAngle(t,i){let r=L.subtract(this,i),s=L.subtract(t,i),e=L.angle(s,r);return Number.isNaN(e)?0:e}isInPolygon(t){let i=!1;for(let r=0,s=t.length-1;r<t.length;s=r++){let e=t[r],l=t[s];e.y>this.y!=l.y>this.y&&this.x<(l.x-e.x)*(this.y-e.y)/(l.y-e.y)+e.x&&(i=!i)}return i}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){return this.divide(this.length()),this}normalized(){return L.divideScalar(this,this.length())}whichSide(t,i){return(this.x-t.x)*(i.y-t.y)-(this.y-t.y)*(i.x-t.x)}sameSideAs(t,i,r){let s=this.whichSide(t,i),e=r.whichSide(t,i);return s<0&&e<0||s==0&&e==0||s>0&&e>0}static add(t,i){return new L(t.x+i.x,t.y+i.y)}static subtract(t,i){return new L(t.x-i.x,t.y-i.y)}static multiply(t,i){return new L(t.x*i.x,t.y*i.y)}static multiplyScalar(t,i){return new L(t.x,t.y).multiplyScalar(i)}static midpoint(t,i){return new L((t.x+i.x)/2,(t.y+i.y)/2)}static normals(t,i){let r=L.subtract(i,t);return[new L(-r.y,r.x),new L(r.y,-r.x)]}static units(t,i){let r=L.subtract(i,t);return[new L(-r.y,r.x).normalize(),new L(r.y,-r.x).normalize()]}static divide(t,i){return new L(t.x/i.x,t.y/i.y)}static divideScalar(t,i){return new L(t.x/i,t.y/i)}static dot(t,i){return t.x*i.x+t.y*i.y}static angle(t,i){let r=L.dot(t,i);return Math.acos(r/(t.length()*i.length()))}static threePointangle(t,i,r){let s=L.subtract(i,t),e=L.subtract(r,i),l=t.distance(i),f=i.distance(r);return Math.acos(L.dot(s,e)/(l*f))}static scalarProjection(t,i){let r=i.normalized();return L.dot(t,r)}static averageDirection(t){let i=new L(0,0);for(let r=0;r<t.length;r++){let s=t[r];i.add(s)}return i.normalize()}};var ee=class L{constructor(t=new P(0,0),i=new P(0,0),r=null,s=null,e=!1,l=!1){this.from=t,this.to=i,this.elementFrom=r,this.elementTo=s,this.chiralFrom=e,this.chiralTo=l}clone(){return new L(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}getLength(){let t=this.to.x-this.from.x,i=this.to.y-this.from.y;return Math.sqrt(t*t+i*i)}getAngle(){return P.subtract(this.getRightVector(),this.getLeftVector()).angle()}getRightVector(){return this.from.x<this.to.x?this.to:this.from}getLeftVector(){return this.from.x<this.to.x?this.from:this.to}getRightElement(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}getLeftElement(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}getRightChiral(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}getLeftChiral(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}setRightVector(t,i){return this.from.x<this.to.x?(this.to.x=t,this.to.y=i):(this.from.x=t,this.from.y=i),this}setLeftVector(t,i){return this.from.x<this.to.x?(this.from.x=t,this.from.y=i):(this.to.x=t,this.to.y=i),this}rotateToXAxis(){let t=this.getLeftVector();return this.setRightVector(t.x+this.getLength(),t.y),this}rotate(t){let i=this.getLeftVector(),r=this.getRightVector(),s=Math.sin(t),e=Math.cos(t),l=e*(r.x-i.x)-s*(r.y-i.y)+i.x,f=s*(r.x-i.x)-e*(r.y-i.y)+i.y;return this.setRightVector(l,f),this}shortenFrom(t){let i=P.subtract(this.to,this.from);return i.normalize(),i.multiplyScalar(t),this.from.add(i),this}shortenTo(t){let i=P.subtract(this.from,this.to);return i.normalize(),i.multiplyScalar(t),this.to.add(i),this}shortenRight(t){return this.from.x<this.to.x?this.shortenTo(t):this.shortenFrom(t),this}shortenLeft(t){return this.from.x<this.to.x?this.shortenFrom(t):this.shortenTo(t),this}shorten(t){let i=P.subtract(this.from,this.to);return i.normalize(),i.multiplyScalar(t/2),this.to.add(i),this.from.subtract(i),this}};var ie=class L{static round(t,i){if(i){let r=Math.pow(10,i);return Math.round(t*r)/r}else return Math.round(t)}static meanAngle(t){let i=0,r=0;for(let s=0;s<t.length;s++)i+=Math.sin(t[s]),r+=Math.cos(t[s]);return Math.atan2(i/t.length,r/t.length)}static innerAngle(t){return L.toRad((t-2)*180/t)}static polyCircumradius(t,i){return t/(2*Math.sin(Math.PI/i))}static apothem(t,i){return t*Math.cos(Math.PI/i)}static apothemFromSideLength(t,i){let r=L.polyCircumradius(t,i);return L.apothem(r,i)}static centralAngle(t){return L.toRad(360/t)}static toDeg(t){return t*L.degFactor}static toRad(t){return t*L.radFactor}static parityOfPermutation(t){let i=new Uint8Array(t.length),r=0,s=function(e,l=0){return i[e]===1?l:(l++,i[e]=1,s(t[e],l))};for(let e=0;e<t.length;e++){if(i[e]===1)continue;let l=s(e);r+=1-l%2}return r%2?-1:1}static get radFactor(){return Math.PI/180}static get degFactor(){return 180/Math.PI}static get twoPI(){return 2*Math.PI}};var fi=class L{constructor(t,i=0,r=0){this.id=null,this.value=t,this.position=new P(i||0,r||0),this.previousPosition=new P(0,0),this.parentVertexId=null,this.children=[],this.spanningTreeChildren=[],this.edges=[],this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=[],this.neighbouringElements=[],this.forcePositioned=!1}setPosition(t,i){this.position.x=t,this.position.y=i}setPositionFromVector(t){this.position.x=t.x,this.position.y=t.y}addChild(t){this.children.push(t),this.neighbours.push(t),this.neighbourCount++}addRingbondChild(t,i){if(this.children.push(t),this.value.bracket){let r=1;this.id===0&&this.value.bracket.hcount===0&&(r=0),this.value.bracket.hcount===1&&i===0&&(r=2),this.value.bracket.hcount===1&&i===1&&(this.neighbours.length<3?r=2:r=3),this.value.bracket.hcount===null&&i===0&&(r=1),this.value.bracket.hcount===null&&i===1&&(this.neighbours.length<3?r=1:r=2),this.neighbours.splice(r,0,t)}else this.neighbours.push(t);this.neighbourCount++}setParentVertexId(t){this.neighbourCount++,this.parentVertexId=t,this.neighbours.push(t)}isTerminal(){return this.value.hasAttachedPseudoElements?!0:this.parentVertexId===null&&this.children.length<2||this.children.length===0}clone(){let t=new L(this.value,this.position.x,this.position.y);return t.id=this.id,t.previousPosition=new P(this.previousPosition.x,this.previousPosition.y),t.parentVertexId=this.parentVertexId,t.children=be.clone(this.children),t.spanningTreeChildren=be.clone(this.spanningTreeChildren),t.edges=be.clone(this.edges),t.positioned=this.positioned,t.angle=this.angle,t.forcePositioned=this.forcePositioned,t}equals(t){return this.id===t.id}getAngle(t=null,i=!1){let r=null;return t?r=P.subtract(this.position,t):r=P.subtract(this.position,this.previousPosition),i?ie.toDeg(r.angle()):r.angle()}getTextDirection(t,i=!1){let r=this.getDrawnNeighbours(t),s=[];if(t.length===1)return"right";for(let l=0;l<r.length;l++)s.push(this.getAngle(t[r[l]].position));let e=ie.meanAngle(s);if(this.isTerminal()||i)Math.round(e*100)/100===1.57&&(e=e-.2),e=Math.round(Math.round(e/Math.PI)*Math.PI);else{let l=Math.PI/2;e=Math.round(Math.round(e/l)*l)}return e===2?"down":e===-2?"up":e===0?"right":e===3||e===-3?"left":"down"}getNeighbours(t=null){if(t===null)return this.neighbours.slice();let i=[];for(let r=0;r<this.neighbours.length;r++)this.neighbours[r]!==t&&i.push(this.neighbours[r]);return i}getDrawnNeighbours(t){let i=[];for(let r=0;r<this.neighbours.length;r++)t[this.neighbours[r]].value.isDrawn&&i.push(this.neighbours[r]);return i}getNeighbourCount(){return this.neighbourCount}getSpanningTreeNeighbours(t=null){let i=[];for(let r=0;r<this.spanningTreeChildren.length;r++)(t===void 0||t!=this.spanningTreeChildren[r])&&i.push(this.spanningTreeChildren[r]);return this.parentVertexId!=null&&(t===void 0||t!=this.parentVertexId)&&i.push(this.parentVertexId),i}getNextInRing(t,i,r){let s=this.getNeighbours();for(let e=0;e<s.length;e++)if(be.contains(t[s[e]].value.rings,{value:i})&&s[e]!=r)return s[e];return null}};var nt=class{constructor(t,i){this.id=null,this.firstRingId=t.id,this.secondRingId=i.id,this.vertices=new Set;for(let r=0;r<t.members.length;r++){let s=t.members[r];for(let e=0;e<i.members.length;e++){let l=i.members[e];s===l&&this.addVertex(s)}}}addVertex(t){this.vertices.add(t)}updateOther(t,i){this.firstRingId===i?this.secondRingId=t:this.firstRingId=t}containsRing(t){return this.firstRingId===t||this.secondRingId===t}isBridge(t){if(this.vertices.size>2)return!0;for(let i of this.vertices)if(t[i].value.rings.length>2)return!0;return!1}static isBridge(t,i,r,s){let e=null;for(let l=0;l<t.length;l++)if(e=t[l],e.firstRingId===r&&e.secondRingId===s||e.firstRingId===s&&e.secondRingId===r)return e.isBridge(i);return!1}static getNeighbours(t,i){let r=[];for(let s=0;s<t.length;s++){let e=t[s];e.firstRingId===i?r.push(e.secondRingId):e.secondRingId===i&&r.push(e.firstRingId)}return r}static getVertices(t,i,r){for(let s=0;s<t.length;s++){let e=t[s];if(e.firstRingId===i&&e.secondRingId===r||e.firstRingId===r&&e.secondRingId===i)return[...e.vertices]}}};var cr=class L{constructor(t){this.id=null,this.members=t,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new P(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}clone(){let t=new L(this.members);return t.id=this.id,t.insiders=be.clone(this.insiders),t.neighbours=be.clone(this.neighbours),t.positioned=this.positioned,t.center=this.center.clone(),t.rings=be.clone(this.rings),t.isBridged=this.isBridged,t.isPartOfBridged=this.isPartOfBridged,t.isSpiro=this.isSpiro,t.isFused=this.isFused,t.centralAngle=this.centralAngle,t.canFlip=this.canFlip,t}getSize(){return this.members.length}getPolygon(t){let i=[];for(let r=0;r<this.members.length;r++)i.push(t[this.members[r]].position);return i}getAngle(){return Math.PI-this.centralAngle}eachMember(t,i,r,s){r=r||r===0?r:this.members[0];let e=r,l=0;for(;e!=null&&l<100;){let f=e;i(f),e=t[e].getNextInRing(t,this.id,s),s=f,e==r&&(e=null),l++}}getOrderedNeighbours(t){let i=Array(this.neighbours.length);for(let r=0;r<this.neighbours.length;r++){let s=nt.getVertices(t,this.id,this.neighbours[r]);i[r]={n:s.length,neighbour:this.neighbours[r]}}return i.sort((r,s)=>s.n-r.n),i}isBenzeneLike(t){let i=this.getDoubleBondCount(t),r=this.members.length;return i===3&&r===6||i===2&&r===5}getDoubleBondCount(t){let i=0;for(let r=0;r<this.members.length;r++){let s=t[this.members[r]].value;(s.bondType==="="||s.branchBond==="=")&&i++}return i}contains(t){for(let i=0;i<this.members.length;i++)if(this.members[i]==t)return!0;return!1}};var yt=class{constructor(t,i){this.colors=t,this.theme=this.colors[i]}getColor(t){return t&&(t=t.toUpperCase(),t in this.theme)?this.theme[t]:this.theme.C}setTheme(t){t in this.colors&&(this.theme=this.colors[t])}};function Yl(L){return L?L===1?"+":L===-1?"-":L>0?L+"+":L+"-":""}var gi=class{constructor(t,i,r){let s=null;if(t instanceof String?s=document.getElementById(t.valueOf()):typeof t=="string"?s=document.getElementById(t):s=t,s instanceof HTMLCanvasElement)this.canvas=s;else throw Error("First argument was not a canvas or the ID of a canvas.");this.ctx=this.canvas.getContext("2d"),this.themeManager=i,this.opts=r,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}updateSize(t,i){this.ratio=window.devicePixelRatio||1,this.ratio!==1?(this.canvas.width=t*this.ratio,this.canvas.height=i*this.ratio,this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0)):(this.canvas.width=t*this.ratio,this.canvas.height=i*this.ratio)}setTheme(t){this.colors=t}scale(t){let i=-Number.MAX_VALUE,r=-Number.MAX_VALUE,s=Number.MAX_VALUE,e=Number.MAX_VALUE;for(let m=0;m<t.length;m++){if(!t[m].value.isDrawn)continue;let b=t[m].position;i<b.x&&(i=b.x),r<b.y&&(r=b.y),s>b.x&&(s=b.x),e>b.y&&(e=b.y)}let l=this.opts.padding;i+=l,r+=l,s-=l,e-=l,this.drawingWidth=i-s,this.drawingHeight=r-e;let f=this.canvas.offsetWidth/this.drawingWidth,g=this.canvas.offsetHeight/this.drawingHeight,c=f<g?f:g;this.ctx.scale(c,c),this.offsetX=-s,this.offsetY=-e,f<g?this.offsetY+=this.canvas.offsetHeight/(2*c)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*c)-this.drawingWidth/2}reset(){this.ctx.setTransform(1,0,0,1,0,0)}getColor(t){return t=t.toUpperCase(),t in this.colors?this.colors[t]:this.colors.C}drawCircle(t,i,r,s,e=!0,l=!1,f=""){let g=this.ctx,c=this.offsetX,m=this.offsetY;g.save(),g.lineWidth=1.5,g.beginPath(),g.arc(t+c,i+m,r,0,ie.twoPI,!0),g.closePath(),l?(e?(g.fillStyle="#f00",g.fill()):(g.strokeStyle="#f00",g.stroke()),this.drawDebugText(t,i,f)):e?(g.fillStyle=s,g.fill()):(g.strokeStyle=s,g.stroke()),g.restore()}drawLine(t,i=!1,r=1){let s=this.ctx,e=this.offsetX,l=this.offsetY,f=t.clone().shorten(4),g=f.getLeftVector().clone(),c=f.getRightVector().clone();g.x+=e,g.y+=l,c.x+=e,c.y+=l,i||(s.save(),s.globalCompositeOperation="destination-out",s.beginPath(),s.moveTo(g.x,g.y),s.lineTo(c.x,c.y),s.lineCap="round",s.lineWidth=this.opts.bondThickness+1.2,s.strokeStyle=this.themeManager.getColor("BACKGROUND"),s.stroke(),s.globalCompositeOperation="source-over",s.restore()),g=t.getLeftVector().clone(),c=t.getRightVector().clone(),g.x+=e,g.y+=l,c.x+=e,c.y+=l,s.save(),s.beginPath(),s.moveTo(g.x,g.y),s.lineTo(c.x,c.y),s.lineCap="round",s.lineWidth=this.opts.bondThickness;let m=this.ctx.createLinearGradient(g.x,g.y,c.x,c.y);m.addColorStop(.4,this.themeManager.getColor(t.getLeftElement())||this.themeManager.getColor("C")),m.addColorStop(.6,this.themeManager.getColor(t.getRightElement())||this.themeManager.getColor("C")),i&&(s.setLineDash([1,1.5]),s.lineWidth=this.opts.bondThickness/1.5),r<1&&(s.globalAlpha=r),s.strokeStyle=m,s.stroke(),s.restore()}drawWedge(t,i=1){if(isNaN(t.from.x)||isNaN(t.from.y)||isNaN(t.to.x)||isNaN(t.to.y))return;let r=this.ctx,s=this.offsetX,e=this.offsetY,l=t.clone().shorten(5),f=l.getLeftVector().clone(),g=l.getRightVector().clone();f.x+=s,f.y+=e,g.x+=s,g.y+=e,f=t.getLeftVector().clone(),g=t.getRightVector().clone(),f.x+=s,f.y+=e,g.x+=s,g.y+=e,r.save();let c=P.normals(f,g);c[0].normalize(),c[1].normalize();let m=t.getRightChiral(),b=f,S=g;m&&(b=g,S=f);let p=P.add(b,P.multiplyScalar(c[0],this.halfBondThickness)),x=P.add(S,P.multiplyScalar(c[0],1.5+this.halfBondThickness)),D=P.add(S,P.multiplyScalar(c[1],1.5+this.halfBondThickness)),M=P.add(b,P.multiplyScalar(c[1],this.halfBondThickness));r.beginPath(),r.moveTo(p.x,p.y),r.lineTo(x.x,x.y),r.lineTo(D.x,D.y),r.lineTo(M.x,M.y);let z=this.ctx.createRadialGradient(g.x,g.y,this.opts.bondLength,g.x,g.y,0);z.addColorStop(.4,this.themeManager.getColor(t.getLeftElement())||this.themeManager.getColor("C")),z.addColorStop(.6,this.themeManager.getColor(t.getRightElement())||this.themeManager.getColor("C")),r.fillStyle=z,r.fill(),r.restore()}drawDashedWedge(t){if(isNaN(t.from.x)||isNaN(t.from.y)||isNaN(t.to.x)||isNaN(t.to.y))return;let i=this.ctx,r=this.offsetX,s=this.offsetY,e=t.getLeftVector().clone(),l=t.getRightVector().clone();e.x+=r,e.y+=s,l.x+=r,l.y+=s,i.save();let f=P.normals(e,l);f[0].normalize(),f[1].normalize();let g=t.getRightChiral(),c,m,b,S,p=t.clone();g?(c=l,m=e,p.shortenRight(1),b=p.getRightVector().clone(),S=p.getLeftVector().clone()):(c=e,m=l,p.shortenLeft(1),b=p.getLeftVector().clone(),S=p.getRightVector().clone()),b.x+=r,b.y+=s,S.x+=r,S.y+=s;let x=P.subtract(m,c).normalize();i.strokeStyle=this.themeManager.getColor("C"),i.lineCap="round",i.lineWidth=this.opts.bondThickness,i.beginPath();let D=t.getLength(),M=1.25/(D/(this.opts.bondThickness*3)),z=!1;for(let W=0;W<1;W+=M){let F=P.multiplyScalar(x,W*D),k=P.add(c,F),_=1.5*W,j=P.multiplyScalar(f[0],_);!z&&W>.5&&(i.stroke(),i.beginPath(),i.strokeStyle=this.themeManager.getColor(t.getRightElement())||this.themeManager.getColor("C"),z=!0),k.subtract(j),i.moveTo(k.x,k.y),k.add(P.multiplyScalar(j,2)),i.lineTo(k.x,k.y)}i.stroke(),i.restore()}drawDebugText(t,i,r){let s=this.ctx;s.save(),s.font="5px Droid Sans, sans-serif",s.textAlign="start",s.textBaseline="top",s.fillStyle="#ff0000",s.fillText(r,t+this.offsetX,i+this.offsetY),s.restore()}drawBall(t,i,r){let s=this.ctx;s.save(),s.beginPath(),s.arc(t+this.offsetX,i+this.offsetY,this.opts.bondLength/4.5,0,ie.twoPI,!1),s.fillStyle=this.themeManager.getColor(r),s.fill(),s.restore()}drawPoint(t,i,r){let s=this.ctx,e=this.offsetX,l=this.offsetY;s.save(),s.globalCompositeOperation="destination-out",s.beginPath(),s.arc(t+e,i+l,1.5,0,ie.twoPI,!0),s.closePath(),s.fill(),s.globalCompositeOperation="source-over",s.beginPath(),s.arc(t+this.offsetX,i+this.offsetY,.75,0,ie.twoPI,!1),s.fillStyle=this.themeManager.getColor(r),s.fill(),s.restore()}drawText(t,i,r,s,e,l,f,g,c,m={}){let b=this.ctx,S=this.offsetX,p=this.offsetY;b.save(),b.textAlign="start",b.textBaseline="alphabetic";let x=!1,D="",M=0;f&&(D=Yl(f),b.font=this.fontSmall,M=b.measureText(D).width);let z="0",W=0;g>0&&(z=g.toString(),b.font=this.fontSmall,W=b.measureText(z).width),f===1&&r==="N"&&"0O"in m&&"0O-1"in m&&(m={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},f=0),b.font=this.fontLarge,b.fillStyle=this.themeManager.getColor("BACKGROUND");let F=b.measureText(r),k=F.width>this.opts.fontSizeLarge?F.width:this.opts.fontSizeLarge;k/=1.5,b.globalCompositeOperation="destination-out",b.beginPath(),b.arc(t+S,i+p,k,0,ie.twoPI,!0),b.closePath(),b.fill(),b.globalCompositeOperation="source-over";let _=-F.width/2,j=-F.width/2;b.fillStyle=this.themeManager.getColor(r),b.fillText(r,t+S+_,i+this.opts.halfFontSizeLarge+p),_+=F.width,f&&(b.font=this.fontSmall,b.fillText(D,t+S+_,i-this.opts.fifthFontSizeSmall+p),_+=M),g>0&&(b.font=this.fontSmall,b.fillText(z,t+S+j-W,i-this.opts.fifthFontSizeSmall+p),j-=W),b.font=this.fontLarge;let Q=0,oe=0;if(s===1){let ae=t+S,Ae=i+p+this.opts.halfFontSizeLarge;Q=this.hydrogenWidth,j-=Q,e==="left"?ae+=j:e==="right"||e==="up"&&l||e==="down"&&l?ae+=_:e==="up"&&!l?(Ae-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ae-=this.halfHydrogenWidth):e==="down"&&!l&&(Ae+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ae-=this.halfHydrogenWidth),b.fillText("H",ae,Ae),_+=Q}else if(s>1){let ae=t+S,Ae=i+p+this.opts.halfFontSizeLarge;Q=this.hydrogenWidth,b.font=this.fontSmall,oe=b.measureText(s.toString()).width,j-=Q+oe,e==="left"?ae+=j:e==="right"||e==="up"&&l||e==="down"&&l?ae+=_:e==="up"&&!l?(Ae-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ae-=this.halfHydrogenWidth):e==="down"&&!l&&(Ae+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ae-=this.halfHydrogenWidth),b.font=this.fontLarge,b.fillText("H",ae,Ae),b.font=this.fontSmall,b.fillText(s.toString(),ae+this.halfHydrogenWidth+oe,Ae+this.opts.fifthFontSizeSmall),_+=Q+this.halfHydrogenWidth+oe}if(x){b.restore();return}for(let ae of Object.keys(m)){let Ae=0,Ke=0,Je=m[ae].element,Le=m[ae].count,Ne=m[ae].hydrogenCount,Ye=m[ae].charge;b.font=this.fontLarge,Le>1&&Ne>0&&(Ae=b.measureText("(").width,Ke=b.measureText(")").width);let He=b.measureText(Je).width,Qe=0,_e="",K=0;Q=0,Ne>0&&(Q=this.hydrogenWidth),b.font=this.fontSmall,Le>1&&(Qe=b.measureText(Le).width),Ye!==0&&(_e=Yl(Ye),K=b.measureText(_e).width),oe=0,Ne>1&&(oe=b.measureText(Ne).width),b.font=this.fontLarge;let se=t+S,me=i+p+this.opts.halfFontSizeLarge;b.fillStyle=this.themeManager.getColor(Je),Le>0&&(j-=Qe),Le>1&&Ne>0&&(e==="left"?(j-=Ke,b.fillText(")",se+j,me)):(b.fillText("(",se+_,me),_+=Ae)),e==="left"?(j-=He,b.fillText(Je,se+j,me)):(b.fillText(Je,se+_,me),_+=He),Ne>0&&(e==="left"?(j-=Q+oe,b.fillText("H",se+j,me),Ne>1&&(b.font=this.fontSmall,b.fillText(Ne,se+j+Q,me+this.opts.fifthFontSizeSmall))):(b.fillText("H",se+_,me),_+=Q,Ne>1&&(b.font=this.fontSmall,b.fillText(Ne,se+_,me+this.opts.fifthFontSizeSmall),_+=oe))),b.font=this.fontLarge,Le>1&&Ne>0&&(e==="left"?(j-=Ae,b.fillText("(",se+j,me)):(b.fillText(")",se+_,me),_+=Ke)),b.font=this.fontSmall,Le>1&&(e==="left"?b.fillText(Le,se+j+Ae+Ke+Q+oe+He,me+this.opts.fifthFontSizeSmall):(b.fillText(Le,se+_,me+this.opts.fifthFontSizeSmall),_+=Qe)),Ye!==0&&(e==="left"?b.fillText(_e,se+j+Ae+Ke+Q+oe+He,i-this.opts.fifthFontSizeSmall+p):(b.fillText(_e,se+_,i-this.opts.fifthFontSizeSmall+p),_+=K))}b.restore()}drawDebugPoint(t,i,r="",s="#f00"){this.drawCircle(t,i,2,s,!0,!0,r)}drawAromaticityRing(t){let i=this.ctx,r=ie.apothemFromSideLength(this.opts.bondLength,t.getSize());i.save(),i.strokeStyle=this.themeManager.getColor("C"),i.lineWidth=this.opts.bondThickness,i.beginPath(),i.arc(t.center.x+this.offsetX,t.center.y+this.offsetY,r-this.opts.bondSpacing,0,Math.PI*2,!0),i.closePath(),i.stroke(),i.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}};var qt=class L{constructor(t,i,r=1){this.id=null,this.sourceId=t,this.targetId=i,this.weight=r,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}setBondType(t){this.bondType=t,this.weight=L.bonds[t]}static get bonds(){return{".":0,"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}};var Mt=class L{constructor(t,i=!1){this.vertices=[],this.edges=[],this.atomIdxToVertexId=[],this.vertexIdsToEdgeId={},this.isomeric=i,this._atomIdx=0,this._time=0,this._init(t)}_init(t,i=0,r=null,s=!1){let e=t.atom.element?t.atom.element:t.atom,l=new Ue(e,t.bond);(e!=="H"||!t.hasNext&&r===null)&&(l.idx=this._atomIdx,this._atomIdx++),l.branchBond=t.branchBond,l.ringbonds=t.ringbonds,l.bracket=t.atom.element?t.atom:null,l.class=t.atom.class;let f=new fi(l),g=this.vertices[r];if(this.addVertex(f),l.idx!==null&&this.atomIdxToVertexId.push(f.id),r!==null){f.setParentVertexId(r),f.value.addNeighbouringElement(g.value.element),g.addChild(f.id),g.value.addNeighbouringElement(l.element),g.spanningTreeChildren.push(f.id);let b=new qt(r,f.id,1);s?b.setBondType(f.value.branchBond||"-"):b.setBondType(g.value.bondType||"-"),this.addEdge(b)}let c=t.ringbondCount+1;l.bracket&&(c+=l.bracket.hcount);let m=0;if(l.bracket&&l.bracket.chirality){l.isStereoCenter=!0,m=l.bracket.hcount;for(let b=0;b<m;b++)this._init({atom:"H",isBracket:"false",branches:[],branchCount:0,ringbonds:[],ringbondCount:!1,next:null,hasNext:!1,bond:"-"},b,f.id,!0)}for(let b=0;b<t.branchCount;b++)this._init(t.branches[b],b+c,f.id,!0);t.hasNext&&this._init(t.next,t.branchCount+c,f.id)}clear(){this.vertices=[],this.edges=[],this.vertexIdsToEdgeId={}}addVertex(t){return t.id=this.vertices.length,this.vertices.push(t),t.id}addEdge(t){let i=this.vertices[t.sourceId],r=this.vertices[t.targetId];return t.id=this.edges.length,this.edges.push(t),this.vertexIdsToEdgeId[t.sourceId+"_"+t.targetId]=t.id,this.vertexIdsToEdgeId[t.targetId+"_"+t.sourceId]=t.id,t.isPartOfAromaticRing=i.value.isPartOfAromaticRing&&r.value.isPartOfAromaticRing,i.value.bondCount+=t.weight,r.value.bondCount+=t.weight,i.edges.push(t.id),r.edges.push(t.id),t.id}getEdge(t,i){let r=this.vertexIdsToEdgeId[t+"_"+i];return r===void 0?null:this.edges[r]}getEdges(t){let i=[],r=this.vertices[t];for(let s=0;s<r.neighbours.length;s++)i.push(this.vertexIdsToEdgeId[t+"_"+r.neighbours[s]]);return i}hasEdge(t,i){return this.vertexIdsToEdgeId[t+"_"+i]!==void 0}getVertexList(){let t=[this.vertices.length];for(let i=0;i<this.vertices.length;i++)t[i]=this.vertices[i].id;return t}getEdgeList(){let t=Array(this.edges.length);for(let i=0;i<this.edges.length;i++)t[i]=[this.edges[i].sourceId,this.edges[i].targetId];return t}getAdjacencyMatrix(){let t=this.vertices.length,i=Array(t);for(let r=0;r<t;r++)i[r]=new Array(t),i[r].fill(0);for(let r=0;r<this.edges.length;r++){let s=this.edges[r];i[s.sourceId][s.targetId]=1,i[s.targetId][s.sourceId]=1}return i}getComponentsAdjacencyMatrix(){let t=this.vertices.length,i=Array(t),r=this.getBridges();for(let s=0;s<t;s++)i[s]=new Array(t),i[s].fill(0);for(let s=0;s<this.edges.length;s++){let e=this.edges[s];i[e.sourceId][e.targetId]=1,i[e.targetId][e.sourceId]=1}for(let s=0;s<r.length;s++)i[r[s][0]][r[s][1]]=0,i[r[s][1]][r[s][0]]=0;return i}getSubgraphAdjacencyMatrix(t){let i=t.length,r=Array(i);for(let s=0;s<i;s++){r[s]=new Array(i),r[s].fill(0);for(let e=0;e<i;e++)s!==e&&this.hasEdge(t[s],t[e])&&(r[s][e]=1)}return r}getDistanceMatrix(){let t=this.vertices.length,i=this.getAdjacencyMatrix(),r=Array(t);for(let s=0;s<t;s++)r[s]=Array(t),r[s].fill(1/0);for(let s=0;s<t;s++)for(let e=0;e<t;e++)i[s][e]===1&&(r[s][e]=1);for(let s=0;s<t;s++)for(let e=0;e<t;e++)for(let l=0;l<t;l++)r[e][l]>r[e][s]+r[s][l]&&(r[e][l]=r[e][s]+r[s][l]);return r}getSubgraphDistanceMatrix(t){let i=t.length,r=this.getSubgraphAdjacencyMatrix(t),s=Array(i);for(let e=0;e<i;e++)s[e]=Array(i),s[e].fill(1/0);for(let e=0;e<i;e++)for(let l=0;l<i;l++)r[e][l]===1&&(s[e][l]=1);for(let e=0;e<i;e++)for(let l=0;l<i;l++)for(let f=0;f<i;f++)s[l][f]>s[l][e]+s[e][f]&&(s[l][f]=s[l][e]+s[e][f]);return s}getAdjacencyList(){let t=this.vertices.length,i=Array(t);for(let r=0;r<t;r++){i[r]=[];for(let s=0;s<t;s++)r!==s&&this.hasEdge(this.vertices[r].id,this.vertices[s].id)&&i[r].push(s)}return i}getSubgraphAdjacencyList(t){let i=t.length,r=Array(i);for(let s=0;s<i;s++){r[s]=[];for(let e=0;e<i;e++)s!==e&&this.hasEdge(t[s],t[e])&&r[s].push(e)}return r}getBridges(){let t=this.vertices.length,i=new Array(t),r=new Array(t),s=new Array(t),e=new Array(t),l=this.getAdjacencyList(),f=[];i.fill(!1),e.fill(null),this._time=0;for(let g=0;g<t;g++)i[g]||this._bridgeDfs(g,i,r,s,e,l,f);return f}traverseBF(t,i){let r=this.vertices.length,s=new Array(r);s.fill(!1);let e=[t];for(;e.length>0;){let l=e.shift(),f=this.vertices[l];i(f);for(let g=0;g<f.neighbours.length;g++){let c=f.neighbours[g];s[c]||(s[c]=!0,e.push(c))}}}getTreeDepth(t,i){if(t===null||i===null)return 0;let r=this.vertices[t].getSpanningTreeNeighbours(i),s=0;for(let e=0;e<r.length;e++){let l=r[e],f=this.getTreeDepth(l,t);f>s&&(s=f)}return s+1}traverseTree(t,i,r,s=999999,e=!1,l=1,f=null){if(f===null&&(f=new Uint8Array(this.vertices.length)),l>s+1||f[t]===1)return;f[t]=1;let g=this.vertices[t],c=g.getNeighbours(i);(!e||l>1)&&r(g);for(let m=0;m<c.length;m++)this.traverseTree(c[m],t,r,s,e,l+1,f)}kkLayout(t,i,r,s,e,l=.1,f=.1,g=2e3,c=50,m=1e9){let b=e,S=this.getSubgraphDistanceMatrix(t),p=t.length,x=ie.polyCircumradius(500,p),D=ie.centralAngle(p),M=0,z=new Float32Array(p),W=new Float32Array(p),F=Array(p);for(var k=p;k--;){let K=this.vertices[t[k]];K.positioned?(z[k]=K.position.x,W[k]=K.position.y):(z[k]=i.x+Math.cos(M)*x,W[k]=i.y+Math.sin(M)*x),F[k]=K.positioned,M+=D}let _=Array(p);for(k=p;k--;){_[k]=new Array(p);let K=p;for(;K--;)_[k][K]=e*S[k][K]}let j=Array(p);for(k=p;k--;){j[k]=Array(p);let K=p;for(;K--;)j[k][K]=b*Math.pow(S[k][K],-2)}let Q=Array(p),oe=new Float32Array(p),ae=new Float32Array(p);for(k=p;k--;)Q[k]=Array(p);for(k=p;k--;){let K=z[k],se=W[k],me=0,ke=0,ye=p;for(;ye--;){if(k===ye)continue;let Re=z[ye],$e=W[ye],Me=1/Math.sqrt((K-Re)*(K-Re)+(se-$e)*(se-$e));Q[k][ye]=[j[k][ye]*(K-Re-_[k][ye]*(K-Re)*Me),j[k][ye]*(se-$e-_[k][ye]*(se-$e)*Me)],Q[ye][k]=Q[k][ye],me+=Q[k][ye][0],ke+=Q[k][ye][1]}oe[k]=me,ae[k]=ke}let Ae=function(K){return[oe[K]*oe[K]+ae[K]*ae[K],oe[K],ae[K]]},Ke=function(){let K=0,se=0,me=0,ke=0;for(k=p;k--;){let[ye,Re,$e]=Ae(k);ye>K&&F[k]===!1&&(K=ye,se=k,me=Re,ke=$e)}return[se,K,me,ke]},Je=function(K,se,me){let ke=0,ye=0,Re=0,$e=z[K],Me=W[K],Ct=_[K],It=j[K];for(k=p;k--;){if(k===K)continue;let De=z[k],Oe=W[k],lt=Ct[k],ot=It[k],je=($e-De)*($e-De),Dt=1/Math.pow(je+(Me-Oe)*(Me-Oe),1.5);ke+=ot*(1-lt*(Me-Oe)*(Me-Oe)*Dt),ye+=ot*(1-lt*je*Dt),Re+=ot*(lt*($e-De)*(Me-Oe)*Dt)}ke===0&&(ke=.1),ye===0&&(ye=.1),Re===0&&(Re=.1);let et=se/ke+me/Re;et/=Re/ke-ye/Re;let at=-(Re*et+se)/ke;z[K]+=at,W[K]+=et;let Pt=Q[K];for(se=0,me=0,$e=z[K],Me=W[K],k=p;k--;){if(K===k)continue;let De=z[k],Oe=W[k],lt=Pt[k][0],ot=Pt[k][1],je=1/Math.sqrt(($e-De)*($e-De)+(Me-Oe)*(Me-Oe));at=It[k]*($e-De-Ct[k]*($e-De)*je),et=It[k]*(Me-Oe-Ct[k]*(Me-Oe)*je),Pt[k]=[at,et],se+=at,me+=et,oe[k]+=at-lt,ae[k]+=et-ot}oe[K]=se,ae[K]=me},Le=0,Ne=0,Ye=0,He=0,Qe=0,_e=0;for(;m>l&&g>Qe;)for(Qe++,[Le,m,Ne,Ye]=Ke(),He=m,_e=0;He>f&&c>_e;)_e++,Je(Le,Ne,Ye),[He,Ne,Ye]=Ae(Le);for(k=p;k--;){let K=t[k],se=this.vertices[K];se.position.x=z[k],se.position.y=W[k],se.positioned=!0,se.forcePositioned=!0}}_bridgeDfs(t,i,r,s,e,l,f){i[t]=!0,r[t]=s[t]=++this._time;for(let g=0;g<l[t].length;g++){let c=l[t][g];i[c]?c!==e[t]&&(s[t]=Math.min(s[t],r[c])):(e[c]=t,this._bridgeDfs(c,i,r,s,e,l,f),s[t]=Math.min(s[t],s[c]),s[c]>r[t]&&f.push([t,c]))}}static getConnectedComponents(t){let i=t.length,r=new Array(i),s=[];r.fill(!1);for(let e=0;e<i;e++)if(!r[e]){let l=[];r[e]=!0,l.push(e),L._ccGetDfs(e,r,t,l),l.length>1&&s.push(l)}return s}static getConnectedComponentCount(t){let i=t.length,r=new Array(i),s=0;r.fill(!1);for(let e=0;e<i;e++)r[e]||(r[e]=!0,s++,L._ccCountDfs(e,r,t));return s}static _ccCountDfs(t,i,r){for(let s=0;s<r[t].length;s++)!r[t][s]||i[s]||t===s||(i[s]=!0,L._ccCountDfs(s,i,r))}static _ccGetDfs(t,i,r,s){for(let e=0;e<r[t].length;e++)!r[t][e]||i[e]||t===e||(i[e]=!0,s.push(e),L._ccGetDfs(e,i,r,s))}};var St=class L{static extend(){let t={},i=!1,r=0,s=arguments.length;Object.prototype.toString.call(arguments[0])==="[object Boolean]"&&(i=arguments[0],r++);let e=function(l){for(let f in l)Object.prototype.hasOwnProperty.call(l,f)&&(i&&Object.prototype.toString.call(l[f])==="[object Object]"?t[f]=L.extend(!0,t[f],l[f]):t[f]=l[f])};for(;r<s;r++){let l=arguments[r];e(l)}return t}};var ui=class L{static getRings(t,i=!1){let r=t.getComponentsAdjacencyMatrix();if(r.length===0)return null;let s=Mt.getConnectedComponents(r),e=[];for(let l=0;l<s.length;l++){let f=s[l],g=t.getSubgraphAdjacencyMatrix([...f]),c=new Uint16Array(g.length),m=new Uint16Array(g.length);for(let F=0;F<g.length;F++){m[F]=0,c[F]=0;for(let k=0;k<g[F].length;k++)c[F]+=g[F][k]}let b=0;for(let F=0;F<g.length;F++)for(let k=F+1;k<g.length;k++)b+=g[F][k];let S=b-g.length+1,p=!0;for(let F=0;F<c.length;F++)c[F]!==3&&(p=!1);if(p&&(S=2+b-g.length),S===1){e.push([...f]);continue}i&&(S=999);let{d:x,pe:D,pe_prime:M}=L.getPathIncludedDistanceMatrices(g),z=L.getRingCandidates(x,D,M),W=L.getSSSR(z,x,g,D,M,c,m,S);for(let F=0;F<W.length;F++){let k=Array(W[F].size),_=0;for(let j of W[F])k[_++]=f[j];e.push(k)}}return e}static matrixToString(t){let i="";for(let r=0;r<t.length;r++){for(let s=0;s<t[r].length;s++)i+=t[r][s]+" ";i+=`
`}return i}static getPathIncludedDistanceMatrices(t){let i=t.length,r=Array(i),s=Array(i),e=Array(i);var l=0,f=0,g=0,c=0,m=0,b=0;for(l=i;l--;)for(r[l]=Array(i),s[l]=Array(i),e[l]=Array(i),f=i;f--;)r[l][f]=l===f||t[l][f]===1?t[l][f]:Number.POSITIVE_INFINITY,r[l][f]===1?s[l][f]=[[[l,f]]]:s[l][f]=[],e[l][f]=[];for(g=i;g--;)for(l=i;l--;)for(f=i;f--;){let S=r[l][f],p=r[l][g]+r[g][f];if(S>p){if(S===p+1)for(e[l][f]=[s[l][f].length],c=s[l][f].length;c--;)for(e[l][f][c]=[s[l][f][c].length],m=s[l][f][c].length;m--;)for(e[l][f][c][m]=[s[l][f][c][m].length],b=s[l][f][c][m].length;b--;)e[l][f][c][m][b]=[s[l][f][c][m][0],s[l][f][c][m][1]];else e[l][f]=[];for(r[l][f]=p,s[l][f]=[[]],c=s[l][g][0].length;c--;)s[l][f][0].push(s[l][g][0][c]);for(c=s[g][f][0].length;c--;)s[l][f][0].push(s[g][f][0][c])}else if(S===p){if(s[l][g].length&&s[g][f].length)if(s[l][f].length){let x=[];for(c=s[l][g][0].length;c--;)x.push(s[l][g][0][c]);for(c=s[g][f][0].length;c--;)x.push(s[g][f][0][c]);s[l][f].push(x)}else{let x=[];for(c=s[l][g][0].length;c--;)x.push(s[l][g][0][c]);for(c=s[g][f][0].length;c--;)x.push(s[g][f][0][c]);s[l][f][0]=x}}else if(S===p-1)if(e[l][f].length){let x=[];for(c=s[l][g][0].length;c--;)x.push(s[l][g][0][c]);for(c=s[g][f][0].length;c--;)x.push(s[g][f][0][c]);e[l][f].push(x)}else{let x=[];for(c=s[l][g][0].length;c--;)x.push(s[l][g][0][c]);for(c=s[g][f][0].length;c--;)x.push(s[g][f][0][c]);e[l][f][0]=x}}return{d:r,pe:s,pe_prime:e}}static getRingCandidates(t,i,r){let s=t.length,e=[],l=0;for(let f=0;f<s;f++)for(let g=0;g<s;g++)t[f][g]===0||i[f][g].length===1&&r[f][g]===0||(r[f][g].length!==0?l=2*(t[f][g]+.5):l=2*t[f][g],l!==1/0&&e.push([l,i[f][g],r[f][g]]));return e.sort(function(f,g){return f[0]-g[0]}),e}static getSSSR(t,i,r,s,e,l,f,g){let c=[],m=[];for(let b=0;b<t.length;b++)if(t[b][0]%2!==0)for(let S=0;S<t[b][2].length;S++){let p=t[b][1][0].concat(t[b][2][S]);for(let D=0;D<p.length;D++)p[D][0].constructor===Array&&(p[D]=p[D][0]);let x=L.bondsToAtoms(p);if(L.getBondCount(x,r)===x.size&&!L.pathSetsContain(c,x,p,m,l,f)&&(c.push(x),m=m.concat(p)),c.length>g)return c}else for(let S=0;S<t[b][1].length-1;S++){let p=t[b][1][S].concat(t[b][1][S+1]);for(let D=0;D<p.length;D++)p[D][0].constructor===Array&&(p[D]=p[D][0]);let x=L.bondsToAtoms(p);if(L.getBondCount(x,r)===x.size&&!L.pathSetsContain(c,x,p,m,l,f)&&(c.push(x),m=m.concat(p)),c.length>g)return c}return c}static getEdgeCount(t){let i=0,r=t.length;for(var s=r-1;s--;)for(var e=r;e--;)t[s][e]===1&&i++;return i}static getEdgeList(t){let i=t.length,r=[];for(var s=i-1;s--;)for(var e=i;e--;)t[s][e]===1&&r.push([s,e]);return r}static bondsToAtoms(t){let i=new Set;for(var r=t.length;r--;)i.add(t[r][0]),i.add(t[r][1]);return i}static getBondCount(t,i){let r=0;for(let s of t)for(let e of t)s!==e&&(r+=i[s][e]);return r/2}static pathSetsContain(t,i,r,s,e,l){for(var f=t.length;f--;){if(L.isSupersetOf(i,t[f]))return!0;if(t[f].size===i.size&&L.areSetsEqual(t[f],i))return!0}let g=0,c=!1;for(f=r.length;f--;)for(var m=s.length;m--;)(r[f][0]===s[m][0]&&r[f][1]===s[m][1]||r[f][1]===s[m][0]&&r[f][0]===s[m][1])&&g++,g===r.length&&(c=!0);let b=!1;if(c){for(let S of i)if(l[S]<e[S]){b=!0;break}}if(c&&!b)return!0;for(let S of i)l[S]++;return!1}static areSetsEqual(t,i){if(t.size!==i.size)return!1;for(let r of t)if(!i.has(r))return!1;return!0}static isSupersetOf(t,i){for(let r of i)if(!t.has(r))return!1;return!0}};var ci=class{constructor(t){this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,scale:0,bondThickness:1,bondLength:30,shortBondLength:.8,bondSpacing:.17*30,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!0,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontFamily:"Arial, Helvetica, sans-serif",fontSizeLarge:11,fontSizeSmall:3,padding:10,experimentalSSSR:!1,kkThreshold:.1,kkInnerThreshold:.1,kkMaxIteration:2e4,kkMaxInnerIteration:50,kkMaxEnergy:1e9,weights:{colormap:null,additionalPadding:20,sigma:10,interval:0,opacity:1},themes:{dark:{C:"#ffffff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#aaaaaa",BACKGROUND:"#141414"},light:{C:"#222222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666666",BACKGROUND:"#ffffff"},oldschool:{C:"#000000",O:"#000000",N:"#000000",F:"#000000",CL:"#000000",BR:"#000000",I:"#000000",P:"#000000",S:"#000000",B:"#000000",SI:"#000000",H:"#000000",BACKGROUND:"#ffffff"},solarized:{C:"#586e75",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#657b83",BACKGROUND:"#eee8d5"},"solarized-dark":{C:"#93a1a1",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#839496",BACKGROUND:"#073642"},matrix:{C:"#678c61",O:"#2fc079",N:"#4f7e7e",F:"#90d762",CL:"#82d967",BR:"#23755a",I:"#409931",P:"#c1ff8a",S:"#faff00",B:"#50b45a",SI:"#409931",H:"#426644",BACKGROUND:"#ffffff"},github:{C:"#24292f",O:"#cf222e",N:"#0969da",F:"#2da44e",CL:"#6fdd8b",BR:"#bc4c00",I:"#8250df",P:"#bf3989",S:"#d4a72c",B:"#fb8f44",SI:"#bc4c00",H:"#57606a",BACKGROUND:"#ffffff"},carbon:{C:"#161616",O:"#da1e28",N:"#0f62fe",F:"#198038",CL:"#007d79",BR:"#fa4d56",I:"#8a3ffc",P:"#ff832b",S:"#f1c21b",B:"#8a3800",SI:"#e67e22",H:"#525252",BACKGROUND:"#ffffff"},cyberpunk:{C:"#ea00d9",O:"#ff3131",N:"#0abdc6",F:"#00ff9f",CL:"#00fe00",BR:"#fe9f20",I:"#ff00ff",P:"#fe7f00",S:"#fcee0c",B:"#ff00ff",SI:"#ffffff",H:"#913cb1",BACKGROUND:"#ffffff"},gruvbox:{C:"#665c54",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#79740e",BR:"#d65d0e",I:"#b16286",P:"#af3a03",S:"#d79921",B:"#689d6a",SI:"#427b58",H:"#7c6f64",BACKGROUND:"#fbf1c7"},"gruvbox-dark":{C:"#ebdbb2",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#b8bb26",BR:"#d65d0e",I:"#b16286",P:"#fe8019",S:"#d79921",B:"#8ec07c",SI:"#83a598",H:"#bdae93",BACKGROUND:"#282828"},custom:{C:"#222222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666666",BACKGROUND:"#ffffff"}}},this.opts=St.extend(!0,this.defaultOptions,t),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}draw(t,i,r="light",s=!1){this.initDraw(t,r,s),this.infoOnly||(this.themeManager=new yt(this.opts.themes,r),this.canvasWrapper=new gi(i,this.themeManager,this.opts)),s||(this.processGraph(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset(),this.opts.debug&&console.debug("DrawerBase::draw()",{graph:this.graph,rings:this.rings,ringConnections:this.ringConnections}))}edgeRingCount(t){let i=this.graph.edges[t],r=this.graph.vertices[i.sourceId],s=this.graph.vertices[i.targetId];return Math.min(r.value.rings.length,s.value.rings.length)}getBridgedRings(){return this.rings.filter(t=>t.isBridged)}getFusedRings(){return this.rings.filter(t=>t.isFused)}getSpiros(){return this.rings.filter(t=>t.isSpiro)}printRingInfo(){let t="";for(let i=0;i<this.rings.length;i++){let r=this.rings[i];t+=r.id+";",t+=r.members.length+";",t+=r.neighbours.length+";",t+=r.isSpiro?"true;":"false;",t+=r.isFused?"true;":"false;",t+=r.isBridged?"true;":"false;",t+=r.rings.length+";",t+=`
`}return t}rotateDrawing(){let t=0,i=0,r=0;for(let e=0;e<this.graph.vertices.length;e++){let l=this.graph.vertices[e];if(l.value.isDrawn)for(let f=e+1;f<this.graph.vertices.length;f++){let g=this.graph.vertices[f];if(!g.value.isDrawn)continue;let c=l.position.distanceSq(g.position);c>r&&(r=c,t=e,i=f)}}let s=-P.subtract(this.graph.vertices[t].position,this.graph.vertices[i].position).angle();if(!isNaN(s)){let e=s%.523599;e<.2617995?s=s-e:s+=.523599-e;for(let l=0;l<this.graph.vertices.length;l++)l!==i&&this.graph.vertices[l].position.rotateAround(s,this.graph.vertices[i].position);for(let l=0;l<this.rings.length;l++)this.rings[l].center.rotateAround(s,this.graph.vertices[i].position)}}getTotalOverlapScore(){return this.totalOverlapScore}getRingCount(){return this.rings.length}hasBridgedRing(){return this.bridgedRing}getHeavyAtomCount(){let t=0;for(let i=0;i<this.graph.vertices.length;i++)this.graph.vertices[i].value.element!=="H"&&t++;return t}getMolecularFormula(t=null){let i="",r=new Map,s=t===null?this.graph:new Mt(t,this.opts.isomeric);for(let l=0;l<s.vertices.length;l++){let f=s.vertices[l].value;if(r.has(f.element)?r.set(f.element,r.get(f.element)+1):r.set(f.element,1),f.bracket&&!f.bracket.chirality&&(r.has("H")?r.set("H",r.get("H")+f.bracket.hcount):r.set("H",f.bracket.hcount)),!f.bracket){let g=Ue.maxBonds[f.element]-f.bondCount;f.isPartOfAromaticRing&&g--,r.has("H")?r.set("H",r.get("H")+g):r.set("H",g)}}if(r.has("C")){let l=r.get("C");i+="C"+(l>1?l:""),r.delete("C")}if(r.has("H")){let l=r.get("H");i+="H"+(l>1?l:""),r.delete("H")}return Object.keys(Ue.atomicNumbers).sort().map(l=>{if(r.has(l)){let f=r.get(l);i+=l+(f>1?f:"")}}),i}getRingbondType(t,i){if(t.value.getRingbondCount()<1||i.value.getRingbondCount()<1)return null;for(let r=0;r<t.value.ringbonds.length;r++)for(let s=0;s<i.value.ringbonds.length;s++)if(t.value.ringbonds[r].id===i.value.ringbonds[s].id)return t.value.ringbonds[r].bondType==="-"?i.value.ringbonds[s].bond:t.value.ringbonds[r].bond;return null}initDraw(t,i,r,s){this.data=t,this.infoOnly=r,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new Mt(t,this.opts.isomeric),this.rings=[],this.ringConnections=[],this.originalRings=[],this.originalRingConnections=[],this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.highlight_atoms=s,this.initRings(),this.initHydrogens()}processGraph(){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();let t=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(let i=0;i<this.opts.overlapResolutionIterations;i++)for(let r=0;r<this.graph.edges.length;r++){let s=this.graph.edges[r];if(this.isEdgeRotatable(s)){let e=this.graph.getTreeDepth(s.sourceId,s.targetId),l=this.graph.getTreeDepth(s.targetId,s.sourceId),f=s.targetId,g=s.sourceId;if(e>l&&(f=s.sourceId,g=s.targetId),this.getSubtreeOverlapScore(g,f,t.vertexScores).value>this.opts.overlapSensitivity){let m=this.graph.vertices[f],b=this.graph.vertices[g],S=b.getNeighbours(f);if(S.length===1){let p=this.graph.vertices[S[0]],x=p.position.getRotateAwayFromAngle(m.position,b.position,ie.toRad(120));this.rotateSubtree(p.id,b.id,x,b.position);let D=this.getOverlapScore().total;D>this.totalOverlapScore?this.rotateSubtree(p.id,b.id,-x,b.position):this.totalOverlapScore=D}else if(S.length===2){if(b.value.rings.length!==0&&m.value.rings.length!==0)continue;let p=this.graph.vertices[S[0]],x=this.graph.vertices[S[1]];if(p.value.rings.length===1&&x.value.rings.length===1){if(p.value.rings[0]!==x.value.rings[0])continue}else{if(p.value.rings.length!==0||x.value.rings.length!==0)continue;{let D=p.position.getRotateAwayFromAngle(m.position,b.position,ie.toRad(120)),M=x.position.getRotateAwayFromAngle(m.position,b.position,ie.toRad(120));this.rotateSubtree(p.id,b.id,D,b.position),this.rotateSubtree(x.id,b.id,M,b.position);let z=this.getOverlapScore().total;z>this.totalOverlapScore?(this.rotateSubtree(p.id,b.id,-D,b.position),this.rotateSubtree(x.id,b.id,-M,b.position)):this.totalOverlapScore=z}}}t=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(t.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&this.opts.atomVisualization==="default"&&this.initPseudoElements(),this.rotateDrawing()}initRings(){let t=new Map;for(let r=this.graph.vertices.length-1;r>=0;r--){let s=this.graph.vertices[r];if(s.value.ringbonds.length!==0)for(let e=0;e<s.value.ringbonds.length;e++){let l=s.value.ringbonds[e].id,f=s.value.ringbonds[e].bond;if(!t.has(l))t.set(l,[s.id,f]);else{let g=s.id,c=t.get(l)[0],m=t.get(l)[1],b=new qt(g,c,1);b.setBondType(m||f||"-");let S=this.graph.addEdge(b),p=this.graph.vertices[c];s.addRingbondChild(c,e),s.value.addNeighbouringElement(p.value.element),p.addRingbondChild(g,e),p.value.addNeighbouringElement(s.value.element),s.edges.push(S),p.edges.push(S),t.delete(l)}}}let i=ui.getRings(this.graph,this.opts.experimentalSSSR);if(i!==null){for(let r=0;r<i.length;r++){let s=[...i[r]],e=this.addRing(new cr(s));for(let l=0;l<s.length;l++)this.graph.vertices[s[l]].value.rings.push(e)}for(let r=0;r<this.rings.length-1;r++)for(let s=r+1;s<this.rings.length;s++){let e=this.rings[r],l=this.rings[s],f=new nt(e,l);f.vertices.size>0&&this.addRingConnection(f)}for(let r=0;r<this.rings.length;r++){let s=this.rings[r];s.neighbours=nt.getNeighbours(this.ringConnections,s.id)}for(let r=0;r<this.rings.length;r++){let s=this.rings[r];this.graph.vertices[s.members[0]].value.addAnchoredRing(s.id)}for(this.backupRingInformation();this.rings.length>0;){let r=-1;for(let l=0;l<this.rings.length;l++){let f=this.rings[l];this.isPartOfBridgedRing(f.id)&&!f.isBridged&&(r=f.id)}if(r===-1)break;let s=this.getRing(r),e=this.getBridgedRingRings(s.id);this.bridgedRing=!0,this.createBridgedRing(e,s.members[0]),this.bridgedRing=!1;for(let l=0;l<e.length;l++)this.removeRing(e[l])}}}initHydrogens(){if(!this.opts.explicitHydrogens)for(let t=0;t<this.graph.vertices.length;t++){let i=this.graph.vertices[t];if(i.value.element!=="H")continue;let r=this.graph.vertices[i.neighbours[0]];r.value.hasHydrogen=!0,(!r.value.isStereoCenter||r.value.rings.length<2&&!r.value.bridgedRing||r.value.bridgedRing&&r.value.originalRings.length<2)&&(i.value.isDrawn=!1)}}getBridgedRingRings(t){let i=[],r=s=>{let e=this.getRing(s);i.push(s);for(let l=0;l<e.neighbours.length;l++){let f=e.neighbours[l];i.indexOf(f)===-1&&f!==s&&nt.isBridge(this.ringConnections,this.graph.vertices,s,f)&&r(f)}};return r(t),be.unique(i)}isPartOfBridgedRing(t){for(let i=0;i<this.ringConnections.length;i++)if(this.ringConnections[i].containsRing(t)&&this.ringConnections[i].isBridge(this.graph.vertices))return!0;return!1}createBridgedRing(t,i){let r=new Set,s=new Set,e=new Set;for(let c=0;c<t.length;c++){let m=this.getRing(t[c]);m.isPartOfBridged=!0;for(let b=0;b<m.members.length;b++)s.add(m.members[b]);for(let b=0;b<m.neighbours.length;b++){let S=m.neighbours[b];t.indexOf(S)===-1&&e.add(m.neighbours[b])}}let l=new Set;for(let c of s){let m=this.graph.vertices[c],b=be.intersection(t,m.value.rings);m.value.rings.length===1||b.length===1?r.add(m.id):l.add(m.id)}let f=[];for(let c of l){let m=this.graph.vertices[c],b=!1;for(let S=0;S<m.edges.length;S++)this.edgeRingCount(m.edges[S])===1&&(b=!0);b?(m.value.isBridgeNode=!0,r.add(m.id)):(m.value.isBridge=!0,r.add(m.id))}let g=new cr([...r]);this.addRing(g),g.isBridged=!0,g.neighbours=[...e];for(let c=0;c<t.length;c++)g.rings.push(this.getRing(t[c]).clone());for(let c=0;c<g.members.length;c++)this.graph.vertices[g.members[c]].value.bridgedRing=g.id;for(let c=0;c<f.length;c++){let m=this.graph.vertices[f[c]];m.value.rings=[]}for(let c of r){let m=this.graph.vertices[c];m.value.rings=be.removeAll(m.value.rings,t),m.value.rings.push(g.id)}for(let c=0;c<t.length;c++)for(let m=c+1;m<t.length;m++)this.removeRingConnectionsBetween(t[c],t[m]);for(let c of e){let m=this.getRingConnections(c,t);for(let b=0;b<m.length;b++)this.getRingConnection(m[b]).updateOther(g.id,c);this.getRing(c).neighbours.push(g.id)}return g}areVerticesInSameRing(t,i){for(let r=0;r<t.value.rings.length;r++)for(let s=0;s<i.value.rings.length;s++)if(t.value.rings[r]===i.value.rings[s])return!0;return!1}getCommonRings(t,i){let r=[];for(let s=0;s<t.value.rings.length;s++)for(let e=0;e<i.value.rings.length;e++)t.value.rings[s]==i.value.rings[e]&&r.push(t.value.rings[s]);return r}getLargestOrAromaticCommonRing(t,i){let r=this.getCommonRings(t,i),s=0,e=null;for(let l=0;l<r.length;l++){let f=this.getRing(r[l]),g=f.getSize();if(f.isBenzeneLike(this.graph.vertices))return f;g>s&&(s=g,e=f)}return e}getVerticesAt(t,i,r){let s=[];for(let e=0;e<this.graph.vertices.length;e++){let l=this.graph.vertices[e];if(l.id===r||!l.positioned)continue;t.distanceSq(l.position)<=i*i&&s.push(l.id)}return s}getClosestVertex(t){let i=99999,r=null;for(let s=0;s<this.graph.vertices.length;s++){let e=this.graph.vertices[s];if(e.id===t.id)continue;let l=t.position.distanceSq(e.position);l<i&&(i=l,r=e)}return r}addRing(t){return t.id=this.ringIdCounter++,this.rings.push(t),t.id}removeRing(t){this.rings=this.rings.filter(function(i){return i.id!==t}),this.ringConnections=this.ringConnections.filter(function(i){return i.firstRingId!==t&&i.secondRingId!==t});for(let i=0;i<this.rings.length;i++){let r=this.rings[i];r.neighbours=r.neighbours.filter(function(s){return s!==t})}}getRing(t){for(let i=0;i<this.rings.length;i++)if(this.rings[i].id==t)return this.rings[i]}addRingConnection(t){return t.id=this.ringConnectionIdCounter++,this.ringConnections.push(t),t.id}removeRingConnection(t){this.ringConnections=this.ringConnections.filter(function(i){return i.id!==t})}removeRingConnectionsBetween(t,i){let r=[];for(let s=0;s<this.ringConnections.length;s++){let e=this.ringConnections[s];(e.firstRingId===t&&e.secondRingId===i||e.firstRingId===i&&e.secondRingId===t)&&r.push(e.id)}for(let s=0;s<r.length;s++)this.removeRingConnection(r[s])}getRingConnection(t){for(let i=0;i<this.ringConnections.length;i++)if(this.ringConnections[i].id==t)return this.ringConnections[i]}getRingConnections(t,i){let r=[];for(let s=0;s<this.ringConnections.length;s++){let e=this.ringConnections[s];for(let l=0;l<i.length;l++){let f=i[l];(e.firstRingId===t&&e.secondRingId===f||e.firstRingId===f&&e.secondRingId===t)&&r.push(e.id)}}return r}getOverlapScore(){let t=0,i=new Float32Array(this.graph.vertices.length);for(let s=0;s<this.graph.vertices.length;s++)i[s]=0;for(let s=0;s<this.graph.vertices.length;s++){let e=this.graph.vertices.length;for(;--e>s;){let l=this.graph.vertices[s],f=this.graph.vertices[e];if(!l.value.isDrawn||!f.value.isDrawn)continue;let g=P.subtract(l.position,f.position).lengthSq();if(g<this.opts.bondLengthSq){let c=(this.opts.bondLength-Math.sqrt(g))/this.opts.bondLength;t+=c,i[s]+=c,i[e]+=c}}}let r=[];for(let s=0;s<this.graph.vertices.length;s++)r.push({id:s,score:i[s]});return r.sort(function(s,e){return e.score-s.score}),{total:t,scores:r,vertexScores:i}}chooseSide(t,i,r){let s=t.getNeighbours(i.id),e=i.getNeighbours(t.id),l=s.length,f=e.length,g=be.merge(s,e),c=[0,0];for(let b=0;b<g.length;b++)this.graph.vertices[g[b]].position.sameSideAs(t.position,i.position,r[0])?c[0]++:c[1]++;let m=[0,0];for(let b=0;b<this.graph.vertices.length;b++)this.graph.vertices[b].position.sameSideAs(t.position,i.position,r[0])?m[0]++:m[1]++;return{totalSideCount:m,totalPosition:m[0]>m[1]?0:1,sideCount:c,position:c[0]>c[1]?0:1,anCount:l,bnCount:f}}setRingCenter(t){let i=t.getSize(),r=new P(0,0);for(let s=0;s<i;s++)r.add(this.graph.vertices[t.members[s]].position);t.center=r.divide(i)}getSubringCenter(t,i){let r=i.value.originalRings,s=t.center,e=Number.MAX_VALUE;for(let l=0;l<r.length;l++)for(let f=0;f<t.rings.length;f++)r[l]===t.rings[f].id&&t.rings[f].getSize()<e&&(s=t.rings[f].center,e=t.rings[f].getSize());return s}drawEdges(t){let i=Array(this.graph.edges.length);if(i.fill(!1),this.graph.traverseBF(0,r=>{let s=this.graph.getEdges(r.id);for(let e=0;e<s.length;e++){let l=s[e];i[l]||(i[l]=!0,this.drawEdge(l,t))}}),!this.bridgedRing)for(let r=0;r<this.rings.length;r++){let s=this.rings[r];this.isRingAromatic(s)&&this.canvasWrapper.drawAromaticityRing(s)}}drawEdge(t,i){let r=this.graph.edges[t],s=this.graph.vertices[r.sourceId],e=this.graph.vertices[r.targetId],l=s.value.element,f=e.value.element;if((!s.value.isDrawn||!e.value.isDrawn)&&this.opts.atomVisualization==="default")return;let g=s.position,c=e.position,m=this.getEdgeNormals(r),b=be.clone(m);if(b[0].multiplyScalar(10).add(g),b[1].multiplyScalar(10).add(g),r.bondType==="="||this.getRingbondType(s,e)==="="||r.isPartOfAromaticRing&&this.bridgedRing){let S=this.areVerticesInSameRing(s,e),p=this.chooseSide(s,e,b);if(S){let D=this.getLargestOrAromaticCommonRing(s,e).center;m[0].multiplyScalar(this.opts.bondSpacing),m[1].multiplyScalar(this.opts.bondSpacing);let M=null;D.sameSideAs(s.position,e.position,P.add(g,m[0]))?M=new ee(P.add(g,m[0]),P.add(c,m[0]),l,f):M=new ee(P.add(g,m[1]),P.add(c,m[1]),l,f),M.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),r.isPartOfAromaticRing?this.canvasWrapper.drawLine(M,!0):this.canvasWrapper.drawLine(M),this.canvasWrapper.drawLine(new ee(g,c,l,f))}else if(r.center||s.isTerminal()&&e.isTerminal()){m[0].multiplyScalar(this.opts.halfBondSpacing),m[1].multiplyScalar(this.opts.halfBondSpacing);let x=new ee(P.add(g,m[0]),P.add(c,m[0]),l,f),D=new ee(P.add(g,m[1]),P.add(c,m[1]),l,f);this.canvasWrapper.drawLine(x),this.canvasWrapper.drawLine(D)}else if(p.anCount==0&&p.bnCount>1||p.bnCount==0&&p.anCount>1){m[0].multiplyScalar(this.opts.halfBondSpacing),m[1].multiplyScalar(this.opts.halfBondSpacing);let x=new ee(P.add(g,m[0]),P.add(c,m[0]),l,f),D=new ee(P.add(g,m[1]),P.add(c,m[1]),l,f);this.canvasWrapper.drawLine(x),this.canvasWrapper.drawLine(D)}else if(p.sideCount[0]>p.sideCount[1]){m[0].multiplyScalar(this.opts.bondSpacing),m[1].multiplyScalar(this.opts.bondSpacing);let x=new ee(P.add(g,m[0]),P.add(c,m[0]),l,f);x.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(x),this.canvasWrapper.drawLine(new ee(g,c,l,f))}else if(p.sideCount[0]<p.sideCount[1]){m[0].multiplyScalar(this.opts.bondSpacing),m[1].multiplyScalar(this.opts.bondSpacing);let x=new ee(P.add(g,m[1]),P.add(c,m[1]),l,f);x.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(x),this.canvasWrapper.drawLine(new ee(g,c,l,f))}else if(p.totalSideCount[0]>p.totalSideCount[1]){m[0].multiplyScalar(this.opts.bondSpacing),m[1].multiplyScalar(this.opts.bondSpacing);let x=new ee(P.add(g,m[0]),P.add(c,m[0]),l,f);x.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(x),this.canvasWrapper.drawLine(new ee(g,c,l,f))}else if(p.totalSideCount[0]<=p.totalSideCount[1]){m[0].multiplyScalar(this.opts.bondSpacing),m[1].multiplyScalar(this.opts.bondSpacing);let x=new ee(P.add(g,m[1]),P.add(c,m[1]),l,f);x.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(x),this.canvasWrapper.drawLine(new ee(g,c,l,f))}}else if(r.bondType==="#"){m[0].multiplyScalar(this.opts.bondSpacing/1.5),m[1].multiplyScalar(this.opts.bondSpacing/1.5);let S=new ee(P.add(g,m[0]),P.add(c,m[0]),l,f),p=new ee(P.add(g,m[1]),P.add(c,m[1]),l,f);this.canvasWrapper.drawLine(S),this.canvasWrapper.drawLine(p),this.canvasWrapper.drawLine(new ee(g,c,l,f))}else if(r.bondType!=="."){let S=s.value.isStereoCenter,p=e.value.isStereoCenter;r.wedge==="up"?this.canvasWrapper.drawWedge(new ee(g,c,l,f,S,p)):r.wedge==="down"?this.canvasWrapper.drawDashedWedge(new ee(g,c,l,f,S,p)):this.canvasWrapper.drawLine(new ee(g,c,l,f,S,p))}if(i){let S=P.midpoint(g,c);this.canvasWrapper.drawDebugText(S.x,S.y,"e: "+t)}}drawVertices(t){for(let i=0;i<this.graph.vertices.length;i++){let r=this.graph.vertices[i],s=r.value,e=0,l=0,f=r.value.bondCount,g=s.element,c=Ue.maxBonds[g]-f,m=r.getTextDirection(this.graph.vertices),b=this.opts.terminalCarbons||g!=="C"||s.hasAttachedPseudoElements?r.isTerminal():!1,S=s.element==="C";if(s.element==="N"&&s.isPartOfAromaticRing&&(c=0),s.bracket&&(c=s.bracket.hcount,e=s.bracket.charge,l=s.bracket.isotope),(e||l||this.graph.vertices.length<3)&&(S=!1),this.opts.atomVisualization==="allballs")this.canvasWrapper.drawBall(r.position.x,r.position.y,g);else if(s.isDrawn&&(!S||s.drawExplicit||b||s.hasAttachedPseudoElements)||this.graph.vertices.length===1)this.opts.atomVisualization==="default"?this.canvasWrapper.drawText(r.position.x,r.position.y,g,c,m,b,e,l,this.graph.vertices.length,s.getAttachedPseudoElements()):this.opts.atomVisualization==="balls"&&this.canvasWrapper.drawBall(r.position.x,r.position.y,g);else if(r.getNeighbourCount()===2&&r.forcePositioned==!0){let p=this.graph.vertices[r.neighbours[0]].position,x=this.graph.vertices[r.neighbours[1]].position,D=P.threePointangle(r.position,p,x);Math.abs(Math.PI-D)<.1&&this.canvasWrapper.drawPoint(r.position.x,r.position.y,g)}if(t){let p="v: "+r.id+" "+be.print(s.ringbonds);this.canvasWrapper.drawDebugText(r.position.x,r.position.y,p)}}if(this.opts.debug)for(let i=0;i<this.rings.length;i++){let r=this.rings[i].center;this.canvasWrapper.drawDebugPoint(r.x,r.y,"r: "+this.rings[i].id)}}position(){let t=null;for(let i=0;i<this.graph.vertices.length;i++)if(this.graph.vertices[i].value.bridgedRing!==null){t=this.graph.vertices[i];break}for(let i=0;i<this.rings.length;i++)this.rings[i].isBridged&&(t=this.graph.vertices[this.rings[i].members[0]]);this.rings.length>0&&t===null&&(t=this.graph.vertices[this.rings[0].members[0]]),t===null&&(t=this.graph.vertices[0]),this.createNextBond(t,null,0)}backupRingInformation(){this.originalRings=[],this.originalRingConnections=[];for(let t=0;t<this.rings.length;t++)this.originalRings.push(this.rings[t]);for(let t=0;t<this.ringConnections.length;t++)this.originalRingConnections.push(this.ringConnections[t]);for(let t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.backupRings()}restoreRingInformation(){let t=this.getBridgedRings();this.rings=[],this.ringConnections=[];for(let i=0;i<t.length;i++){let r=t[i];for(let s=0;s<r.rings.length;s++){let e=r.rings[s];this.originalRings[e.id].center=e.center}}for(let i=0;i<this.originalRings.length;i++)this.rings.push(this.originalRings[i]);for(let i=0;i<this.originalRingConnections.length;i++)this.ringConnections.push(this.originalRingConnections[i]);for(let i=0;i<this.graph.vertices.length;i++)this.graph.vertices[i].value.restoreRings()}createRing(t,i=null,r=null,s=null){if(t.positioned)return;i=i||new P(0,0);let e=t.getOrderedNeighbours(this.ringConnections),l=r?P.subtract(r.position,i).angle():0,f=ie.polyCircumradius(this.opts.bondLength,t.getSize()),g=ie.centralAngle(t.getSize());t.centralAngle=g;let c=l,m=r?r.id:null;if(t.members.indexOf(m)===-1&&(r&&(r.positioned=!1),m=t.members[0]),t.isBridged){this.graph.kkLayout(t.members.slice(),i,r.id,t,this.opts.bondLength,this.opts.kkThreshold,this.opts.kkInnerThreshold,this.opts.kkMaxIteration,this.opts.kkMaxInnerIteration,this.opts.kkMaxEnergy),t.positioned=!0,this.setRingCenter(t),i=t.center;for(let b=0;b<t.rings.length;b++)this.setRingCenter(t.rings[b])}else t.eachMember(this.graph.vertices,b=>{let S=this.graph.vertices[b];S.positioned||S.setPosition(i.x+Math.cos(c)*f,i.y+Math.sin(c)*f),c+=g,(!t.isBridged||t.rings.length<3)&&(S.angle=c,S.positioned=!0)},m,s?s.id:null);t.positioned=!0,t.center=i;for(let b=0;b<e.length;b++){let S=this.getRing(e[b].neighbour);if(S.positioned)continue;let p=nt.getVertices(this.ringConnections,t.id,S.id);if(p.length===2){t.isFused=!0,S.isFused=!0;let x=this.graph.vertices[p[0]],D=this.graph.vertices[p[1]],M=P.midpoint(x.position,D.position),z=P.normals(x.position,D.position);z[0].normalize(),z[1].normalize();let W=ie.polyCircumradius(this.opts.bondLength,S.getSize()),F=ie.apothem(W,S.getSize());z[0].multiplyScalar(F).add(M),z[1].multiplyScalar(F).add(M);let k=z[0];P.subtract(i,z[1]).lengthSq()>P.subtract(i,z[0]).lengthSq()&&(k=z[1]);let _=P.subtract(x.position,k),j=P.subtract(D.position,k);_.clockwise(j)===-1?S.positioned||this.createRing(S,k,x,D):S.positioned||this.createRing(S,k,D,x)}else if(p.length===1){t.isSpiro=!0,S.isSpiro=!0;let x=this.graph.vertices[p[0]],D=P.subtract(i,x.position);D.invert(),D.normalize();let M=ie.polyCircumradius(this.opts.bondLength,S.getSize());D.multiplyScalar(M),D.add(x.position),S.positioned||this.createRing(S,D,x)}}for(let b=0;b<t.members.length;b++){let S=this.graph.vertices[t.members[b]],p=S.neighbours;for(let x=0;x<p.length;x++){let D=this.graph.vertices[p[x]];D.positioned||(D.value.isConnectedToRing=!0,this.createNextBond(D,S,0))}}}rotateSubtree(t,i,r,s){this.graph.traverseTree(t,i,e=>{e.position.rotateAround(r,s);for(let l=0;l<e.value.anchoredRings.length;l++){let f=this.rings[e.value.anchoredRings[l]];f&&f.center.rotateAround(r,s)}})}getSubtreeOverlapScore(t,i,r){let s=0,e=new P(0,0),l=0;return this.graph.traverseTree(t,i,f=>{if(!f.value.isDrawn)return;let g=r[f.id];g>this.opts.overlapSensitivity&&(s+=g,l++);let c=this.graph.vertices[f.id].position.clone();c.multiplyScalar(g),e.add(c)}),e.divide(s),{value:s/l,center:e}}getCurrentCenterOfMass(){let t=new P(0,0),i=0;for(let r=0;r<this.graph.vertices.length;r++){let s=this.graph.vertices[r];s.positioned&&(t.add(s.position),i++)}return t.divide(i)}getCurrentCenterOfMassInNeigbourhood(t,i=this.opts.bondLength*2){let r=new P(0,0),s=0,e=i*i;for(let l=0;l<this.graph.vertices.length;l++){let f=this.graph.vertices[l];f.positioned&&t.distanceSq(f.position)<e&&(r.add(f.position),s++)}return r.divide(s)}resolvePrimaryOverlaps(){let t=[],i=Array(this.graph.vertices.length);for(let r=0;r<this.rings.length;r++){let s=this.rings[r];for(let e=0;e<s.members.length;e++){let l=this.graph.vertices[s.members[e]];if(i[l.id])continue;i[l.id]=!0;let f=this.getNonRingNeighbours(l.id);if(f.length>1){let g=[];for(let c=0;c<l.value.rings.length;c++)g.push(l.value.rings[c]);t.push({common:l,rings:g,vertices:f})}else if(f.length===1&&l.value.rings.length===2){let g=[];for(let c=0;c<l.value.rings.length;c++)g.push(l.value.rings[c]);t.push({common:l,rings:g,vertices:f})}}}for(let r=0;r<t.length;r++){let s=t[r];if(s.vertices.length===2){let e=s.vertices[0],l=s.vertices[1];if(!e.value.isDrawn||!l.value.isDrawn)continue;let f=(2*Math.PI-this.getRing(s.rings[0]).getAngle())/6;this.rotateSubtree(e.id,s.common.id,f,s.common.position),this.rotateSubtree(l.id,s.common.id,-f,s.common.position);let g=this.getOverlapScore(),c=this.getSubtreeOverlapScore(e.id,s.common.id,g.vertexScores),m=this.getSubtreeOverlapScore(l.id,s.common.id,g.vertexScores),b=c.value+m.value;this.rotateSubtree(e.id,s.common.id,-2*f,s.common.position),this.rotateSubtree(l.id,s.common.id,2*f,s.common.position),g=this.getOverlapScore(),c=this.getSubtreeOverlapScore(e.id,s.common.id,g.vertexScores),m=this.getSubtreeOverlapScore(l.id,s.common.id,g.vertexScores),c.value+m.value>b&&(this.rotateSubtree(e.id,s.common.id,2*f,s.common.position),this.rotateSubtree(l.id,s.common.id,-2*f,s.common.position))}else s.vertices.length===1&&s.rings.length}}resolveSecondaryOverlaps(t){for(let i=0;i<t.length;i++)if(t[i].score>this.opts.overlapSensitivity){let r=this.graph.vertices[t[i].id];if(r.isTerminal()){let s=this.getClosestVertex(r);if(s){let e=null;s.isTerminal()?e=s.id===0?this.graph.vertices[1].position:s.previousPosition:e=s.id===0?this.graph.vertices[1].position:s.position;let l=r.id===0?this.graph.vertices[1].position:r.previousPosition;r.position.rotateAwayFrom(e,l,ie.toRad(20))}}}}getLastAngle(t){for(;t;){let i=this.graph.vertices[t];if(i.value.rings.length>0)return 0;if(i.angle)return i.angle;t=i.parentVertexId}return 0}createNextBond(t,i=null,r=0,s=!1,e=!1){if(t.positioned&&!e)return;let l=!1;if(i){let f=this.graph.getEdge(t.id,i.id);(f.bondType==="/"||f.bondType==="\\")&&++this.doubleBondConfigCount%2===1&&this.doubleBondConfig===null&&(this.doubleBondConfig=f.bondType,l=!0,i.parentVertexId===null&&t.value.branchBond&&(this.doubleBondConfig==="/"?this.doubleBondConfig="\\":this.doubleBondConfig==="\\"&&(this.doubleBondConfig="/")))}if(!e)if(i)if(i.value.rings.length>0){let f=i.neighbours,g=null,c=new P(0,0);if(i.value.bridgedRing===null&&i.value.rings.length>1)for(let m=0;m<f.length;m++){let b=this.graph.vertices[f[m]];if(be.containsAll(b.value.rings,i.value.rings)){g=b;break}}if(g===null){for(let m=0;m<f.length;m++){let b=this.graph.vertices[f[m]];b.positioned&&this.areVerticesInSameRing(b,i)&&c.add(P.subtract(b.position,i.position))}c.invert().normalize().multiplyScalar(this.opts.bondLength).add(i.position)}else c=g.position.clone().rotateAround(Math.PI,i.position);t.previousPosition=i.position,t.setPositionFromVector(c),t.positioned=!0}else{let f=new P(this.opts.bondLength,0);f.rotate(r),f.add(i.position),t.setPositionFromVector(f),t.previousPosition=i.position,t.positioned=!0}else{let f=new P(this.opts.bondLength,0);f.rotate(ie.toRad(-60)),t.previousPosition=f,t.setPosition(this.opts.bondLength,0),t.angle=ie.toRad(-60),t.value.bridgedRing===null&&(t.positioned=!0)}if(t.value.bridgedRing!==null){let f=this.getRing(t.value.bridgedRing);if(!f.positioned){let g=P.subtract(t.previousPosition,t.position);g.invert(),g.normalize();let c=ie.polyCircumradius(this.opts.bondLength,f.members.length);g.multiplyScalar(c),g.add(t.position),this.createRing(f,g,t)}}else if(t.value.rings.length>0){let f=this.getRing(t.value.rings[0]);if(!f.positioned){let g=P.subtract(t.previousPosition,t.position);g.invert(),g.normalize();let c=ie.polyCircumradius(this.opts.bondLength,f.getSize());g.multiplyScalar(c),g.add(t.position),this.createRing(f,g,t)}}else{let f=t.getNeighbours(),g=[];for(let m=0;m<f.length;m++)this.graph.vertices[f[m]].value.isDrawn&&g.push(f[m]);i&&(g=be.remove(g,i.id));let c=t.getAngle();if(g.length===1){let m=this.graph.vertices[g[0]],b=i?this.graph.getEdge(t.id,i.id):null,S=this.graph.getEdge(t.id,m.id);if(b&&S&&b.weight+S.weight>=4)b.center=!0,S.center=!0,t.value.drawExplicit=!1,m.drawExplicit=!0,m.angle=0,this.createNextBond(m,t,c+m.angle);else if(i&&i.value.rings.length>0){let p=ie.toRad(60),x=-p,D=new P(this.opts.bondLength,0),M=new P(this.opts.bondLength,0);D.rotate(p).add(t.position),M.rotate(x).add(t.position);let z=this.getCurrentCenterOfMass(),W=D.distanceSq(z),F=M.distanceSq(z);m.angle=W<F?x:p,this.createNextBond(m,t,c+m.angle)}else{let p=this.getLastAngle(t.id);if(p=p>=0?1.0472:-1.0472,i&&!l){let x=this.graph.getEdge(t.id,m.id).bondType;x==="/"?(this.doubleBondConfig==="/"||this.doubleBondConfig==="\\"&&(p=-p),this.doubleBondConfig=null):x==="\\"&&(this.doubleBondConfig==="/"?p=-p:this.doubleBondConfig,this.doubleBondConfig=null)}s?m.angle=p:m.angle=-p,this.createNextBond(m,t,c+m.angle)}}else if(g.length===2){let m=t.angle;m||(m=1.0472);let b=this.graph.getTreeDepth(g[0],t.id),S=this.graph.getTreeDepth(g[1],t.id),p=this.graph.vertices[g[0]],x=this.graph.vertices[g[1]];p.value.subtreeDepth=b,x.value.subtreeDepth=S;let D=this.graph.getTreeDepth(i?i.id:null,t.id);i&&(i.value.subtreeDepth=D);let M=0,z=1;x.value.element==="C"&&p.value.element!=="C"&&S>1&&b<5?(M=1,z=0):x.value.element!=="C"&&p.value.element==="C"&&b>1&&S<5?(M=0,z=1):S>b&&(M=1,z=0);let W=this.graph.vertices[g[M]],F=this.graph.vertices[g[z]],k=D<b&&D<S;F.angle=m,W.angle=-m,this.doubleBondConfig==="\\"?F.value.branchBond==="\\"&&(F.angle=-m,W.angle=m):this.doubleBondConfig==="/"&&F.value.branchBond==="/"&&(F.angle=-m,W.angle=m),this.createNextBond(F,t,c+F.angle,k),this.createNextBond(W,t,c+W.angle,k)}else if(g.length>0){let m=g.map(b=>{let S=this.graph.vertices[b],p=this.graph.getTreeDepth(b,t.id);return S.value.subtreeDepth=p,S});if(m.sort((b,S)=>S.value.subtreeDepth-b.value.subtreeDepth),g.length===3&&i&&i.value.rings.length<1&&m[2].value.rings.length<1&&m[1].value.rings.length<1&&m[0].value.rings.length<1&&m[2].value.subtreeDepth===1&&m[1].value.subtreeDepth===1&&m[0].value.subtreeDepth>1)t.angle>=0?(m[0].angle=-1.0472,m[1].angle=ie.toRad(30),m[2].angle=ie.toRad(90)):(m[0].angle=1.0472,m[1].angle=-ie.toRad(30),m[2].angle=-ie.toRad(90)),this.createNextBond(m[0],t,c+m[0].angle),this.createNextBond(m[1],t,c+m[1].angle),this.createNextBond(m[2],t,c+m[2].angle);else{let b=g.length+(i?1:0),S=2*Math.PI/b,p=S,x=0;for(g.length%2!==0?(this.createNextBond(m[0],t,c),x=1):p/=2;x<g.length;)this.createNextBond(m[x+0],t,c+p),this.createNextBond(m[x+1],t,c-p),p+=S,x+=2}}}}getCommonRingbondNeighbour(t){let i=t.neighbours;for(let r=0;r<i.length;r++){let s=this.graph.vertices[i[r]];if(be.containsAll(s.value.rings,t.value.rings))return s}return null}isPointInRing(t){for(let i=0;i<this.rings.length;i++){let r=this.rings[i];if(!r.positioned)continue;let s=ie.polyCircumradius(this.opts.bondLength,r.getSize()),e=s*s;if(t.distanceSq(r.center)<e)return!0}return!1}isEdgeInRing(t){let i=this.graph.vertices[t.sourceId],r=this.graph.vertices[t.targetId];return this.areVerticesInSameRing(i,r)}isEdgeRotatable(t){let i=this.graph.vertices[t.sourceId],r=this.graph.vertices[t.targetId];return!(t.bondType!=="-"||i.isTerminal()||r.isTerminal()||i.value.rings.length>0&&r.value.rings.length>0&&this.areVerticesInSameRing(i,r))}isRingAromatic(t){for(let i=0;i<t.members.length;i++)if(!this.graph.vertices[t.members[i]].value.isPartOfAromaticRing)return!1;return!0}getEdgeNormals(t){let i=this.graph.vertices[t.sourceId].position,r=this.graph.vertices[t.targetId].position;return P.units(i,r)}getNonRingNeighbours(t){let i=[],r=this.graph.vertices[t],s=r.neighbours;for(let e=0;e<s.length;e++){let l=this.graph.vertices[s[e]];be.intersection(r.value.rings,l.value.rings).length===0&&l.value.isBridge==!1&&i.push(l)}return i}annotateStereochemistry(){let t=10;for(let i=0;i<this.graph.vertices.length;i++){let r=this.graph.vertices[i];if(!r.value.isStereoCenter)continue;let s=r.getNeighbours(),e=s.length,l=Array(e);for(let _=0;_<e;_++){let j=new Uint8Array(this.graph.vertices.length),Q=Array([]);j[r.id]=1,this.visitStereochemistry(s[_],r.id,j,Q,t,0);for(let oe=0;oe<Q.length;oe++)Q[oe].sort((ae,Ae)=>Ae-ae);l[_]=[_,Q]}let f=0,g=0;for(let _=0;_<l.length;_++){l[_][1].length>f&&(f=l[_][1].length);for(let j=0;j<l[_][1].length;j++)l[_][1][j].length>g&&(g=l[_][1][j].length)}for(let _=0;_<l.length;_++){let j=f-l[_][1].length;for(let Q=0;Q<j;Q++)l[_][1].push([]);l[_][1].push([s[_]]);for(let Q=0;Q<l[_][1].length;Q++){let oe=g-l[_][1][Q].length;for(let ae=0;ae<oe;ae++)l[_][1][Q].push(0)}}l.sort(function(_,j){for(let Q=0;Q<_[1].length;Q++)for(let oe=0;oe<_[1][Q].length;oe++){if(_[1][Q][oe]>j[1][Q][oe])return-1;if(_[1][Q][oe]<j[1][Q][oe])return 1}return 0});let c=new Uint8Array(e);for(let _=0;_<e;_++)c[_]=l[_][0],r.value.priority=_;let m=this.graph.vertices[s[c[0]]].position,b=this.graph.vertices[s[c[1]]].position,p=m.relativeClockwise(b,r.position)===-1,x=r.value.bracket.chirality==="@"?-1:1,D=ie.parityOfPermutation(c)*x===1?"R":"S",M="down",z="up";(p&&D!=="R"||!p&&D!=="S")&&(r.value.hydrogenDirection="up",M="up",z="down"),r.value.hasHydrogen&&(this.graph.getEdge(r.id,s[c[c.length-1]]).wedge=M);let W=new Array(s.length-1),F=r.value.rings.length>1&&r.value.hasHydrogen,k=r.value.hasHydrogen?1:0;for(let _=0;_<c.length-k;_++){W[_]=new Uint32Array(2);let j=this.graph.vertices[s[c[_]]];W[_][0]+=j.value.isStereoCenter?0:1e5,W[_][0]+=this.areVerticesInSameRing(j,r)?0:1e4,W[_][0]+=j.value.isHeteroAtom()?1e3:0,W[_][0]-=j.value.subtreeDepth===0?1e3:0,W[_][0]+=1e3-j.value.subtreeDepth,W[_][1]=s[c[_]]}if(W.sort(function(_,j){return _[0]>j[0]?-1:_[0]<j[0]?1:0}),!F){let _=W[0][1];if(r.value.hasHydrogen)this.graph.getEdge(r.id,_).wedge=z;else{let j=z;for(let Q=c.length-1;Q>=0&&(j===M?j=z:j=M,s[c[Q]]!==_);Q--);this.graph.getEdge(r.id,_).wedge=j}}r.value.chirality=D}}visitStereochemistry(t,i,r,s,e,l,f=0){r[t]=1;let g=this.graph.vertices[t],c=g.value.getAtomicNumber();s.length<=l&&s.push([]);for(let b=0;b<this.graph.getEdge(t,i).weight;b++)s[l].push(f*1e3+c);let m=this.graph.vertices[t].neighbours;for(let b=0;b<m.length;b++)r[m[b]]!==1&&l<e-1&&this.visitStereochemistry(m[b],t,r.slice(),s,e,l+1,c);if(l<e-1){let b=0;for(let S=0;S<m.length;S++)b+=this.graph.getEdge(t,m[S]).weight;for(let S=0;S<g.value.getMaxBonds()-b;S++)s.length<=l+1&&s.push([]),s[l+1].push(c*1e3+1)}}initPseudoElements(){for(let t=0;t<this.graph.vertices.length;t++){let i=this.graph.vertices[t],r=i.neighbours,s=Array(r.length);for(let g=0;g<r.length;g++)s[g]=this.graph.vertices[r[g]];if(i.getNeighbourCount()<3||i.value.rings.length>0||i.value.element==="P"||i.value.element==="C"&&s.length===3&&s[0].value.element==="N"&&s[1].value.element==="N"&&s[2].value.element==="N")continue;let e=0,l=0;for(let g=0;g<s.length;g++){let c=s[g],m=c.value.element,b=c.getNeighbourCount();m!=="C"&&m!=="H"&&b===1&&e++,b>1&&l++}if(l>1||e<2)continue;let f=null;for(let g=0;g<s.length;g++){let c=s[g];c.getNeighbourCount()>1&&(f=c)}for(let g=0;g<s.length;g++){let c=s[g];if(c.getNeighbourCount()>1)continue;c.value.isDrawn=!1;let m=Ue.maxBonds[c.value.element]-c.value.bondCount,b="";c.value.bracket&&(m=c.value.bracket.hcount,b=c.value.bracket.charge||0),i.value.attachPseudoElement(c.value.element,f?f.value.element:null,m,b)}}}};function Il(L){"use strict";function t(S,p){let x=S.length;if(x===0||x>0&&x-1 in S)for(let M=0;M<x&&p.call(S[M],M,S[M])!==!1;M++);else for(let M in S)if(p.call(S[M],M,S[M])===!1)break}function i(S){let p=parseInt(S).toString(16);return p.length==1?"0"+p:p}function r(S,p,x,D){return D=parseInt(D),D===void 0||D===255?"#"+i(S)+i(p)+i(x):D===0?!1:"rgba("+S+","+p+","+x+","+D/255+")"}function s(S,p,x){return"M"+S+" "+p+"h"+x}function e(S,p){return'<path stroke="'+S+'" d="'+p+`" />
`}function l(S){let p="";return t(S,function(x,D){if(x=r.apply(null,x.split(",")),x===!1)return;let M=[],z,W=1;t(D,function(F,k){z&&k[1]===z[1]&&k[0]===z[0]+W?W++:(z&&(M.push(s(z[0],z[1],W)),W=1),z=k)}),M.push(s(z[0],z[1],W)),p+=e(x,M.join(""))}),p}function f(S){let p={},x=S.data,D=x.length,M=S.width,z=0,W=0,F;for(let k=0;k<D;k+=4)x[k+3]>0&&(F=x[k]+","+x[k+1]+","+x[k+2]+","+x[k+3],p[F]=p[F]||[],z=k/4%M,W=Math.floor(k/4/M),p[F].push([z,W]));return p}let g=f(L),c=l(g),m='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -0.5 '+L.width+" "+L.height+'" shape-rendering="crispEdges"><g shape-rendering="crispEdges">'+c+"</g></svg>",b=document.createElement("div");return b.innerHTML=m,b.firstChild}var ql=io(jl()),Gt=class{constructor(t,i,r,s,e=.3,l=0,f=null,g=1,c=!1){this.points=t,this.weights=i,this.width=r,this.height=s,this.sigma=e,this.interval=l,this.opacity=g,this.normalized=c,f===null&&(f=["#c51b7d","#de77ae","#f1b6da","#fde0ef","#ffffff","#e6f5d0","#b8e186","#7fbc41","#4d9221"]),this.colormap=f,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height}setFromArray(t,i){this.points=[],t.forEach(r=>{this.points.push(new P(r[0],r[1]))}),this.weights=[],i.forEach(r=>{this.weights.push(r)})}draw(){let t=[];for(let e=0;e<this.width;e++){let l=[];for(let f=0;f<this.height;f++)l.push(0);t.push(l)}let i=1/(2*this.sigma*this.sigma);for(let e=0;e<this.points.length;e++){let l=this.points[e],f=this.weights[e];for(let g=0;g<this.width;g++)for(let c=0;c<this.height;c++){let m=g-l.x,b=c-l.y,S=(m*m+b*b)*i,p=f*Math.exp(-S);t[g][c]+=p}}let r=1;if(!this.normalized){let e=-Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER;for(let f=0;f<this.width;f++)for(let g=0;g<this.height;g++)t[f][g]<l&&(l=t[f][g]),t[f][g]>e&&(e=t[f][g]);r=Math.max(Math.abs(l),Math.abs(e))}let s=ql.default.scale(this.colormap).domain([-1,1]);for(let e=0;e<this.width;e++)for(let l=0;l<this.height;l++){this.normalized||(t[e][l]=t[e][l]/r),this.interval!==0&&(t[e][l]=Math.round(t[e][l]/this.interval)*this.interval);let[f,g,c]=s(t[e][l]).rgb();this.setPixel(new P(e,l),f,g,c)}}getImage(t){let i=new Image;i.onload=()=>{this.context.imageSmoothingEnabled=!1,this.context.drawImage(i,0,0,this.width,this.height),t&&t(i)},i.onerror=r=>{console.log(r)},i.src=this.canvas.toDataURL()}getSVG(){return Il(this.context.getImageData(0,0,this.width,this.height))}setPixel(t,i,r,s){this.context.fillStyle="rgba("+i+","+r+","+s+","+this.opacity+")",this.context.fillRect(t.x,t.y,1,1)}};function so(L){let t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=i.length;for(let s=0;s<L;s++)t+=i.charAt(Math.floor(Math.random()*r));return t}var Ze=class L{constructor(t,i,r,s=!0){if(typeof i=="string"||i instanceof String?this.svg=document.getElementById(i):this.svg=i,this.container=null,this.opts=r,this.uid=so(5),this.gradientId=0,this.backgroundItems=[],this.paths=[],this.vertices=[],this.gradients=[],this.highlights=[],this.drawingWidth=0,this.drawingHeight=0,this.halfBondThickness=this.opts.bondThickness/2,this.themeManager=t,this.maskElements=[],this.maxX=-Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE,this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,s)for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.style=document.createElementNS("http://www.w3.org/2000/svg","style"),this.style.appendChild(document.createTextNode(`
                .element {
                    font: ${this.opts.fontSizeLarge}pt ${this.opts.fontFamily};
                }
                .sub {
                    font: ${this.opts.fontSizeSmall}pt ${this.opts.fontFamily};
                }
            `)),this.svg?this.svg.appendChild(this.style):(this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.appendChild(this.style))}constructSvg(){let t=document.createElementNS("http://www.w3.org/2000/svg","defs"),i=document.createElementNS("http://www.w3.org/2000/svg","mask"),r=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","g"),e=document.createElementNS("http://www.w3.org/2000/svg","g"),l=document.createElementNS("http://www.w3.org/2000/svg","g"),f=this.paths;{let g=document.createElementNS("http://www.w3.org/2000/svg","rect");g.setAttributeNS(null,"x",this.minX),g.setAttributeNS(null,"y",this.minY),g.setAttributeNS(null,"width",this.maxX-this.minX),g.setAttributeNS(null,"height",this.maxY-this.minY),g.setAttributeNS(null,"fill","white"),i.appendChild(g)}i.setAttributeNS(null,"id",this.uid+"-text-mask");for(let g of f)e.appendChild(g);for(let g of this.backgroundItems)r.appendChild(g);for(let g of this.highlights)s.appendChild(g);for(let g of this.vertices)l.appendChild(g);for(let g of this.maskElements)i.appendChild(g);for(let g of this.gradients)t.appendChild(g);if(e.setAttributeNS(null,"mask","url(#"+this.uid+"-text-mask)"),this.updateViewbox(this.opts.scale),r.setAttributeNS(null,"style",`transform: translateX(${this.minX}px) translateY(${this.minY}px)`),this.svg)this.svg.appendChild(t),this.svg.appendChild(i),this.svg.appendChild(r),this.svg.appendChild(s),this.svg.appendChild(e),this.svg.appendChild(l);else return this.container.appendChild(t),this.container.appendChild(i),this.container.appendChild(r),this.container.appendChild(e),this.container.appendChild(l),this.container}addLayer(t){this.backgroundItems.push(t.firstChild)}createGradient(t){let i=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),r=this.uid+`-line-${this.gradientId++}`,s=t.getLeftVector(),e=t.getRightVector(),l=s.x,f=s.y,g=e.x,c=e.y;i.setAttributeNS(null,"id",r),i.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),i.setAttributeNS(null,"x1",l),i.setAttributeNS(null,"y1",f),i.setAttributeNS(null,"x2",g),i.setAttributeNS(null,"y2",c);let m=document.createElementNS("http://www.w3.org/2000/svg","stop");m.setAttributeNS(null,"stop-color",this.themeManager.getColor(t.getLeftElement())||this.themeManager.getColor("C")),m.setAttributeNS(null,"offset","20%");let b=document.createElementNS("http://www.w3.org/2000/svg","stop");return b.setAttributeNS(null,"stop-color",this.themeManager.getColor(t.getRightElement()||this.themeManager.getColor("C"))),b.setAttributeNS(null,"offset","100%"),i.appendChild(m),i.appendChild(b),this.gradients.push(i),r}createSubSuperScripts(t,i){let r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.setAttributeNS(null,"baseline-shift",i),r.appendChild(document.createTextNode(t)),r.setAttributeNS(null,"class","sub"),r}static createUnicodeCharge(t){return t===1?"\u207A":t===-1?"\u207B":t>1?L.createUnicodeSuperscript(t)+"\u207A":t<-1?L.createUnicodeSuperscript(t)+"\u207B":""}determineDimensions(t){for(let r=0;r<t.length;r++){if(!t[r].value.isDrawn)continue;let s=t[r].position;this.maxX<s.x&&(this.maxX=s.x),this.maxY<s.y&&(this.maxY=s.y),this.minX>s.x&&(this.minX=s.x),this.minY>s.y&&(this.minY=s.y)}let i=this.opts.padding;this.maxX+=i,this.maxY+=i,this.minX-=i,this.minY-=i,this.drawingWidth=this.maxX-this.minX,this.drawingHeight=this.maxY-this.minY}updateViewbox(t){let i=this.minX,r=this.minY,s=this.maxX-this.minX,e=this.maxY-this.minY;if(t<=0)if(s>e){let l=s-e;e=s,r-=l/2}else{let l=e-s;s=e,i-=l/2}else this.svg&&(this.svg.style.width=t*s+"px",this.svg.style.height=t*e+"px");this.svg.setAttributeNS(null,"viewBox",`${i} ${r} ${s} ${e}`)}drawBall(t,i,r){let s=this.opts.bondLength/4.5;t-s<this.minX&&(this.minX=t-s),t+s>this.maxX&&(this.maxX=t+s),i-s<this.minY&&(this.minY=i-s),i+s>this.maxY&&(this.maxY=i+s);let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttributeNS(null,"cx",t),e.setAttributeNS(null,"cy",i),e.setAttributeNS(null,"r",s),e.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(e)}drawWedge(t){let i=t.getLeftVector().clone(),r=t.getRightVector().clone(),s=P.normals(i,r);s[0].normalize(),s[1].normalize();let e=t.getRightChiral(),l=i,f=r;e&&(l=r,f=i);let g=P.add(l,P.multiplyScalar(s[0],this.halfBondThickness)),c=P.add(f,P.multiplyScalar(s[0],3+this.opts.fontSizeLarge/4)),m=P.add(f,P.multiplyScalar(s[1],3+this.opts.fontSizeLarge/4)),b=P.add(l,P.multiplyScalar(s[1],this.halfBondThickness)),S=document.createElementNS("http://www.w3.org/2000/svg","polygon"),p=this.createGradient(t,i.x,i.y,r.x,r.y);S.setAttributeNS(null,"points",`${g.x},${g.y} ${c.x},${c.y} ${m.x},${m.y} ${b.x},${b.y}`),S.setAttributeNS(null,"fill",`url('#${p}')`),this.paths.push(S)}drawAtomHighlight(t,i,r="#03fc9d"){let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",t),s.setAttributeNS(null,"cy",i),s.setAttributeNS(null,"r",this.opts.bondLength/3),s.setAttributeNS(null,"fill",r),this.highlights.push(s)}drawDashedWedge(t){if(isNaN(t.from.x)||isNaN(t.from.y)||isNaN(t.to.x)||isNaN(t.to.y))return;let i=t.getLeftVector().clone(),r=t.getRightVector().clone(),s=P.normals(i,r);s[0].normalize(),s[1].normalize();let e=t.getRightChiral(),l,f;e?(l=r,f=i):(l=i,f=r);let g=P.subtract(f,l).normalize(),c=t.getLength(),m=1.25/(c/(this.opts.bondLength/10)),b=this.createGradient(t);for(let S=0;S<1;S+=m){let p=P.multiplyScalar(g,S*c),x=P.add(l,p),D=this.opts.fontSizeLarge/2*S,M=P.multiplyScalar(s[0],D);x.subtract(M);let z=x.clone();z.add(P.multiplyScalar(M,2)),this.drawLine(new ee(x,z),null,b)}}drawDebugPoint(t,i,r="",s="#f00"){let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttributeNS(null,"cx",t),e.setAttributeNS(null,"cy",i),e.setAttributeNS(null,"r","2"),e.setAttributeNS(null,"fill",s),this.vertices.push(e),this.drawDebugText(t,i,r)}drawDebugText(t,i,r){let s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttributeNS(null,"x",t),s.setAttributeNS(null,"y",i),s.setAttributeNS(null,"class","debug"),s.setAttributeNS(null,"fill","#ff0000"),s.setAttributeNS(null,"style",`
                font: 5px Droid Sans, sans-serif;
            `),s.appendChild(document.createTextNode(r)),this.vertices.push(s)}drawRing(t,i,r){let s=document.createElementNS("http://www.w3.org/2000/svg","circle"),e=ie.apothemFromSideLength(this.opts.bondLength,r);s.setAttributeNS(null,"cx",t),s.setAttributeNS(null,"cy",i),s.setAttributeNS(null,"r",e-this.opts.bondSpacing),s.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),s.setAttributeNS(null,"stroke-width",this.opts.bondThickness),s.setAttributeNS(null,"fill","none"),this.paths.push(s)}drawLine(t,i=!1,r=null,s="round"){let e=[["stroke-width",this.opts.bondThickness],["stroke-linecap",s],["stroke-dasharray",i?"5, 5":"none"]],l=t.getLeftVector(),f=t.getRightVector(),g=l.x,c=l.y,m=f.x,b=f.y,S=e.map(x=>x.join(":")).join(";"),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttributeNS(null,"x1",g),p.setAttributeNS(null,"y1",c),p.setAttributeNS(null,"x2",m),p.setAttributeNS(null,"y2",b),p.setAttributeNS(null,"style",S),this.paths.push(p),r==null&&(r=this.createGradient(t,g,c,m,b)),p.setAttributeNS(null,"stroke",`url('#${r}')`)}drawPoint(t,i,r){let s=.75;t-s<this.minX&&(this.minX=t-s),t+s>this.maxX&&(this.maxX=t+s),i-s<this.minY&&(this.minY=i-s),i+s>this.maxY&&(this.maxY=i+s);let e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttributeNS(null,"cx",t),e.setAttributeNS(null,"cy",i),e.setAttributeNS(null,"r","1.5"),e.setAttributeNS(null,"fill","black"),this.maskElements.push(e);let l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttributeNS(null,"cx",t),l.setAttributeNS(null,"cy",i),l.setAttributeNS(null,"r",s),l.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(l)}drawText(t,i,r,s,e,l,f,g,c,m={}){let b=[],S=r;f!==0&&f!==null&&(S+=L.createUnicodeCharge(f)),g!==0&&g!==null&&(S=L.createUnicodeSuperscript(g)+S),b.push([S,r]),s===1?b.push(["H","H"]):s>1&&b.push(["H"+L.createUnicodeSubscript(s),"H"]),f===1&&r==="N"&&"0O"in m&&"0O-1"in m&&(m={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},f=0);for(let p in Object.keys(m)){let x=m[p],D=x.element;x.count>1&&(D+=L.createUnicodeSubscript(x.count)),x.charge!==""&&(D+=L.createUnicodeCharge(f)),b.push([D,x.element]),x.hydrogenCount===1?b.push(["H","H"]):x.hydrogenCount>1&&b.push(["H"+L.createUnicodeSubscript(x.hydrogenCount),"H"])}this.write(b,e,t,i,c===1)}write(t,i,r,s,e){let l=L.measureText(t[0][1],this.opts.fontSizeLarge,this.opts.fontFamily);i==="left"&&t[0][0]!==t[0][1]&&(l.width*=2),e?(r+l.width*t.length>this.maxX&&(this.maxX=r+l.width*t.length),r-l.width/2<this.minX&&(this.minX=r-l.width/2),s-l.height<this.minY&&(this.minY=s-l.height),s+l.height>this.maxY&&(this.maxY=s+l.height)):(i!=="right"?(r+l.width*t.length>this.maxX&&(this.maxX=r+l.width*t.length),r-l.width*t.length<this.minX&&(this.minX=r-l.width*t.length)):i!=="left"&&(r+l.width*t.length>this.maxX&&(this.maxX=r+l.width*t.length),r-l.width/2<this.minX&&(this.minX=r-l.width/2)),s-l.height<this.minY&&(this.minY=s-l.height),s+l.height>this.maxY&&(this.maxY=s+l.height),i==="down"&&s+.8*l.height*t.length>this.maxY&&(this.maxY=s+.8*l.height*t.length),i==="up"&&s-.8*l.height*t.length<this.minY&&(this.minY=s-.8*l.height*t.length));let f=r,g=s,c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttributeNS(null,"class","element");let m=document.createElementNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"fill","#ffffff"),i==="left"&&(t=t.reverse()),(i==="right"||i==="down"||i==="up")&&(r-=l.width/2),i==="left"&&(r+=l.width/2),t.forEach((p,x)=>{let D=p[0],M=p[1],z=document.createElementNS("http://www.w3.org/2000/svg","tspan");z.setAttributeNS(null,"fill",this.themeManager.getColor(M)),z.textContent=D,(i==="up"||i==="down")&&(z.setAttributeNS(null,"x","0px"),i==="up"?z.setAttributeNS(null,"y",`-${.9*x}em`):z.setAttributeNS(null,"y",`${.9*x}em`)),c.appendChild(z)}),c.setAttributeNS(null,"data-direction",i),i==="left"||i==="right"?(c.setAttributeNS(null,"dominant-baseline","alphabetic"),c.setAttributeNS(null,"y","0.36em")):c.setAttributeNS(null,"dominant-baseline","central"),i==="left"&&c.setAttributeNS(null,"text-anchor","end"),m.appendChild(c),m.setAttributeNS(null,"style",`transform: translateX(${r}px) translateY(${s}px)`);let b=this.opts.fontSizeLarge*.75;t[0][1].length>1&&(b=this.opts.fontSizeLarge*1.1);let S=document.createElementNS("http://www.w3.org/2000/svg","circle");S.setAttributeNS(null,"cx",f),S.setAttributeNS(null,"cy",g),S.setAttributeNS(null,"r",b),S.setAttributeNS(null,"fill","black"),this.maskElements.push(S),this.vertices.push(m)}toCanvas(t,i,r){(typeof t=="string"||t instanceof String)&&(t=document.getElementById(t));let s=new Image;s.onload=function(){t.width=i,t.height=r,t.getContext("2d").drawImage(s,0,0,i,r)},s.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(this.svg.outerHTML)}static createUnicodeSubscript(t){let i="";return t.toString().split("").forEach(r=>{i+=["\u2080","\u2081","\u2082","\u2083","\u2084","\u2085","\u2086","\u2087","\u2088","\u2089"][parseInt(r)]}),i}static createUnicodeSuperscript(t){let i="";return t.toString().split("").forEach(r=>{let s=parseInt(r);Number.isFinite(s)&&(i+=["\u2070","\xB9","\xB2","\xB3","\u2074","\u2075","\u2076","\u2077","\u2078","\u2079"][s])}),i}static replaceNumbersWithSubscript(t){let i={0:"\u2080",1:"\u2081",2:"\u2082",3:"\u2083",4:"\u2084",5:"\u2085",6:"\u2086",7:"\u2087",8:"\u2088",9:"\u2089"};for(let[r,s]of Object.entries(i))t=t.replaceAll(r,s);return t}static measureText(t,i,r,s=.9){let l=document.createElement("canvas").getContext("2d");l.font=`${i}pt ${r}`;let f=l.measureText(t),g=Math.abs(f.actualBoundingBoxLeft)+Math.abs(f.actualBoundingBoxRight);return{width:f.width>g?f.width:g,height:(Math.abs(f.actualBoundingBoxAscent)+Math.abs(f.actualBoundingBoxAscent))*s}}static svgToCanvas(t,i,r,s,e=null){t.setAttributeNS(null,"width",r),t.setAttributeNS(null,"height",s);let l=new Image;return l.onload=function(){i.width=r,i.height=s;let f=i.getContext("2d");f.imageSmoothingEnabled=!1,f.drawImage(l,0,0,r,s),e&&e(i)},l.onerror=function(f){console.log(f)},l.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(t.outerHTML),i}static svgToImg(t,i,r,s){let e=document.createElement("canvas");this.svgToCanvas(t,e,r,s,()=>{i.src=e.toDataURL("image/png")})}static writeText(t,i,r,s,e=Number.MAX_SAFE_INTEGER){let l=document.createElementNS("http://www.w3.org/2000/svg","svg"),f=document.createElementNS("http://www.w3.org/2000/svg","style");f.appendChild(document.createTextNode(`
        .text {
            font: ${r}pt ${s};
            dominant-baseline: ideographic;
        }
    `)),l.appendChild(f);let g=document.createElementNS("http://www.w3.org/2000/svg","text");g.setAttributeNS(null,"class","text");let c=0,m=0,b=[];return t.split(`
`).forEach(S=>{let p=L.measureText(S,r,s,1);if(p.width>=e){let x=0,D=0,M=S.split(" "),z=0;for(let W=0;W<M.length;W++){let F=L.measureText(M[W],r,s,1);x+F.width>e&&(b.push({text:M.slice(z,W).join(" "),width:x,height:D}),x=0,D=0,z=W),F.height>D&&(D=F.height),x+=F.width}z<M.length&&b.push({text:M.slice(z,M.length).join(" "),width:x,height:D})}else b.push({text:S,width:p.width,height:p.height})}),b.forEach(S=>{m+=S.height;let p=document.createElementNS("http://www.w3.org/2000/svg","tspan");p.setAttributeNS(null,"fill",i.getColor("C")),p.textContent=S.text,p.setAttributeNS(null,"x","0px"),p.setAttributeNS(null,"y",`${m}px`),g.appendChild(p),S.width>c&&(c=S.width)}),l.appendChild(g),{svg:l,width:c,height:m}}};var st=class{constructor(t,i=!0){this.preprocessor=new ci(t),this.opts=this.preprocessor.opts,this.clear=i,this.svgWrapper=null}draw(t,i,r="light",s=null,e=!1,l=[],f=!1){i===null||i==="svg"?(i=document.createElementNS("http://www.w3.org/2000/svg","svg"),i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),i.setAttributeNS(null,"width",this.opts.width),i.setAttributeNS(null,"height",this.opts.height)):i instanceof String&&(i=document.getElementById(i));let g={padding:this.opts.padding,compactDrawing:this.opts.compactDrawing};s!==null&&(this.opts.padding+=this.opts.weights.additionalPadding,this.opts.compactDrawing=!1);let c=this.preprocessor;return c.initDraw(t,r,e,l),e||(this.themeManager=new yt(this.opts.themes,r),(this.svgWrapper===null||this.clear)&&(this.svgWrapper=new Ze(this.themeManager,i,this.opts,this.clear))),c.processGraph(),this.svgWrapper.determineDimensions(c.graph.vertices),this.drawAtomHighlights(c.opts.debug),this.drawEdges(c.opts.debug),this.drawVertices(c.opts.debug),s!==null&&this.drawWeights(s,f),c.opts.debug&&console.debug("SvgDrawer::draw()",{graph:c.graph,rings:c.rings,ringConnections:c.ringConnections}),this.svgWrapper.constructSvg(),s!==null&&(this.opts.padding=g.padding,this.opts.compactDrawing=g.padding),i}drawCanvas(t,i,r="light",s=!1){let e=null;typeof i=="string"||i instanceof String?e=document.getElementById(i):e=i;let l=document.createElementNS("http://www.w3.org/2000/svg","svg");return l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttributeNS(null,"viewBox","0 0 500 500"),l.setAttributeNS(null,"width","500"),l.setAttributeNS(null,"height","500"),l.setAttributeNS(null,"style","visibility: hidden: position: absolute; left: -1000px"),document.body.appendChild(l),this.draw(t,l,r,s),this.svgWrapper.toCanvas(e,this.opts.width,this.opts.height),document.body.removeChild(l),i}drawAromaticityRing(t){this.svgWrapper.drawRing(t.center.x,t.center.y,t.getSize())}drawEdges(t){let i=this.preprocessor,r=i.graph,s=i.rings,e=Array(this.preprocessor.graph.edges.length);if(e.fill(!1),r.traverseBF(0,l=>{let f=r.getEdges(l.id);for(let g=0;g<f.length;g++){let c=f[g];e[c]||(e[c]=!0,this.drawEdge(c,t))}}),!this.bridgedRing)for(let l=0;l<s.length;l++){let f=s[l];i.isRingAromatic(f)&&this.drawAromaticityRing(f)}}drawEdge(t,i){let r=this.preprocessor,s=r.opts,e=this.svgWrapper,l=r.graph.edges[t],f=r.graph.vertices[l.sourceId],g=r.graph.vertices[l.targetId],c=f.value.element,m=g.value.element;if((!f.value.isDrawn||!g.value.isDrawn)&&r.opts.atomVisualization==="default")return;let b=f.position,S=g.position,p=r.getEdgeNormals(l),x=be.clone(p);if(x[0].multiplyScalar(10).add(b),x[1].multiplyScalar(10).add(b),l.bondType==="="||r.getRingbondType(f,g)==="="||l.isPartOfAromaticRing&&r.bridgedRing){let D=r.areVerticesInSameRing(f,g),M=r.chooseSide(f,g,x);if(D){let W=r.getLargestOrAromaticCommonRing(f,g).center;p[0].multiplyScalar(s.bondSpacing),p[1].multiplyScalar(s.bondSpacing);let F=null;W.sameSideAs(f.position,g.position,P.add(b,p[0]))?F=new ee(P.add(b,p[0]),P.add(S,p[0]),c,m):F=new ee(P.add(b,p[1]),P.add(S,p[1]),c,m),F.shorten(s.bondLength-s.shortBondLength*s.bondLength),l.isPartOfAromaticRing?e.drawLine(F,!0):e.drawLine(F),e.drawLine(new ee(b,S,c,m))}else if(l.center||f.isTerminal()&&g.isTerminal()||M.anCount==0&&M.bnCount>1||M.bnCount==0&&M.anCount>1){this.multiplyNormals(p,s.halfBondSpacing);let z=new ee(P.add(b,p[0]),P.add(S,p[0]),c,m),W=new ee(P.add(b,p[1]),P.add(S,p[1]),c,m);e.drawLine(z),e.drawLine(W)}else if(M.sideCount[0]>M.sideCount[1]||M.totalSideCount[0]>M.totalSideCount[1]){this.multiplyNormals(p,s.bondSpacing);let z=new ee(P.add(b,p[0]),P.add(S,p[0]),c,m);z.shorten(s.bondLength-s.shortBondLength*s.bondLength),e.drawLine(z),e.drawLine(new ee(b,S,c,m))}else if(M.sideCount[0]<M.sideCount[1]||M.totalSideCount[0]<=M.totalSideCount[1]){this.multiplyNormals(p,s.bondSpacing);let z=new ee(P.add(b,p[1]),P.add(S,p[1]),c,m);z.shorten(s.bondLength-s.shortBondLength*s.bondLength),e.drawLine(z),e.drawLine(new ee(b,S,c,m))}}else if(l.bondType==="#"){p[0].multiplyScalar(s.bondSpacing/1.5),p[1].multiplyScalar(s.bondSpacing/1.5);let D=new ee(P.add(b,p[0]),P.add(S,p[0]),c,m),M=new ee(P.add(b,p[1]),P.add(S,p[1]),c,m);e.drawLine(D),e.drawLine(M),e.drawLine(new ee(b,S,c,m))}else if(l.bondType!=="."){let D=f.value.isStereoCenter,M=g.value.isStereoCenter;l.wedge==="up"?e.drawWedge(new ee(b,S,c,m,D,M)):l.wedge==="down"?e.drawDashedWedge(new ee(b,S,c,m,D,M)):e.drawLine(new ee(b,S,c,m,D,M))}if(i){let D=P.midpoint(b,S);e.drawDebugText(D.x,D.y,"e: "+t)}}drawAtomHighlights(t){let i=this.preprocessor,r=i.graph,s=this.svgWrapper;for(let e=0;e<r.vertices.length;e++){let l=r.vertices[e],f=l.value;for(let g=0;g<i.highlight_atoms.length;g++){let c=i.highlight_atoms[g];f.class===c[0]&&s.drawAtomHighlight(l.position.x,l.position.y,c[1])}}}drawVertices(t){let i=this.preprocessor,r=i.opts,s=i.graph,e=i.rings,l=this.svgWrapper;for(let f=0;f<s.vertices.length;f++){let g=s.vertices[f],c=g.value,m=0,b=0,S=g.value.bondCount,p=c.element,x=Ue.maxBonds[p]-S,D=g.getTextDirection(s.vertices,c.hasAttachedPseudoElements),M=r.terminalCarbons||p!=="C"||c.hasAttachedPseudoElements?g.isTerminal():!1,z=c.element==="C";if(c.element==="N"&&c.isPartOfAromaticRing&&(x=0),c.bracket&&(x=c.bracket.hcount,m=c.bracket.charge,b=c.bracket.isotope),(m||b||s.vertices.length<3)&&(z=!1),r.atomVisualization==="allballs")l.drawBall(g.position.x,g.position.y,p);else if(c.isDrawn&&(!z||c.drawExplicit||M||c.hasAttachedPseudoElements)||s.vertices.length===1)if(r.atomVisualization==="default"){let W=c.getAttachedPseudoElements();c.hasAttachedPseudoElements&&s.vertices.length===Object.keys(W).length+1&&(D="right"),l.drawText(g.position.x,g.position.y,p,x,D,M,m,b,s.vertices.length,W)}else r.atomVisualization==="balls"&&l.drawBall(g.position.x,g.position.y,p);else if(g.getNeighbourCount()===2&&g.forcePositioned==!0){let W=s.vertices[g.neighbours[0]].position,F=s.vertices[g.neighbours[1]].position,k=P.threePointangle(g.position,W,F);Math.abs(Math.PI-k)<.1&&l.drawPoint(g.position.x,g.position.y,p)}if(t){let W="v: "+g.id+" "+be.print(c.ringbonds);l.drawDebugText(g.position.x,g.position.y,W)}}if(r.debug)for(let f=0;f<e.length;f++){let g=e[f].center;l.drawDebugPoint(g.x,g.y,"r: "+e[f].id)}}drawWeights(t,i){if(!t||t.every(e=>e===0))return;if(t.length!==this.preprocessor.graph.atomIdxToVertexId.length)throw new Error("The number of weights supplied must be equal to the number of (heavy) atoms in the molecule.");let r=[];for(let e of this.preprocessor.graph.atomIdxToVertexId){let l=this.preprocessor.graph.vertices[e];r.push(new P(l.position.x-this.svgWrapper.minX,l.position.y-this.svgWrapper.minY))}let s=new Gt(r,t,this.svgWrapper.drawingWidth,this.svgWrapper.drawingHeight,this.opts.weights.sigma,this.opts.weights.interval,this.opts.weights.colormap,this.opts.weights.opacity,i);s.draw(),this.svgWrapper.addLayer(s.getSVG())}getTotalOverlapScore(){return this.preprocessor.getTotalOverlapScore()}getMolecularFormula(t=null){return this.preprocessor.getMolecularFormula(t)}multiplyNormals(t,i){t[0].multiplyScalar(i),t[1].multiplyScalar(i)}};var dr=class{constructor(t){this.svgDrawer=new st(t)}draw(t,i,r="light",s=!1,e=[]){let l=null,f=null;if(i instanceof String?l=document.getElementById(i.valueOf()):typeof i=="string"?l=document.getElementById(i):l=i,l instanceof HTMLCanvasElement)f=l;else throw Error("First argument was not a canvas or the ID of a canvas.");let g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttribute("xmlns","http://www.w3.org/2000/svg"),g.setAttributeNS(null,"viewBox","0 0 "+this.svgDrawer.opts.width+" "+this.svgDrawer.opts.height),g.setAttributeNS(null,"width",this.svgDrawer.opts.width+""),g.setAttributeNS(null,"height",this.svgDrawer.opts.height+""),this.svgDrawer.draw(t,g,r,null,s,e),this.svgDrawer.svgWrapper.toCanvas(f,this.svgDrawer.opts.width,this.svgDrawer.opts.height)}getTotalOverlapScore(){return this.svgDrawer.getTotalOverlapScore()}getMolecularFormula(){return this.svgDrawer.getMolecularFormula()}};var At=function(){"use strict";function L(r,s){function e(){this.constructor=r}e.prototype=s.prototype,r.prototype=new e}function t(r,s,e,l){this.message=r,this.expected=s,this.found=e,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,t)}L(t,Error),t.buildMessage=function(r,s){var e={literal:function(S){return'"'+f(S.text)+'"'},class:function(S){var p="",x;for(x=0;x<S.parts.length;x++)p+=S.parts[x]instanceof Array?g(S.parts[x][0])+"-"+g(S.parts[x][1]):g(S.parts[x]);return"["+(S.inverted?"^":"")+p+"]"},any:function(S){return"any character"},end:function(S){return"end of input"},other:function(S){return S.description}};function l(S){return S.charCodeAt(0).toString(16).toUpperCase()}function f(S){return S.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+l(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+l(p)})}function g(S){return S.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+l(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+l(p)})}function c(S){return e[S.type](S)}function m(S){var p=new Array(S.length),x,D;for(x=0;x<S.length;x++)p[x]=c(S[x]);if(p.sort(),p.length>0){for(x=1,D=1;x<p.length;x++)p[x-1]!==p[x]&&(p[D]=p[x],D++);p.length=D}switch(p.length){case 1:return p[0];case 2:return p[0]+" or "+p[1];default:return p.slice(0,-1).join(", ")+", or "+p[p.length-1]}}function b(S){return S?'"'+f(S)+'"':"end of input"}return"Expected "+m(r)+" but "+b(s)+" found."};function i(r,s){s=s!==void 0?s:{};var e={},l={start:un},f=un,g="|",c=B("|",!1),m=function(u,o){return o&&o[1]&&(u.extended=o[1]),u},b=function(u){for(var o=[],w=[],v=0;v<u[1].length;v++)o.push(u[1][v]);for(var v=0;v<u[2].length;v++){var I=u[2][v][0]?u[2][v][0]:"-";w.push({bond:I,id:u[2][v][1]})}for(var v=0;v<u[3].length;v++)o.push(u[3][v]);for(var v=0;v<u[6].length;v++)o.push(u[6][v]);return{atom:u[0],isBracket:!!u[0].element,branches:o,branchCount:o.length,ringbonds:w,ringbondCount:w.length,bond:u[4]?u[4]:"-",next:u[5],hasNext:!!u[5]}},S="(",p=B("(",!1),x=")",D=B(")",!1),M=function(u){var o=u[1]?u[1]:"-";return u[2].branchBond=o,u[2]},z=function(u){return u},W=/^[\-=#$:\/\\.]/,F=Se(["-","=","#","$",":","/","\\","."],!1,!1),k=function(u){return u},_="[",j=B("[",!1),Q="]",oe=B("]",!1),ae=function(u){return{isotope:u[0],element:u[1],chirality:u[2],hcount:u[3],charge:u[4],class:u[5]}},Ae="se",Ke=B("se",!1),Je="as",Le=B("as",!1),Ne=function(u){return u},Ye=/^[A-Z]/,He=Se([["A","Z"]],!1,!1),Qe=/^[A-Za-z0-9]/,_e=Se([["A","Z"],["a","z"],["0","9"]],!1,!1),K=function(u){return Array.isArray(u)?u[0]+(u[1]?u[1].join(""):""):u},se="B",me=B("B",!1),ke="r",ye=B("r",!1),Re="C",$e=B("C",!1),Me="l",Ct=B("l",!1),It=/^[NOPSFI]/,et=Se(["N","O","P","S","F","I"],!1,!1),at=function(u){return u.length>1?u.join(""):u},Pt=/^[bcnops]/,De=Se(["b","c","n","o","p","s"],!1,!1),Oe="*",lt=B("*",!1),ot=function(u){return u},je="Ac",Dt=B("Ac",!1),vr="Ag",pi=B("Ag",!1),mr="Al",vi=B("Al",!1),br="Am",mi=B("Am",!1),wr="Ar",bi=B("Ar",!1),yr="As",wi=B("As",!1),Sr="At",yn=B("At",!1),yi="Au",Si=B("Au",!1),Ai=/^[aehikr]/,Sn=Se(["a","e","h","i","k","r"],!1,!1),An=/^[adeflmnorsu]/,Ci=Se(["a","d","e","f","l","m","n","o","r","s","u"],!1,!1),Ar="Db",Cn=B("Db",!1),$i="Ds",$n=B("Ds",!1),xi="Dy",xn=B("Dy",!1),Ni="Er",Nn=B("Er",!1),Ri="Es",Rn=B("Es",!1),ki="Eu",kn=B("Eu",!1),En="F",Tn=B("F",!1),Ei=/^[elmr]/,Ti=Se(["e","l","m","r"],!1,!1),Li="Ga",Ln=B("Ga",!1),Kt="Ge",Ot=B("Ge",!1),Mi="Gd",Bi=B("Gd",!1),Ii="H",Pi=B("H",!1),Mn=/^[efgos]/,Di=Se(["e","f","g","o","s"],!1,!1),Bn="I",Oi=B("I",!1),In=/^[nr]/,Fi=Se(["n","r"],!1,!1),Pn="K",Dn=B("K",!1),zi=/^[r]/,On=Se(["r"],!1,!1),Hi="La",Fn=B("La",!1),_i="Li",zn=B("Li",!1),Wi="Lr",Cr=B("Lr",!1),ht="Lu",$r=B("Lu",!1),ft="Lv",Hn=B("Lv",!1),Xi="Mc",_n=B("Mc",!1),Vi="Md",Wn=B("Md",!1),xr="Mg",Yi=B("Mg",!1),ji="Mn",Xn=B("Mn",!1),qi="Mo",Vn=B("Mo",!1),Nr="Mt",Gi=B("Mt",!1),Yn="N",jn=B("N",!1),qn=/^[abdehiop]/,Gn=Se(["a","b","d","e","h","i","o","p"],!1,!1),Un="O",Zn=B("O",!1),Kn=/^[gs]/,Jn=Se(["g","s"],!1,!1),Qn="P",ea=B("P",!1),ta=/^[abdmortu]/,ra=Se(["a","b","d","m","o","r","t","u"],!1,!1),Ui="Ra",Zi=B("Ra",!1),Rr="Rb",ia=B("Rb",!1),Ft="Re",$t=B("Re",!1),Ki="Rf",Ji=B("Rf",!1),Qi="Rg",kr=B("Rg",!1),Jt="Rh",sa=B("Rh",!1),Er="Rn",xt=B("Rn",!1),es="Ru",na=B("Ru",!1),aa="S",Tr=B("S",!1),Lr=/^[bcegimnr]/,ts=Se(["b","c","e","g","i","m","n","r"],!1,!1),rs="Ta",la=B("Ta",!1),is="Tb",ss=B("Tb",!1),Mr="Tc",oa=B("Tc",!1),ns="Te",ha=B("Te",!1),as="Th",fa=B("Th",!1),ls="Ti",ga=B("Ti",!1),Br="Tl",ua=B("Tl",!1),os="Tm",ca=B("Tm",!1),hs="Ts",da=B("Ts",!1),pa="U",va=B("U",!1),ma="V",ba=B("V",!1),wa="W",fs=B("W",!1),gs="Xe",ya=B("Xe",!1),Sa="Y",Aa=B("Y",!1),us="b",Ca=B("b",!1),cs="Zn",$a=B("Zn",!1),ds="Zr",xa=B("Zr",!1),Na=function(u){return Array.isArray(u)?u.join(""):u},ps="%",Qt=B("%",!1),qe=/^[1-9]/,tt=Se([["1","9"]],!1,!1),We=/^[0-9]/,Fe=Se([["0","9"]],!1,!1),Ra=function(u){return u.length==1?Number(u):Number(u.join("").replace("%",""))},Ir="@",vs=B("@",!1),Nt="TH",ka=B("TH",!1),ms=/^[12]/,bs=Se(["1","2"],!1,!1),ws="AL",Ea=B("AL",!1),ys="SP",Ta=B("SP",!1),La=/^[1-3]/,Ma=Se([["1","3"]],!1,!1),Pr="TB",Ss=B("TB",!1),As="OH",Ba=B("OH",!1),Ia=function(u){return u[1]?u[1]=="@"?"@@":u[1].join("").replace(",",""):"@"},Dr=function(u){return u},Or="+",Fr=B("+",!1),Cs=function(u){return u[1]?u[1]!="+"?Number(u[1].join("")):2:1},zr="-",zt=B("-",!1),Pa=function(u){return u[1]?u[1]!="-"?-Number(u[1].join("")):-2:-1},$s=function(u){return u[1]?Number(u[1]):1},Da=":",Oa=B(":",!1),Fa=/^[0]/,za=Se(["0"],!1,!1),Ha=function(u){return Number(u[1][0]+u[1][1].join(""))},Hr=function(u){return Number(u.join(""))},gt="$",Rt=B("$",!1),xs=",",Ns=B(",",!1),_r=function(u){for(var o=Array(u.length),w=0;w<u.length;w++)o[w]={property:u[w][0]==="$"?u[w][0]:u[w][0].slice(0,-1),value:u[w][1]};return o},er=";",tr=B(";",!1),_a=function(u){for(var o=Array(u.length),w=0;w<u.length;w++)u[w][0]===";"?o[w]=null:o[w]=u[w][0];return o},Wr="_p",Xr=B("_p",!1),Rs="_e",rr=B("_e",!1),Wa=function(u){return u},ks="_R",Es=B("_R",!1),Vr=function(u){return[u[1],u[0]]},Ts=/^[a-z0-9,;:.()-_]/i,Ls=Se([["a","z"],["0","9"],",",";",":",".","(",[")","_"]],!1,!0),Ms=function(u){return u},Bs=lr("cxdelimiters"),Yr="$_AV:",Xa=B("$_AV:",!1),ir="LN:",Is=B("LN:",!1),Ps="atomprop:",Va=B("atomprop:",!1),Ds="LP:",Ya=B("LP:",!1),Os="lp:",ja=B("lp:",!1),Fs="C:",qa=B("C:",!1),zs="c:",Ga=B("c:",!1),Hs="t:",_s=B("t:",!1),jr="ctu:",Ua=B("ctu:",!1),qr="f:",Za=B("f:",!1),Ws="H:",ut=B("H:",!1),Xs="r:",Ka=B("r:",!1),ct="w:",Ja=B("w:",!1),Vs="wU:",Qa=B("wU:",!1),Ys="wD:",el=B("wD:",!1),sr="@:",Pe=B("@:",!1),Gr="@@:",js=B("@@:",!1),Ht="THB:",qs=B("THB:",!1),Ur="TLB:",tl=B("TLB:",!1),Zr="TEB:",Kr=B("TEB:",!1),Gs="^1:",Us=B("^1:",!1),Jr="^2:",rl=B("^2:",!1),Zs="^3:",il=B("^3:",!1),nr="^4:",kt=B("^4:",!1),Ks="^5:",sl=B("^5:",!1),Js="^6:",Qs=B("^6:",!1),dt="^7:",nl=B("^7:",!1),Qr="M:",al=B("M:",!1),en="SgD:",ll=B("SgD:",!1),tn="RG:",ol=B("RG:",!1),rn="LO:",hl=B("LO:",!1),sn="Sg:",fl=B("Sg:",!1),nn="SgH:",gl=B("SgH:",!1),ul=lr("cxtext"),an=/^[a-z0-9]/i,ln=Se([["a","z"],["0","9"]],!1,!0),ei=function(u){return u.join("")},cl=lr("whitespace"),ti="	",ri=B("	",!1),ii="\v",on=B("\v",!1),hn="\f",dl=B("\f",!1),pl=" ",vl=B(" ",!1),Xe="\xA0",Et=B("\xA0",!1),ml="\uFEFF",si=B("\uFEFF",!1),bl=/^[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,_t=Se([" ","\xA0","\u1680",["\u2000","\u200A"],"\u202F","\u205F","\u3000"],!1,!1),n=0,fe=0,ar=[{line:1,column:1}],Ge=0,Wt=[],C=0,Ve;if("startRule"in s){if(!(s.startRule in l))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');f=l[s.startRule]}function pt(){return r.substring(fe,n)}function Fl(){return vt(fe,n)}function zl(u,o){throw o=o!==void 0?o:vt(fe,n),gn([lr(u)],r.substring(fe,n),o)}function Hl(u,o){throw o=o!==void 0?o:vt(fe,n),yl(u,o)}function B(u,o){return{type:"literal",text:u,ignoreCase:o}}function Se(u,o,w){return{type:"class",parts:u,inverted:o,ignoreCase:w}}function _l(){return{type:"any"}}function wl(){return{type:"end"}}function lr(u){return{type:"other",description:u}}function fn(u){var o=ar[u],w;if(o)return o;for(w=u-1;!ar[w];)w--;for(o=ar[w],o={line:o.line,column:o.column};w<u;)r.charCodeAt(w)===10?(o.line++,o.column=1):o.column++,w++;return ar[u]=o,o}function vt(u,o){var w=fn(u),v=fn(o);return{start:{offset:u,line:w.line,column:w.column},end:{offset:o,line:v.line,column:v.column}}}function R(u){n<Ge||(n>Ge&&(Ge=n,Wt=[]),Wt.push(u))}function yl(u,o){return new t(u,null,null,o)}function gn(u,o,w){return new t(t.buildMessage(u,o),u,o,w)}function un(){var u,o,w,v,I,Y,G;if(u=n,o=ni(),o!==e){for(w=[],v=oi();v!==e;)w.push(v),v=oi();w!==e?(v=n,r.charCodeAt(n)===124?(I=g,n++):(I=e,C===0&&R(c)),I!==e?(Y=rt(),Y!==e?(r.charCodeAt(n)===124?(G=g,n++):(G=e,C===0&&R(c)),G!==e?(I=[I,Y,G],v=I):(n=v,v=e)):(n=v,v=e)):(n=v,v=e),v===e&&(v=null),v!==e?(fe=u,o=m(o,v),u=o):(n=u,u=e)):(n=u,u=e)}else n=u,u=e;return u}function ni(){var u,o,w,v,I,Y,G,xe,fr,bt;if(u=n,o=n,w=Sl(),w!==e){for(v=[],I=mt();I!==e;)v.push(I),I=mt();if(v!==e){for(I=[],Y=n,G=or(),G===e&&(G=null),G!==e?(xe=cn(),xe!==e?(G=[G,xe],Y=G):(n=Y,Y=e)):(n=Y,Y=e);Y!==e;)I.push(Y),Y=n,G=or(),G===e&&(G=null),G!==e?(xe=cn(),xe!==e?(G=[G,xe],Y=G):(n=Y,Y=e)):(n=Y,Y=e);if(I!==e){for(Y=[],G=mt();G!==e;)Y.push(G),G=mt();if(Y!==e)if(G=or(),G===e&&(G=null),G!==e)if(xe=ni(),xe===e&&(xe=null),xe!==e){for(fr=[],bt=mt();bt!==e;)fr.push(bt),bt=mt();fr!==e?(w=[w,v,I,Y,G,xe,fr],o=w):(n=o,o=e)}else n=o,o=e;else n=o,o=e;else n=o,o=e}else n=o,o=e}else n=o,o=e}else n=o,o=e;return o!==e&&(fe=u,o=b(o)),u=o,u}function mt(){var u,o,w,v,I,Y;return u=n,o=n,r.charCodeAt(n)===40?(w=S,n++):(w=e,C===0&&R(p)),w!==e?(v=or(),v===e&&(v=null),v!==e?(I=ni(),I!==e?(r.charCodeAt(n)===41?(Y=x,n++):(Y=e,C===0&&R(D)),Y!==e?(w=[w,v,I,Y],o=w):(n=o,o=e)):(n=o,o=e)):(n=o,o=e)):(n=o,o=e),o!==e&&(fe=u,o=M(o)),u=o,u}function Sl(){var u,o;return u=n,o=xl(),o===e&&(o=hr(),o===e&&(o=Al(),o===e&&(o=ai()))),o!==e&&(fe=u,o=z(o)),u=o,u}function or(){var u,o;return u=n,W.test(r.charAt(n))?(o=r.charAt(n),n++):(o=e,C===0&&R(F)),o!==e&&(fe=u,o=k(o)),u=o,u}function Al(){var u,o,w,v;return u=n,r.charCodeAt(n)===91?(o=_,n++):(o=e,C===0&&R(j)),o!==e?(w=Cl(),w!==e?(r.charCodeAt(n)===93?(v=Q,n++):(v=e,C===0&&R(oe)),v!==e?(fe=u,o=ae(w),u=o):(n=u,u=e)):(n=u,u=e)):(n=u,u=e),u}function Cl(){var u,o,w,v,I,Y,G,xe;return u=n,o=n,w=bn(),w===e&&(w=null),w!==e?(r.substr(n,2)===Ae?(v=Ae,n+=2):(v=e,C===0&&R(Ke)),v===e&&(r.substr(n,2)===Je?(v=Je,n+=2):(v=e,C===0&&R(Le)),v===e&&(v=hr(),v===e&&(v=$l(),v===e&&(v=Nl(),v===e&&(v=ai()))))),v!==e?(I=Rl(),I===e&&(I=null),I!==e?(Y=mn(),Y===e&&(Y=null),Y!==e?(G=dn(),G===e&&(G=null),G!==e?(xe=kl(),xe===e&&(xe=null),xe!==e?(w=[w,v,I,Y,G,xe],o=w):(n=o,o=e)):(n=o,o=e)):(n=o,o=e)):(n=o,o=e)):(n=o,o=e)):(n=o,o=e),o!==e&&(fe=u,o=Ne(o)),u=o,u}function $l(){var u,o,w,v,I;if(u=n,o=n,Ye.test(r.charAt(n))?(w=r.charAt(n),n++):(w=e,C===0&&R(He)),w!==e){for(v=[],Qe.test(r.charAt(n))?(I=r.charAt(n),n++):(I=e,C===0&&R(_e));I!==e;)v.push(I),Qe.test(r.charAt(n))?(I=r.charAt(n),n++):(I=e,C===0&&R(_e));v!==e?(w=[w,v],o=w):(n=o,o=e)}else n=o,o=e;return o!==e&&(fe=u,o=K(o)),u=o,u}function xl(){var u,o,w,v;return u=n,o=n,r.charCodeAt(n)===66?(w=se,n++):(w=e,C===0&&R(me)),w!==e?(r.charCodeAt(n)===114?(v=ke,n++):(v=e,C===0&&R(ye)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(o=n,r.charCodeAt(n)===67?(w=Re,n++):(w=e,C===0&&R($e)),w!==e?(r.charCodeAt(n)===108?(v=Me,n++):(v=e,C===0&&R(Ct)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(It.test(r.charAt(n))?(o=r.charAt(n),n++):(o=e,C===0&&R(et)))),o!==e&&(fe=u,o=at(o)),u=o,u}function hr(){var u,o;return u=n,Pt.test(r.charAt(n))?(o=r.charAt(n),n++):(o=e,C===0&&R(De)),o!==e&&(fe=u,o=z(o)),u=o,u}function ai(){var u,o;return u=n,r.charCodeAt(n)===42?(o=Oe,n++):(o=e,C===0&&R(lt)),o!==e&&(fe=u,o=ot(o)),u=o,u}function Nl(){var u,o,w,v;return u=n,r.substr(n,2)===je?(o=je,n+=2):(o=e,C===0&&R(Dt)),o===e&&(r.substr(n,2)===vr?(o=vr,n+=2):(o=e,C===0&&R(pi)),o===e&&(r.substr(n,2)===mr?(o=mr,n+=2):(o=e,C===0&&R(vi)),o===e&&(r.substr(n,2)===br?(o=br,n+=2):(o=e,C===0&&R(mi)),o===e&&(r.substr(n,2)===wr?(o=wr,n+=2):(o=e,C===0&&R(bi)),o===e&&(r.substr(n,2)===yr?(o=yr,n+=2):(o=e,C===0&&R(wi)),o===e&&(r.substr(n,2)===Sr?(o=Sr,n+=2):(o=e,C===0&&R(yn)),o===e&&(r.substr(n,2)===yi?(o=yi,n+=2):(o=e,C===0&&R(Si)),o===e&&(o=n,r.charCodeAt(n)===66?(w=se,n++):(w=e,C===0&&R(me)),w!==e?(Ai.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Sn)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(o=n,r.charCodeAt(n)===67?(w=Re,n++):(w=e,C===0&&R($e)),w!==e?(An.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Ci)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(r.substr(n,2)===Ar?(o=Ar,n+=2):(o=e,C===0&&R(Cn)),o===e&&(r.substr(n,2)===$i?(o=$i,n+=2):(o=e,C===0&&R($n)),o===e&&(r.substr(n,2)===xi?(o=xi,n+=2):(o=e,C===0&&R(xn)),o===e&&(r.substr(n,2)===Ni?(o=Ni,n+=2):(o=e,C===0&&R(Nn)),o===e&&(r.substr(n,2)===Ri?(o=Ri,n+=2):(o=e,C===0&&R(Rn)),o===e&&(r.substr(n,2)===ki?(o=ki,n+=2):(o=e,C===0&&R(kn)),o===e&&(o=n,r.charCodeAt(n)===70?(w=En,n++):(w=e,C===0&&R(Tn)),w!==e?(Ei.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Ti)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(r.substr(n,2)===Li?(o=Li,n+=2):(o=e,C===0&&R(Ln)),o===e&&(r.substr(n,2)===Kt?(o=Kt,n+=2):(o=e,C===0&&R(Ot)),o===e&&(r.substr(n,2)===Mi?(o=Mi,n+=2):(o=e,C===0&&R(Bi)),o===e&&(r.substr(n,2)===Kt?(o=Kt,n+=2):(o=e,C===0&&R(Ot)),o===e&&(o=n,r.charCodeAt(n)===72?(w=Ii,n++):(w=e,C===0&&R(Pi)),w!==e?(Mn.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Di)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(o=n,r.charCodeAt(n)===73?(w=Bn,n++):(w=e,C===0&&R(Oi)),w!==e?(In.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Fi)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(o=n,r.charCodeAt(n)===75?(w=Pn,n++):(w=e,C===0&&R(Dn)),w!==e?(zi.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(On)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(r.substr(n,2)===Hi?(o=Hi,n+=2):(o=e,C===0&&R(Fn)),o===e&&(r.substr(n,2)===_i?(o=_i,n+=2):(o=e,C===0&&R(zn)),o===e&&(r.substr(n,2)===Wi?(o=Wi,n+=2):(o=e,C===0&&R(Cr)),o===e&&(r.substr(n,2)===ht?(o=ht,n+=2):(o=e,C===0&&R($r)),o===e&&(r.substr(n,2)===ft?(o=ft,n+=2):(o=e,C===0&&R(Hn)),o===e&&(r.substr(n,2)===Xi?(o=Xi,n+=2):(o=e,C===0&&R(_n)),o===e&&(r.substr(n,2)===Vi?(o=Vi,n+=2):(o=e,C===0&&R(Wn)),o===e&&(r.substr(n,2)===xr?(o=xr,n+=2):(o=e,C===0&&R(Yi)),o===e&&(r.substr(n,2)===ji?(o=ji,n+=2):(o=e,C===0&&R(Xn)),o===e&&(r.substr(n,2)===qi?(o=qi,n+=2):(o=e,C===0&&R(Vn)),o===e&&(r.substr(n,2)===Nr?(o=Nr,n+=2):(o=e,C===0&&R(Gi)),o===e&&(o=n,r.charCodeAt(n)===78?(w=Yn,n++):(w=e,C===0&&R(jn)),w!==e?(qn.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Gn)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(o=n,r.charCodeAt(n)===79?(w=Un,n++):(w=e,C===0&&R(Zn)),w!==e?(Kn.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Jn)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(o=n,r.charCodeAt(n)===80?(w=Qn,n++):(w=e,C===0&&R(ea)),w!==e?(ta.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(ra)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(r.substr(n,2)===Ui?(o=Ui,n+=2):(o=e,C===0&&R(Zi)),o===e&&(r.substr(n,2)===Rr?(o=Rr,n+=2):(o=e,C===0&&R(ia)),o===e&&(r.substr(n,2)===Ft?(o=Ft,n+=2):(o=e,C===0&&R($t)),o===e&&(r.substr(n,2)===Ki?(o=Ki,n+=2):(o=e,C===0&&R(Ji)),o===e&&(r.substr(n,2)===Qi?(o=Qi,n+=2):(o=e,C===0&&R(kr)),o===e&&(r.substr(n,2)===Jt?(o=Jt,n+=2):(o=e,C===0&&R(sa)),o===e&&(r.substr(n,2)===Er?(o=Er,n+=2):(o=e,C===0&&R(xt)),o===e&&(r.substr(n,2)===es?(o=es,n+=2):(o=e,C===0&&R(na)),o===e&&(o=n,r.charCodeAt(n)===83?(w=aa,n++):(w=e,C===0&&R(Tr)),w!==e?(Lr.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(ts)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(r.substr(n,2)===rs?(o=rs,n+=2):(o=e,C===0&&R(la)),o===e&&(r.substr(n,2)===is?(o=is,n+=2):(o=e,C===0&&R(ss)),o===e&&(r.substr(n,2)===Mr?(o=Mr,n+=2):(o=e,C===0&&R(oa)),o===e&&(r.substr(n,2)===ns?(o=ns,n+=2):(o=e,C===0&&R(ha)),o===e&&(r.substr(n,2)===as?(o=as,n+=2):(o=e,C===0&&R(fa)),o===e&&(r.substr(n,2)===ls?(o=ls,n+=2):(o=e,C===0&&R(ga)),o===e&&(r.substr(n,2)===Br?(o=Br,n+=2):(o=e,C===0&&R(ua)),o===e&&(r.substr(n,2)===os?(o=os,n+=2):(o=e,C===0&&R(ca)),o===e&&(r.substr(n,2)===hs?(o=hs,n+=2):(o=e,C===0&&R(da)),o===e&&(r.charCodeAt(n)===85?(o=pa,n++):(o=e,C===0&&R(va)),o===e&&(r.charCodeAt(n)===86?(o=ma,n++):(o=e,C===0&&R(ba)),o===e&&(r.charCodeAt(n)===87?(o=wa,n++):(o=e,C===0&&R(fs)),o===e&&(r.substr(n,2)===gs?(o=gs,n+=2):(o=e,C===0&&R(ya)),o===e&&(o=n,r.charCodeAt(n)===89?(w=Sa,n++):(w=e,C===0&&R(Aa)),w!==e?(r.charCodeAt(n)===98?(v=us,n++):(v=e,C===0&&R(Ca)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(r.substr(n,2)===cs?(o=cs,n+=2):(o=e,C===0&&R($a)),o===e&&(r.substr(n,2)===ds?(o=ds,n+=2):(o=e,C===0&&R(xa)))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))),o!==e&&(fe=u,o=Na(o)),u=o,u}function cn(){var u,o,w,v,I;return u=n,o=n,r.charCodeAt(n)===37?(w=ps,n++):(w=e,C===0&&R(Qt)),w!==e?(qe.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(tt)),v!==e?(We.test(r.charAt(n))?(I=r.charAt(n),n++):(I=e,C===0&&R(Fe)),I!==e?(w=[w,v,I],o=w):(n=o,o=e)):(n=o,o=e)):(n=o,o=e),o===e&&(We.test(r.charAt(n))?(o=r.charAt(n),n++):(o=e,C===0&&R(Fe))),o!==e&&(fe=u,o=Ra(o)),u=o,u}function Rl(){var u,o,w,v,I,Y,G;return u=n,o=n,r.charCodeAt(n)===64?(w=Ir,n++):(w=e,C===0&&R(vs)),w!==e?(r.charCodeAt(n)===64?(v=Ir,n++):(v=e,C===0&&R(vs)),v===e&&(v=n,r.substr(n,2)===Nt?(I=Nt,n+=2):(I=e,C===0&&R(ka)),I!==e?(ms.test(r.charAt(n))?(Y=r.charAt(n),n++):(Y=e,C===0&&R(bs)),Y!==e?(I=[I,Y],v=I):(n=v,v=e)):(n=v,v=e),v===e&&(v=n,r.substr(n,2)===ws?(I=ws,n+=2):(I=e,C===0&&R(Ea)),I!==e?(ms.test(r.charAt(n))?(Y=r.charAt(n),n++):(Y=e,C===0&&R(bs)),Y!==e?(I=[I,Y],v=I):(n=v,v=e)):(n=v,v=e),v===e&&(v=n,r.substr(n,2)===ys?(I=ys,n+=2):(I=e,C===0&&R(Ta)),I!==e?(La.test(r.charAt(n))?(Y=r.charAt(n),n++):(Y=e,C===0&&R(Ma)),Y!==e?(I=[I,Y],v=I):(n=v,v=e)):(n=v,v=e),v===e&&(v=n,r.substr(n,2)===Pr?(I=Pr,n+=2):(I=e,C===0&&R(Ss)),I!==e?(qe.test(r.charAt(n))?(Y=r.charAt(n),n++):(Y=e,C===0&&R(tt)),Y!==e?(We.test(r.charAt(n))?(G=r.charAt(n),n++):(G=e,C===0&&R(Fe)),G===e&&(G=null),G!==e?(I=[I,Y,G],v=I):(n=v,v=e)):(n=v,v=e)):(n=v,v=e),v===e&&(v=n,r.substr(n,2)===As?(I=As,n+=2):(I=e,C===0&&R(Ba)),I!==e?(qe.test(r.charAt(n))?(Y=r.charAt(n),n++):(Y=e,C===0&&R(tt)),Y!==e?(We.test(r.charAt(n))?(G=r.charAt(n),n++):(G=e,C===0&&R(Fe)),G===e&&(G=null),G!==e?(I=[I,Y,G],v=I):(n=v,v=e)):(n=v,v=e)):(n=v,v=e)))))),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o!==e&&(fe=u,o=Ia(o)),u=o,u}function dn(){var u,o;return u=n,o=pn(),o===e&&(o=vn()),o!==e&&(fe=u,o=Dr(o)),u=o,u}function pn(){var u,o,w,v,I,Y;return u=n,o=n,r.charCodeAt(n)===43?(w=Or,n++):(w=e,C===0&&R(Fr)),w!==e?(r.charCodeAt(n)===43?(v=Or,n++):(v=e,C===0&&R(Fr)),v===e&&(v=n,qe.test(r.charAt(n))?(I=r.charAt(n),n++):(I=e,C===0&&R(tt)),I!==e?(We.test(r.charAt(n))?(Y=r.charAt(n),n++):(Y=e,C===0&&R(Fe)),Y===e&&(Y=null),Y!==e?(I=[I,Y],v=I):(n=v,v=e)):(n=v,v=e)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o!==e&&(fe=u,o=Cs(o)),u=o,u}function vn(){var u,o,w,v,I,Y;return u=n,o=n,r.charCodeAt(n)===45?(w=zr,n++):(w=e,C===0&&R(zt)),w!==e?(r.charCodeAt(n)===45?(v=zr,n++):(v=e,C===0&&R(zt)),v===e&&(v=n,qe.test(r.charAt(n))?(I=r.charAt(n),n++):(I=e,C===0&&R(tt)),I!==e?(We.test(r.charAt(n))?(Y=r.charAt(n),n++):(Y=e,C===0&&R(Fe)),Y===e&&(Y=null),Y!==e?(I=[I,Y],v=I):(n=v,v=e)):(n=v,v=e)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o!==e&&(fe=u,o=Pa(o)),u=o,u}function mn(){var u,o,w,v;return u=n,o=n,r.charCodeAt(n)===72?(w=Ii,n++):(w=e,C===0&&R(Pi)),w!==e?(We.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Fe)),v===e&&(v=null),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o!==e&&(fe=u,o=$s(o)),u=o,u}function kl(){var u,o,w,v,I,Y,G;if(u=n,o=n,r.charCodeAt(n)===58?(w=Da,n++):(w=e,C===0&&R(Oa)),w!==e){if(v=n,qe.test(r.charAt(n))?(I=r.charAt(n),n++):(I=e,C===0&&R(tt)),I!==e){for(Y=[],We.test(r.charAt(n))?(G=r.charAt(n),n++):(G=e,C===0&&R(Fe));G!==e;)Y.push(G),We.test(r.charAt(n))?(G=r.charAt(n),n++):(G=e,C===0&&R(Fe));Y!==e?(I=[I,Y],v=I):(n=v,v=e)}else n=v,v=e;v===e&&(Fa.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(za))),v!==e?(w=[w,v],o=w):(n=o,o=e)}else n=o,o=e;return o!==e&&(fe=u,o=Ha(o)),u=o,u}function bn(){var u,o,w,v,I;return u=n,o=n,qe.test(r.charAt(n))?(w=r.charAt(n),n++):(w=e,C===0&&R(tt)),w!==e?(We.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Fe)),v===e&&(v=null),v!==e?(We.test(r.charAt(n))?(I=r.charAt(n),n++):(I=e,C===0&&R(Fe)),I===e&&(I=null),I!==e?(w=[w,v,I],o=w):(n=o,o=e)):(n=o,o=e)):(n=o,o=e),o!==e&&(fe=u,o=Hr(o)),u=o,u}function rt(){var u,o,w,v,I,Y,G;for(u=n,o=[],w=n,v=Xt(),v!==e?(I=li(),I!==e?(v=[v,I],w=v):(n=w,w=e)):(n=w,w=e),w===e&&(w=n,r.charCodeAt(n)===36?(v=gt,n++):(v=e,C===0&&R(Rt)),v!==e?(I=Ce(),I!==e?(r.charCodeAt(n)===36?(Y=gt,n++):(Y=e,C===0&&R(Rt)),Y!==e?(r.charCodeAt(n)===44?(G=xs,n++):(G=e,C===0&&R(Ns)),G===e&&(G=null),G!==e?(v=[v,I,Y,G],w=v):(n=w,w=e)):(n=w,w=e)):(n=w,w=e)):(n=w,w=e));w!==e;)o.push(w),w=n,v=Xt(),v!==e?(I=li(),I!==e?(v=[v,I],w=v):(n=w,w=e)):(n=w,w=e),w===e&&(w=n,r.charCodeAt(n)===36?(v=gt,n++):(v=e,C===0&&R(Rt)),v!==e?(I=Ce(),I!==e?(r.charCodeAt(n)===36?(Y=gt,n++):(Y=e,C===0&&R(Rt)),Y!==e?(r.charCodeAt(n)===44?(G=xs,n++):(G=e,C===0&&R(Ns)),G===e&&(G=null),G!==e?(v=[v,I,Y,G],w=v):(n=w,w=e)):(n=w,w=e)):(n=w,w=e)):(n=w,w=e));return o!==e&&(fe=u,o=_r(o)),u=o,u}function Ce(){var u,o,w,v,I;if(u=n,o=[],w=n,v=wn(),v!==e?(r.charCodeAt(n)===59?(I=er,n++):(I=e,C===0&&R(tr)),I===e&&(I=null),I!==e?(v=[v,I],w=v):(n=w,w=e)):(n=w,w=e),w===e&&(r.charCodeAt(n)===59?(w=er,n++):(w=e,C===0&&R(tr))),w!==e)for(;w!==e;)o.push(w),w=n,v=wn(),v!==e?(r.charCodeAt(n)===59?(I=er,n++):(I=e,C===0&&R(tr)),I===e&&(I=null),I!==e?(v=[v,I],w=v):(n=w,w=e)):(n=w,w=e),w===e&&(r.charCodeAt(n)===59?(w=er,n++):(w=e,C===0&&R(tr)));else o=e;return o!==e&&(fe=u,o=_a(o)),u=o,u}function wn(){var u,o,w,v;return u=n,o=n,w=Vt(),w!==e?(r.substr(n,2)===Wr?(v=Wr,n+=2):(v=e,C===0&&R(Xr)),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(o=n,w=Vt(),w!==e?(r.substr(n,2)===Rs?(v=Rs,n+=2):(v=e,C===0&&R(rr)),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o===e&&(o=El())),o!==e&&(fe=u,o=Wa(o)),u=o,u}function El(){var u,o,w,v;return u=n,o=n,r.substr(n,2)===ks?(w=ks,n+=2):(w=e,C===0&&R(Es)),w!==e?(qe.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(tt)),v!==e?(w=[w,v],o=w):(n=o,o=e)):(n=o,o=e),o!==e&&(fe=u,o=Vr(o)),u=o,u}function li(){var u,o,w,v;if(u=[],o=n,w=n,C++,v=Xt(),C--,v===e?w=void 0:(n=w,w=e),w!==e?(Ts.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Ls)),v!==e?(fe=o,w=Ms(v),o=w):(n=o,o=e)):(n=o,o=e),o!==e)for(;o!==e;)u.push(o),o=n,w=n,C++,v=Xt(),C--,v===e?w=void 0:(n=w,w=e),w!==e?(Ts.test(r.charAt(n))?(v=r.charAt(n),n++):(v=e,C===0&&R(Ls)),v!==e?(fe=o,w=Ms(v),o=w):(n=o,o=e)):(n=o,o=e);else u=e;return u}function Xt(){var u,o;return C++,r.substr(n,5)===Yr?(u=Yr,n+=5):(u=e,C===0&&R(Xa)),u===e&&(r.substr(n,3)===ir?(u=ir,n+=3):(u=e,C===0&&R(Is)),u===e&&(r.substr(n,9)===Ps?(u=Ps,n+=9):(u=e,C===0&&R(Va)),u===e&&(r.substr(n,3)===Ds?(u=Ds,n+=3):(u=e,C===0&&R(Ya)),u===e&&(r.substr(n,3)===Os?(u=Os,n+=3):(u=e,C===0&&R(ja)),u===e&&(r.substr(n,2)===Fs?(u=Fs,n+=2):(u=e,C===0&&R(qa)),u===e&&(r.substr(n,2)===zs?(u=zs,n+=2):(u=e,C===0&&R(Ga)),u===e&&(r.substr(n,2)===Hs?(u=Hs,n+=2):(u=e,C===0&&R(_s)),u===e&&(r.substr(n,4)===jr?(u=jr,n+=4):(u=e,C===0&&R(Ua)),u===e&&(r.substr(n,2)===qr?(u=qr,n+=2):(u=e,C===0&&R(Za)),u===e&&(r.substr(n,2)===Ws?(u=Ws,n+=2):(u=e,C===0&&R(ut)),u===e&&(r.substr(n,2)===Xs?(u=Xs,n+=2):(u=e,C===0&&R(Ka)),u===e&&(r.substr(n,2)===ct?(u=ct,n+=2):(u=e,C===0&&R(Ja)),u===e&&(r.substr(n,3)===Vs?(u=Vs,n+=3):(u=e,C===0&&R(Qa)),u===e&&(r.substr(n,3)===Ys?(u=Ys,n+=3):(u=e,C===0&&R(el)),u===e&&(r.substr(n,2)===sr?(u=sr,n+=2):(u=e,C===0&&R(Pe)),u===e&&(r.substr(n,3)===Gr?(u=Gr,n+=3):(u=e,C===0&&R(js)),u===e&&(r.substr(n,4)===Ht?(u=Ht,n+=4):(u=e,C===0&&R(qs)),u===e&&(r.substr(n,4)===Ur?(u=Ur,n+=4):(u=e,C===0&&R(tl)),u===e&&(r.substr(n,4)===Zr?(u=Zr,n+=4):(u=e,C===0&&R(Kr)),u===e&&(r.substr(n,3)===Gs?(u=Gs,n+=3):(u=e,C===0&&R(Us)),u===e&&(r.substr(n,3)===Jr?(u=Jr,n+=3):(u=e,C===0&&R(rl)),u===e&&(r.substr(n,3)===Zs?(u=Zs,n+=3):(u=e,C===0&&R(il)),u===e&&(r.substr(n,3)===nr?(u=nr,n+=3):(u=e,C===0&&R(kt)),u===e&&(r.substr(n,3)===Ks?(u=Ks,n+=3):(u=e,C===0&&R(sl)),u===e&&(r.substr(n,3)===Js?(u=Js,n+=3):(u=e,C===0&&R(Qs)),u===e&&(r.substr(n,3)===dt?(u=dt,n+=3):(u=e,C===0&&R(nl)),u===e&&(r.substr(n,2)===Qr?(u=Qr,n+=2):(u=e,C===0&&R(al)),u===e&&(r.substr(n,3)===ir?(u=ir,n+=3):(u=e,C===0&&R(Is)),u===e&&(r.substr(n,4)===en?(u=en,n+=4):(u=e,C===0&&R(ll)),u===e&&(r.substr(n,3)===tn?(u=tn,n+=3):(u=e,C===0&&R(ol)),u===e&&(r.substr(n,3)===rn?(u=rn,n+=3):(u=e,C===0&&R(hl)),u===e&&(r.substr(n,3)===sn?(u=sn,n+=3):(u=e,C===0&&R(fl)),u===e&&(r.substr(n,4)===nn?(u=nn,n+=4):(u=e,C===0&&R(gl))))))))))))))))))))))))))))))))))),C--,u===e&&(o=e,C===0&&R(Bs)),u}function Vt(){var u,o,w;for(C++,u=n,o=[],an.test(r.charAt(n))?(w=r.charAt(n),n++):(w=e,C===0&&R(ln));w!==e;)o.push(w),an.test(r.charAt(n))?(w=r.charAt(n),n++):(w=e,C===0&&R(ln));return o!==e&&(fe=u,o=ei(o)),u=o,C--,u===e&&(o=e,C===0&&R(ul)),u}function oi(){var u,o;return C++,r.charCodeAt(n)===9?(u=ti,n++):(u=e,C===0&&R(ri)),u===e&&(r.charCodeAt(n)===11?(u=ii,n++):(u=e,C===0&&R(on)),u===e&&(r.charCodeAt(n)===12?(u=hn,n++):(u=e,C===0&&R(dl)),u===e&&(r.charCodeAt(n)===32?(u=pl,n++):(u=e,C===0&&R(vl)),u===e&&(r.charCodeAt(n)===160?(u=Xe,n++):(u=e,C===0&&R(Et)),u===e&&(r.charCodeAt(n)===65279?(u=ml,n++):(u=e,C===0&&R(si)),u===e&&(u=Tl())))))),C--,u===e&&(o=e,C===0&&R(cl)),u}function Tl(){var u;return bl.test(r.charAt(n))?(u=r.charAt(n),n++):(u=e,C===0&&R(_t)),u}if(Ve=f(),Ve!==e&&n===r.length)return Ve;throw Ve!==e&&n<r.length&&R(wl()),gn(Wt,Ge<r.length?r.charAt(Ge):null,Ge<r.length?vt(Ge,Ge+1):vt(Ge,Ge))}return{SyntaxError:t,parse:i}}();var Ol={C2H4O2:"acetic acid",C3H6O:"acetone",C2H3N:"acetonitrile",C6H6:"benzene",CCl4:"carbon tetrachloride",C6H5Cl:"chlorobenzene",CHCl3:"chloroform",C6H12:"cyclohexane",C2H4Cl2:"1,2-dichloroethane",C4H10O3:"diethylene glycol",C6H14O3:"diglyme",C4H10O2:"DME",C3H7NO:"DMF",C2H6OS:"DMSO",C2H6O:"ethanol",C2H6O2:"ethylene glycol",C3H8O3:"glycerin",C7H16:"heptane",C6H18N3OP:"HMPA",C6H18N3P:"HMPT",C6H14:"hexane",CH4O:"methanol",C5H12O:"MTBE",CH2Cl2:"methylene chloride",CH5H9NO:"NMP",CH3NO2:"nitromethane",C5H12:"pentane",C5H5N:"pyridine",C7H8:"toluene",C6H15N:"triethyl amine",H2O:"water"};var Ut=class{constructor(t,i){this.defaultOptions={scale:i.scale>0?i.scale:1,fontSize:i.fontSizeLarge*.8,fontFamily:"Arial, Helvetica, sans-serif",spacing:10,plus:{size:9,thickness:1},arrow:{length:i.bondLength*4,headSize:6,thickness:1,margin:3},weights:{normalize:!1}},this.opts=St.extend(!0,this.defaultOptions,t),this.drawer=new st(i),this.molOpts=this.drawer.opts}draw(t,i,r="light",s=null,e="{reagents}",l="",f=!1){if(this.themeManager=new yt(this.molOpts.themes,r),this.opts.weights.normalize){let M=-Number.MAX_SAFE_INTEGER,z=Number.MAX_SAFE_INTEGER;if("reactants"in s)for(let F=0;F<s.reactants.length;F++)for(let k=0;k<s.reactants[F].length;k++)s.reactants[F][k]<z&&(z=s.reactants[F][k]),s.reactants[F][k]>M&&(M=s.reactants[F][k]);if("reagents"in s)for(let F=0;F<s.reagents.length;F++)for(let k=0;k<s.reagents[F].length;k++)s.reagents[F][k]<z&&(z=s.reagents[F][k]),s.reagents[F][k]>M&&(M=s.reagents[F][k]);if("products"in s)for(let F=0;F<s.products.length;F++)for(let k=0;k<s.products[F].length;k++)s.products[F][k]<z&&(z=s.products[F][k]),s.products[F][k]>M&&(M=s.products[F][k]);let W=Math.max(Math.abs(z),Math.abs(M));if(W===0&&(W=1),"reactants"in s)for(let F=0;F<s.reactants.length;F++)for(let k=0;k<s.reactants[F].length;k++)s.reactants[F][k]/=W;if("reagents"in s)for(let F=0;F<s.reagents.length;F++)for(let k=0;k<s.reagents[F].length;k++)s.reagents[F][k]/=W;if("products"in s)for(let F=0;F<s.products.length;F++)for(let k=0;k<s.products[F].length;k++)s.products[F][k]/=W}let g=null;for(i===null||i==="svg"?(g=document.createElementNS("http://www.w3.org/2000/svg","svg"),g.setAttribute("xmlns","http://www.w3.org/2000/svg"),g.setAttributeNS(null,"width","500"),g.setAttributeNS(null,"height","500")):typeof i=="string"||i instanceof String?g=document.getElementById(i):g=i;g.firstChild;)g.removeChild(g.firstChild);let c=[],m=0;for(let M=0;M<t.reactants.length;M++){M>0&&c.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let z=null;s&&"reactants"in s&&s.reactants.length>M&&(z=s.reactants[M]);let W=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(t.reactants[M],W,r,z,f,[],this.opts.weights.normalize);let F={width:W.viewBox.baseVal.width*this.opts.scale,height:W.viewBox.baseVal.height*this.opts.scale,svg:W};c.push(F),F.height>m&&(m=F.height)}c.push({width:this.opts.arrow.length*this.opts.scale,height:this.opts.arrow.headSize*this.opts.scale*2,svg:this.getArrow()});let b="";for(let M=0;M<t.reagents.length;M++){M>0&&(b+=", ");let z=this.drawer.getMolecularFormula(t.reagents[M]);z in Ol&&(z=Ol[z]),b+=Ze.replaceNumbersWithSubscript(z)}e=e.replace("{reagents}",b);let S=Ze.writeText(e,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale),p=(this.opts.arrow.length*this.opts.scale-S.width)/2;c.push({svg:S.svg,height:S.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+p,offsetY:-(S.height/2)-this.opts.arrow.margin,position:"relative"});let x=Ze.writeText(l,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale);p=(this.opts.arrow.length*this.opts.scale-x.width)/2,c.push({svg:x.svg,height:x.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+p,offsetY:x.height/2+this.opts.arrow.margin,position:"relative"});for(let M=0;M<t.products.length;M++){M>0&&c.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let z=null;s&&"products"in s&&s.products.length>M&&(z=s.products[M]);let W=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(t.products[M],W,r,z,f,[],this.opts.weights.normalize);let F={width:W.viewBox.baseVal.width*this.opts.scale,height:W.viewBox.baseVal.height*this.opts.scale,svg:W};c.push(F),F.height>m&&(m=F.height)}let D=0;return c.forEach(M=>{let z=M.offsetX||0,W=M.offsetY||0;M.svg.setAttributeNS(null,"x",Math.round(D+z)),M.svg.setAttributeNS(null,"y",Math.round((m-M.height)/2+W)),M.svg.setAttributeNS(null,"width",Math.round(M.width)),M.svg.setAttributeNS(null,"height",Math.round(M.height)),g.appendChild(M.svg),M.position!=="relative"&&(D+=Math.round(M.width+this.opts.spacing+z))}),g.setAttributeNS(null,"viewBox",`0 0 ${D} ${m}`),g.style.width=D+"px",g.style.height=m+"px",g}getPlus(){let t=this.opts.plus.size,i=this.opts.plus.thickness,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),s=document.createElementNS("http://www.w3.org/2000/svg","rect"),e=document.createElementNS("http://www.w3.org/2000/svg","rect");return r.setAttributeNS(null,"id","plus"),s.setAttributeNS(null,"x",0),s.setAttributeNS(null,"y",t/2-i/2),s.setAttributeNS(null,"width",t),s.setAttributeNS(null,"height",i),s.setAttributeNS(null,"fill",this.themeManager.getColor("C")),e.setAttributeNS(null,"x",t/2-i/2),e.setAttributeNS(null,"y",0),e.setAttributeNS(null,"width",i),e.setAttributeNS(null,"height",t),e.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.appendChild(s),r.appendChild(e),r.setAttributeNS(null,"viewBox",`0 0 ${t} ${t}`),r}getArrowhead(){let t=this.opts.arrow.headSize,i=document.createElementNS("http://www.w3.org/2000/svg","marker"),r=document.createElementNS("http://www.w3.org/2000/svg","polygon");return i.setAttributeNS(null,"id","arrowhead"),i.setAttributeNS(null,"viewBox",`0 0 ${t} ${t}`),i.setAttributeNS(null,"markerUnits","userSpaceOnUse"),i.setAttributeNS(null,"markerWidth",t),i.setAttributeNS(null,"markerHeight",t),i.setAttributeNS(null,"refX",0),i.setAttributeNS(null,"refY",t/2),i.setAttributeNS(null,"orient","auto"),i.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.setAttributeNS(null,"points",`0 0, ${t} ${t/2}, 0 ${t}`),i.appendChild(r),i}getCDArrowhead(){let t=this.opts.arrow.headSize,i=t*(7/4.5),r=document.createElementNS("http://www.w3.org/2000/svg","marker"),s=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttributeNS(null,"id","arrowhead"),r.setAttributeNS(null,"viewBox",`0 0 ${i} ${t}`),r.setAttributeNS(null,"markerUnits","userSpaceOnUse"),r.setAttributeNS(null,"markerWidth",i*2),r.setAttributeNS(null,"markerHeight",t*2),r.setAttributeNS(null,"refX",2.2),r.setAttributeNS(null,"refY",2.2),r.setAttributeNS(null,"orient","auto"),r.setAttributeNS(null,"fill",this.themeManager.getColor("C")),s.setAttributeNS(null,"style","fill-rule:nonzero;"),s.setAttributeNS(null,"d","m 0 0 l 7 2.25 l -7 2.25 c 0 0 0.735 -1.084 0.735 -2.28 c 0 -1.196 -0.735 -2.22 -0.735 -2.22 z"),r.appendChild(s),r}getArrow(){let t=this.opts.arrow.headSize,i=this.opts.arrow.length,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),s=document.createElementNS("http://www.w3.org/2000/svg","defs"),e=document.createElementNS("http://www.w3.org/2000/svg","line");return s.appendChild(this.getCDArrowhead()),r.appendChild(s),r.setAttributeNS(null,"id","arrow"),e.setAttributeNS(null,"x1",0),e.setAttributeNS(null,"y1",-this.opts.arrow.thickness/2),e.setAttributeNS(null,"x2",i),e.setAttributeNS(null,"y2",-this.opts.arrow.thickness/2),e.setAttributeNS(null,"stroke-width",this.opts.arrow.thickness),e.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),e.setAttributeNS(null,"marker-end","url(#arrowhead)"),r.appendChild(e),r.setAttributeNS(null,"viewBox",`0 ${-t/2} ${i+t*(7/4.5)} ${t}`),r}};var di=class{constructor(t){this.reactantsSmiles=[],this.reagentsSmiles=[],this.productsSmiles=[],this.reactantsWeights=[],this.reagentsWeights=[],this.productsWeights=[],this.reactants=[],this.reagents=[],this.products=[];let i=t.split(">");if(i.length!==3)throw new Error('Invalid reaction SMILES: Expected exactly two ">" symbols.');i[0]!==""&&(this.reactantsSmiles=i[0].split(".")),i[1]!==""&&(this.reagentsSmiles=i[1].split(".")),i[2]!==""&&(this.productsSmiles=i[2].split("."));for(let r=0;r<this.reactantsSmiles.length;r++)this.reactants.push(At.parse(this.reactantsSmiles[r]));for(let r=0;r<this.reagentsSmiles.length;r++)this.reagents.push(At.parse(this.reagentsSmiles[r]));for(let r=0;r<this.productsSmiles.length;r++)this.products.push(At.parse(this.productsSmiles[r]))}};var Bt=class{static parse(t){return new di(t)}};var pr=class L{constructor(t={},i={}){this.drawer=new st(t),this.reactionDrawer=new Ut(i,JSON.parse(JSON.stringify(this.drawer.opts)))}static apply(t={},i={},r="data-smiles",s="light",e=null,l=null){new L(t,i).apply(r,s,e,l)}apply(t="data-smiles",i="light",r=null,s=null){document.querySelectorAll(`[${t}]`).forEach(l=>{let f=l.getAttribute(t);if(f===null)throw Error("No SMILES provided.");let g=i,c=null;if(l.hasAttribute("data-smiles-theme")&&(g=l.getAttribute("data-smiles-theme")),l.hasAttribute("data-smiles-weights")&&(c=l.getAttribute("data-smiles-weights").split(",").map(parseFloat)),(l.hasAttribute("data-smiles-reactant-weights")||l.hasAttribute("data-smiles-reagent-weights")||l.hasAttribute("data-smiles-product-weights"))&&(c={reactants:[],reagents:[],products:[]},l.hasAttribute("data-smiles-reactant-weights")&&(c.reactants=l.getAttribute("data-smiles-reactant-weights").split(";").map(m=>m.split(",").map(parseFloat))),l.hasAttribute("data-smiles-reagent-weights")&&(c.reagents=l.getAttribute("data-smiles-reagent-weights").split(";").map(m=>m.split(",").map(parseFloat))),l.hasAttribute("data-smiles-product-weights")&&(c.products=l.getAttribute("data-smiles-product-weights").split(";").map(m=>m.split(",").map(parseFloat)))),l.hasAttribute("data-smiles-options")||l.hasAttribute("data-smiles-reaction-options")){let m={};l.hasAttribute("data-smiles-options")&&(m=JSON.parse(l.getAttribute("data-smiles-options").replace(/'/g,'"')));let b={};l.hasAttribute("data-smiles-reaction-options")&&(b=JSON.parse(l.getAttribute("data-smiles-reaction-options").replace(/'/g,'"'))),new L(m,b).draw(f,l,g,r,s,c)}else this.draw(f,l,g,r,s,c)})}draw(t,i,r="light",s=null,e=null,l=null){let f=[];[t,...f]=t.split(" ");let g=f.join(" "),c={};if(g.includes("__")){let b=g.substring(g.indexOf("__")+2,g.lastIndexOf("__"));c=JSON.parse(b.replace(/'/g,'"'))}let m={textAboveArrow:"{reagents}",textBelowArrow:""};if(c=St.extend(!0,m,c),t.includes(">"))try{this.drawReaction(t,i,r,c,l,s)}catch(b){e?e(b):console.error(b)}else try{this.drawMolecule(t,i,r,l,s)}catch(b){e?e(b):console.error(b)}}drawMolecule(t,i,r,s,e){let l=At.parse(t);if(i===null||i==="svg"){let f=this.drawer.draw(l,null,r,s),g=this.getDimensions(f);f.setAttributeNS(null,"width",""+g.w),f.setAttributeNS(null,"height",""+g.h),e&&e(f)}else if(i==="canvas"){let f=this.svgToCanvas(this.drawer.draw(l,null,r,s));e&&e(f)}else if(i==="img"){let f=this.svgToImg(this.drawer.draw(l,null,r,s));e&&e(f)}else i instanceof HTMLImageElement?(this.svgToImg(this.drawer.draw(l,null,r,s),i),e&&e(i)):i instanceof SVGElement?(this.drawer.draw(l,i,r,s),e&&e(i)):document.querySelectorAll(i).forEach(g=>{let c=g.nodeName.toLowerCase();c==="svg"?(this.drawer.draw(l,g,r,s),e&&e(g)):c==="canvas"?(this.svgToCanvas(this.drawer.draw(l,null,r,s),g),e&&e(g)):c==="img"&&(this.svgToImg(this.drawer.draw(l,null,r,s),g),e&&e(g))})}drawReaction(t,i,r,s,e,l){let f=Bt.parse(t);if(i===null||i==="svg"){let g=this.reactionDrawer.draw(f,null,r),c=this.getDimensions(g);g.setAttributeNS(null,"width",""+c.w),g.setAttributeNS(null,"height",""+c.h),l&&l(g)}else if(i==="canvas"){let g=this.svgToCanvas(this.reactionDrawer.draw(f,null,r,e,s.textAboveArrow,s.textBelowArrow));l&&l(g)}else if(i==="img"){let g=this.svgToImg(this.reactionDrawer.draw(f,null,r,e,s.textAboveArrow,s.textBelowArrow));l&&l(g)}else i instanceof HTMLImageElement?(this.svgToImg(this.reactionDrawer.draw(f,null,r,e,s.textAboveArrow,s.textBelowArrow),i),l&&l(i)):i instanceof SVGElement?(this.reactionDrawer.draw(f,i,r,e,s.textAboveArrow,s.textBelowArrow),l&&l(i)):document.querySelectorAll(i).forEach(c=>{let m=c.nodeName.toLowerCase();m==="svg"?(this.reactionDrawer.draw(f,c,r,e,s.textAboveArrow,s.textBelowArrow),this.reactionDrawer.opts.scale<=0&&(c.style.width=null,c.style.height=null),l&&l(c)):m==="canvas"?(this.svgToCanvas(this.reactionDrawer.draw(f,null,r,e,s.textAboveArrow,s.textBelowArrow),c),l&&l(c)):m==="img"&&(this.svgToImg(this.reactionDrawer.draw(f,null,r,e,s.textAboveArrow,s.textBelowArrow),c),l&&l(c))})}svgToCanvas(t,i=null){i===null&&(i=document.createElement("canvas"));let r=this.getDimensions(i,t);return Ze.svgToCanvas(t,i,r.w,r.h),i}svgToImg(t,i=null){i===null&&(i=document.createElement("img"));let r=this.getDimensions(i,t);return Ze.svgToImg(t,i,r.w,r.h),i}getDimensions(t,i=null){let r=this.drawer.opts.width,s=this.drawer.opts.height;return this.drawer.opts.scale<=0?(t instanceof SVGElement||(r===null&&(r=t.width),s===null&&(s=t.height)),t.style.width!==""&&(r=parseInt(t.style.width)),t.style.height!==""&&(s=parseInt(t.style.height))):i&&(r=parseFloat(i.style.width),s=parseFloat(i.style.height)),{w:r,h:s}}};var Zt={Version:"2.2.0",Drawer:dr,GaussDrawer:Gt,Parser:At,ReactionDrawer:Ut,ReactionParser:Bt,SmiDrawer:pr,SvgDrawer:st};Zt.clean=function(L){return L.replace(/[^A-Za-z0-9@.+\-?!()[\]{}/\\=#$:*]/g,"")};Zt.apply=function(L,t="canvas[data-smiles]",i="light",r=null){let s=new dr(L),e=document.querySelectorAll(t);for(var l=0;l<e.length;l++){let f=e[l];Zt.parse(f.getAttribute("data-smiles"),function(g){s.draw(g,f,i,!1)},function(g){r&&r(g)})}};Zt.parse=function(L,t,i){try{t&&t(At.parse(L))}catch(r){i&&i(r)}};Zt.parseReaction=function(L,t,i){try{t&&t(Bt.parse(L))}catch(r){i&&i(r)}};if(!Array.prototype.fill){let L=function(t){if(this==null)throw new TypeError("this is null or not defined");for(var i=Object(this),r=i.length>>>0,s=arguments[1],e=s>>0,l=e<0?Math.max(r+e,0):Math.min(e,r),f=arguments[2],g=f===void 0?r:f>>0,c=g<0?Math.max(r+g,0):Math.min(g,r);l<c;)i[l]=t,l++;return i};Object.defineProperty(Array.prototype,"fill",{value:L,writeable:!1})}typeof window<"u"&&window.document&&window.document.createElement&&(window.SmilesDrawer=Zt,window.SmiDrawer=pr);var uf=Zt;})();
/*! Bundled license information:

chroma-js/chroma.js:
  (**
   * chroma.js - JavaScript library for color conversions
   *
   * Copyright (c) 2011-2019, Gregor Aisch
   * All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are met:
   *
   * 1. Redistributions of source code must retain the above copyright notice, this
   * list of conditions and the following disclaimer.
   *
   * 2. Redistributions in binary form must reproduce the above copyright notice,
   * this list of conditions and the following disclaimer in the documentation
   * and/or other materials provided with the distribution.
   *
   * 3. The name Gregor Aisch may not be used to endorse or promote products
   * derived from this software without specific prior written permission.
   *
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
   * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
   * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   *
   * -------------------------------------------------------
   *
   * chroma.js includes colors from colorbrewer2.org, which are released under
   * the following license:
   *
   * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
   * and The Pennsylvania State University.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing,
   * software distributed under the License is distributed on an
   * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
   * either express or implied. See the License for the specific
   * language governing permissions and limitations under the License.
   *
   * ------------------------------------------------------
   *
   * Named colors are taken from X11 Color Names.
   * http://www.w3.org/TR/css3-color/#svg-color
   *
   * @preserve
   *)
*/
//# sourceMappingURL=smiles-drawer.min.js.map
